# 対応予定のテスト

## ローカルファイルからアノテーション読込

### ファイルが指定されていなければ Open ボタンを押せない

1.  アノテーション読込ダイアログを開く
2.  Local のファイルが選択されていない時は`Open`ボタンは無効

### ローカルファイルからはテキストファイルが読み込める

#### 背景

1.  5.0.0 で機能を追加

#### -- 手段 --

1.  `target.txt`をファイルから読み込む
2.  アノテーションが読み込めること

### JSON でもテキストでもないファイルをファイルから読み込んだらエラーを alertify.js で表示

#### 背景

1.  エラーが起きていました
2.  5.0.0 で対応
3.  5.3.4 でエラーが起きていました。
4.  6.0.6 で対応
5.  6.4.127 で間違ったメッセージを表示するようになりました
6.  対応バージョン未定

#### -- 手段 --

1.  適当な json でも text でもないファイルを読み込む
2.  右上に`ファイル名(local file) is not a annotation file or its format is invalid.`と赤色のトースト表示がされること

## アノテーションファイルを読み込んだとき、ステータスバーの情報とエディター内部で保持する変更前のアノテーション情報を更新する

### 背景

1. 読み込んだアノテーションは、保存する際にエディターで変更しないプロパティを保持するために、変更前のアノテーション情報として保存しています
2. 読み込んだアノテーションファイルとコンフィグレーションファイルの内容を併せて整合性チェックを行います
3. チェックに引っかかった場合に、ステータスバーの情報を更新していました
4. チェックに引っかかった場合に、変更前のアノテーション情報を更新していました
5. チェックに引っかかった場合に、パレットを更新していました
6. 6.4.29 で上記 3,4 の情報を更新しない対応をしました
7. エディターの config 属性で、コンフィグレーションファイルの URL を指定していると、コンフィグレーションを含まないアノテーションを読み込んだときに、コンフィグレーションを URL から取得します
8. 6.4.29 で、コンフィグレーションファイルを URL から取得するアノテーションのときも、上記 3,4 の情報を更新しなくしていました

### 不正なフォーマットの アノテーションファイルを読み込んだ  ときにステータスバーの情報を更新しない

1.  Editor0 を選択
2.  `invalid_color_annotation.json` を読み込む
3.  ステータスバーに表示される URL が`http://pubannotation.org/projects/DisGeNET/docs/sourcedb/PubMed/sourceid/10021369/annotations.json `から変わらないこと

### config 属性を指定したエディターで config が含まれないアノテーションを読みこむ

1. Editor1 を選択
2. `i`キーを押してアノテーション読込ダイアログを開く
3. ローカルファイルから`private.json`を読み込む
4. ステータスバーに`private.json(local file)`が表示されること
5. `u`キーを押してアノテーション保存ダイアログを開く
6. `Click to see the json source in a new window.`リンクをクリック
7. `text`の項目が`Specific T-cell `で始まること

## Attribute インスタスがあるアノテーション読み込んでから、Attribute 定義がないアノテーションを読み込む

### 背景

1. アノテーションを読み込むときにコンフィグレーションも読み直しています
2. コンフィグレーションを読みなおしたときにすべての Entity をレンダリングしなおしています
3. Attribute を持つ Entity をレンダリングするときに Attribute の表示名を取得しようとします
4. 6.4.90 で Attribute の表示名を取得するときに、Attribute 定義がなかったときにエラーが起きるようにしました
5. コンフィグレーションがリセット済みのため Attribute 定義が存在しないためエラーが起きます
6. 6.4.141 で対応しました

### -- 手段 --

1. Editor1 を選択
2. `i`キーを押してアノテーション読込ダイアログを開く
3. ローカルファイルから`private.json`を読み込む
4. エラーが起きないこと

## 左右キーで選択 Entity を変更

### 背景

1.  左右キーで移動する Entity の順序を DOM の順序から取得します
2.  Grid を作るときは右の Span の Grid の前に挿入します
3.  6.1.26 で右の Span の Grid の取得に失敗して、作成した Grid を、常に最後尾に追加していました
4.  左右キーで移動する Entity の順序が、見た目上の Grid の順序ではなく、追加した順になっていました
5.  6.1.29 で対応しました。

### -- 手段 --

1.  既存の Span より左に Span を追加する
2.  追加した Span の Entity を選択する
3.  `右キー`を押す
4.  右隣の Entity が選択されること
5.  `左キー`を押す
6.  左隣の Entity が選択されること

### 左右キーで端っこより先に選択を変更できない

#### Term モード

1.  先頭の Entity を選択する
2.  `左キー`を押す
3.  選択する Entity が変わらないこと
4.  最後の Entity を選択する
5.  `右キー`を押す
6.  選択する Entity が変わらないこと

#### Simple モード

1.  先頭の Entity label を選択する
2.  `左キー`を押す
3.  選択する Entity label が変わらないこと
4.  最後の Entity label を選択する
5.  `右キー`を押す
6.  選択する Entity が変わらないこと

#### Relation モード

1.  先頭の Entity を選択する
2.  `左キー`を押す
3.  選択する Entity が変わらないこと
4.  最後の Entity を選択する
5.  `右キー`を押す
6.  選択する Entity が変わらないこと

## 左右キーに連動してスクロールすること

### 背景

1.  5.0.0 で Attribute を追加した際に、Type の DOM 構造を変更しました
2.  DOM の取得に previousElementSibling, nextElementSibling を使っているところを Element.closest または Element.querySelector におきかえました。
3.  機能が壊れていないか確認します。
4.  6.2.49 で BlockSpan をつくったときにドキュメントの最上部までスクロールしない対応を入れた際に、DenotationEntity を選択した際にスクロールしなくなっていました。
5.  6.4.11 で対応

### Term モードの Entity

1.  Term モードにする
2.  Entity を選択する
3.  `左キー`を何回も押して、表示領域外の Entity を選択する
4.  選択した Entity が表示される位置に表示されること
5.  `右キー`を何回も押して、表示領域外の Entity を選択する
6.  選択した Entity が表示される位置に表示されること

### Span

1.  Span を選択する
2.  `左キー`を何回も押して、表示領域外の Span を選択する
3.  選択した Span が表示される位置に表示されること
4.  `右キー`を何回も押して、表示領域外の Span を選択する
5.  選択した Span が表示される位置に表示されること

## 左右キーで選択 Span を変更

### -- 手段 --

1.  Span を選択する
2.  `左キー`を押す
3.  左隣の Span が選択されること
4.  `右キー`を押す
5.  右隣の Span が選択されること

### 左右キーで端っこより先に選択を変更できない

#### Term モード

1.  先頭の Span を選択する
2.  `左キー`を押す
3.  選択する Span が変わらないこと
4.  最後の Span を選択する
5.  `右キー`を押す
6.  選択する Span が変わらないこと

#### Simple モード

1.  先頭の Span を選択する
2.  `左キー`を押す
3.  選択する Span が変わらないこと
4.  最後の Span を選択する
5.  `右キー`を押す
6.  選択する Span が変わらないこと
