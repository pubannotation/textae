# 受け入れテスト

共通確認項目

1.  `npm run dist`を実行します
2.  `npm run dev:server`を実行します
3.  <http://localhost:8000/dist/demo/development.html> を開きます
4.  ブラウザの開発ツールを起動します。
5.  以下のテストを実行して、エラーが出ないこと

## 行の高さ自動調整はデフォルトで有効

### 背景

1. 6.1.5 から、config の `autolineheight` の値で行の高さ自動調整の有効無効を指定できるようになりました
2. 7.15.0 で行の高さ自動調整をデフォルトで有効にしました

### -- 手段 --

1. Editor1 を選択
2. 行の高さ自動調整が無効であること

## 境界検知はデフォルトで有効

### 背景

1. 6.1.5 から、config の `boundarydetection` の値で境界検知の有効無効を指定できるようになりました
2. 7.15.0 で境界検知をデフォルトで有効にしました

### -- 手段 --

1. 境界検知が有効であること
2. `ゆりかごのうた.json`を読み込む
3. 境界検知が無効になること

## アノテーション保存

### 保存ファイル名は、読み込んだアノテーションのファイル名

#### 背景

1.  アノテーション保存ダイアログの保存ファイルの初期値は、最後に読み込んだアノテーションのファイル名です
2.  6.1.4 で対応しました

#### -- 手段 --

1.  Editor0 を選択
2.  アノテーション読込ダイアログを開く
3.  ローカルファイルから`1_annotations.json`を読み込む
4.  アノテーション保存ダイアログを開く
5.  Local 欄に`1_annotations.json`が表示されていること

### Clipboard

#### 背景

1.  5.3.4 で、JSON フォーマットを 2 回 stringfy して壊れていまた
2.  6.1.2 で対応

#### -- 手段 --

1.  アノテーション保存ダイアログを開く
2.  `Click to see the json source in a new window`をクリックする
3.  新しいタブが開いて annotation.json が表示されること
4.  `{\"target\"`のようにエスケープ用のバックスラッシュが入っていないこと
5.  表示した json に変更内容が反映されていること

### URL

1.  Editor1 を選択
2.  アノテーション保存ダイアログを開く
3.  URL に保存する
4.  指定したファイル名`.dev_data.json`のファイルができていること
5.  指定したファイル名`.dev_data.json`のファイルに変更内容が反映されていること

### Local

1.  アノテーション保存ダイアログを開く
2.  Local に保存する
3.  指定したファイル名のファイルがダウンロードできること
4.  ダウンロードしたファイルに変更内容が反映されていること

### URL が指定されていなければ save ボタンを押せない

1.  アノテーション保存ダイアログを開く
2.  URL 欄を空にする
3.  保存ダイアログ上の Save ボタンが無効になること

## 保存ファイル名は、読み込んだコンフィグレーションのファイル名

### 背景

1.  コンフィグレーション保存ダイアログの保存ファイルの初期値は、最後に読み込んだコンフィグレーションのファイル名です
2.  6.1.4 で対応しました

### -- 手段 --

1.  Editor0 を選択
2.  `Show label list editor [Q]`ボタンをクリックする
3.  コンフィグレーション読込ダイアログを開く
4.  ローカルファイルから`1_config.json`を読み込む
5.  `Show label list editor [Q]`ボタンをクリックする
6.  コンフィグレーション保存ダイアログを開く
7.  Local 欄に`1_config.json`が表示されていること

## コンフィグレーション保存

### 背景

1.  5.0.0 でコンフィグレーションの保存機能を追加しました

### URL を指定して保存

1.  Editor1 を選択
2.  `Show label list editor [Q]`ボタンをクリックする
3.  コンフィグレーション保存ダイアログを開く
4.  URL に保存する
5.  指定したファイル名`.dev_data.json`のファイルができていること
6.  指定したファイル名`.dev_data.json`のファイルに変更内容が反映されていること

### Local ファイルに保存

1.  Editor1 を選択
2.  `Show label list editor [Q]`ボタンをクリックする
3.  コンフィグレーション保存ダイアログを開く
4.  Local に保存する
5.  指定したファイル名のファイルがダウンロードできること
6.  ダウンロードしたファイルに変更内容が反映されていること

### URL が指定されていなければ save ボタンを押せない

1.  Editor1 を選択
2.  `Show label list editor [Q]`ボタンをクリックする
3.  コンフィグレーション保存ダイアログを開く
4.  URL 欄を空にする
5.  保存ダイアログ上の Save ボタンが無効になること

### コンフィグレーション保存時にメッセージを alertify.js で表示

#### 背景

1.  5.0.0 開発中にサーバーに保存するときの、トーストメッセージが間違っていました

#### -- 手段 --

1.  Editor1 を選択
2.  `Show label list editor [Q]`ボタンをクリックする
3.  コンフィグレーション保存ダイアログを開く
4.  `Save`ボタンをクリックする
5.  右上に`configuration saved`と緑色のトースト表示がされること

## URL からコンフィグレーションファイルを読み込んだ時に、変更前のコンフィグレーション情報を読み込んだコンフィグレーションに更新する

### 背景

1. 5.0.0 でコンフィグレーションの読込・保存機能を追加しました
2. コンフィグレーション保存ダイアログでは、コンフィグレーション変更前後の diff を表示します
3. diff を取得するために、変更前のコンフィグレーション情報を保存しています
4. 5.3.5 からアノテーションファイルに含まれるコンフィグレーションを、変更前のコンフィグレーション情報をに反映しています
5. 6.1.3 で、URL からコンフィグレーションファイルを読み込んだ時に、変更前のコンフィグレーション情報を読み込んだコンフィグレーションに更新していませんでした
6. diff に表示するコンフィグレーション情報の読み込み前のコンフィグレーションに、アノテーションファイルに含まれるコンフィグレーションのみ反映されていました
7. 6.4.152 で対応しました

### -- 手段 --

1. Editor0 を選択
2. `q`キーを押してパレットを開く
3. `Import`ボタンをクリック
4. `/dev/1_config.json`を読み込む
5. `Uplaod`ボタンをクリック
6. `Configuration differences`欄の`attribute types`に、新しい Attirbute 定義が追加されていないこと
7. Editor1 を選択
8. `i`キーを押してアノテーション読込ダイアログを開く
9. ローカルファイルから`private.json`を読み込む
10. `q`キーを押してパレットを開く
11. `Uplaod`ボタンをクリック
12. `Configuration differences`欄の`attribute types`の 1 番目の`pred`の変更前の値が`denote`でないこと

## アノテーション保存先 URL は、読み込んだアノテーションの URL

### 背景

1. アノテーション保存ダイアログの保存ファイルの初期値は、最後に読み込んだアノテーションのファイル名です
2. 6.1.4 で対応しました
3. 不正なアノテーションを読み込んだときに、アノテーションを適用しません。
4. 不正なアノテーションを読み込んだときに、その URL を保存していました。
5. 6.4.151 で対応しました

### -- 手段 --

1.  Editor1 を選択
2.  アノテーション読込ダイアログを開く
3.  `/dev/invalid_color_annotation.json`を読み込む
4.  右上に`Invalid configuration: '<span style='color:red'>Invalid color format</span>' is invalid color format.`と赤色のトースト表示がされること
5.  アノテーション保存ダイアログを開く
6.  URL 欄に`http://pubannotation.org/projects/DisGeNET/docs/sourcedb/PubMed/sourceid/10021369/annotations.json`が表示されていること

## Term モードで Ctrl/Cmd を押して複数選択

1.  Term モードにする
2.  Span と Span を同時に複数選択する
3.  Entity と Entity を同時に複数選択する
4.  Span と Entity を同時に複数選択する

## 新しく作った Relation をラベルを使って複数選択

1.  新規に Relation を作る
2.  他の Relation を選択
3.  Ctrl を押しながら新しく作った Relation のラベルをクリック
4.  両方の Relation が選択されること

## 兄弟 Span を端を共有する親 Span にする

### 背景

1. 6.1.54 で、SpanEditor をリファクタリングしているときに、分岐が一つ失われ、動かなくなりました
1. 6.4.135 で対応しました
1. 6.4.136 で伸ばす Span を選択しなくても親 Span にできるようにしました

### -- 手段 --

#### Span 上で mouse up

1.  Term モードにする
2.  Span を作る
3.  兄弟になる Span を作る
4.  片方の Span を選択する
5.  選択した Span をもう片方の Span の反対側の端と同じ範囲まで広げる（span 上で mouse up すること）
6.  親子 Span になること

#### 行間上で mouse up

1.  Term モードにする
2.  Span を作る
3.  兄弟になる Span を作る
4.  片方の Span を選択する
5.  選択した Span をもう片方の Span の反対側の端と同じ範囲まで広げる（テキストとテキストの行間の空白領域で mouse up すること）
6.  親子 Span になること

## 選択中に削除すると右の要素を選択する

### 背景

1.  6.1.1 で一つの denotation を一つのエンティティに表示することしました。

### Span

1.  Span を選択する
2.  Span を削除する
3.  右の Span が選択されること

### Entity

1.  Entity を選択する
2.  Entity を削除する
3.  右の Entity が選択されること

### Span を縮めて消した時に、次の Span を選択

#### 背景

1.  4.4.1 で対応
2.  ボタンか`d`キーで Span を削除した時は、右の Span を選択していたが、Span を縮めて削除した時は選択していなかった

#### Boundary Detection 有効時

##### Span の耳をひっぱて縮める

1.  Term モードにする
2.  `Boundary Detection`ボタンを押下状態にする
3.  Span を選択せずに右から縮めて Span を消す
4.  右の Span が選択されること
5.  Span を選択せずに左から縮めて Span を消す
6.  右の Span が選択されること
7.  Span を選択して右から縮めて Span を消す
8.  右の Span が選択されること
9.  Span を選択して左から縮めて Span を消す
10. 右の Span が選択されること

#### Boundary Detection 無効時

##### Span の耳をひっぱて縮める

1.  Term モードにする
2.  `Boundary Detection`ボタンを押上状態にする
3.  Span を選択せずに右から縮めて Span を消す
4.  右の Span が選択されること
5.  Span を選択せずに左から縮めて Span を消す
6.  右の Span が選択されること
7.  Span を選択して右から縮めて Span を消す
8.  右の Span が選択されること
9.  Span を選択して左から縮めて Span を消す
10. 右の Span が選択されること

### Relation は選択解除

1.  Relation を選択する
2.  Relation を削除する
3.  選択解除されること

## パレットは画面からはみ出ない

### 背景

1. 6.4.78 でパレットをエディターの右端からはみ出ないようにしました
2. 横スクロールバーが表示されているときに、パレットが下からはみ出ます
3. windew.innerHeight を使うとスクロールバーを考慮しない高さがとれます
4. document.documentElement.clientHeight を使えばスクロールバーを考慮した高さがとれます
5. 6.4.122 で対応しました

### -- 手段 --

1.  Term モードにする
2.  ブラウザの横スクロールバーが表示されるまで、ブラウザの幅を縮める
3.  エディターのブラウザの下端ギリギリ、右端ギリギリをクリックする
4.  `Q`キーを押す
5.  パレットがブラウザからはみ出ないこと
