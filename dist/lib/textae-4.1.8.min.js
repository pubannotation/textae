/*! textae 4.1.8 10-02-2015 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";b.exports=function(a){function b(a){var b=new c(a),d=b.promise();return d.isRejected()?d:(b.setHowMany(1),b.setUnwrap(),b.init(),d)}var c=a._SomePromiseArray;a.any=function(a){return b(a)},a.prototype.any=function(){return b(this)}}},{}],2:[function(a,b){(function(c){"use strict";function d(){this._isTickUsed=!1,this._lateQueue=new h(16),this._normalQueue=new h(16);var a=this;this.drainQueues=function(){a._drainQueues()},this._schedule=g.isStatic?g(this.drainQueues):g}var e;try{throw new Error}catch(f){e=f}var g=a("./schedule.js"),h=a("./queue.js"),i="undefined"!=typeof c?c:void 0;d.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},d.prototype._withDomain=function(a){return void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a)),a},d.prototype.throwLater=function(a,b){if(1===arguments.length&&(b=a,a=function(){throw b}),a=this._withDomain(a),"undefined"!=typeof setTimeout)setTimeout(function(){a(b)},0);else try{this._schedule(function(){a(b)})}catch(c){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},d.prototype.invokeLater=function(a,b,c){a=this._withDomain(a),this._lateQueue.push(a,b,c),this._queueTick()},d.prototype.invokeFirst=function(a,b,c){a=this._withDomain(a),this._normalQueue.unshift(a,b,c),this._queueTick()},d.prototype.invoke=function(a,b,c){a=this._withDomain(a),this._normalQueue.push(a,b,c),this._queueTick()},d.prototype.settlePromises=function(a){this._normalQueue._pushOne(a),this._queueTick()},d.prototype._drainQueue=function(a){for(;a.length()>0;){var b=a.shift();if("function"==typeof b){var c=a.shift(),d=a.shift();b.call(c,d)}else b._settlePromises()}},d.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},d.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},d.prototype._reset=function(){this._isTickUsed=!1},b.exports=new d,b.exports.firstLineError=e}).call(this,a("_process"))},{"./queue.js":24,"./schedule.js":27,_process:38}],3:[function(a,b){"use strict";function c(){try{Promise===e&&(Promise=d)}catch(a){}return e}var d;"undefined"!=typeof Promise&&(d=Promise);var e=a("./promise.js")();e.noConflict=c,b.exports=e},{"./promise.js":19}],4:[function(a,b){"use strict";var c=Object.create;if(c){var d=c(null),e=c(null);d[" size"]=e[" size"]=0}b.exports=function(b){function c(a){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,a))}function f(a){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",a))}function g(a,b,c){var d=c[a];if("function"!=typeof d){if(!o(a))return null;if(d=b(a),c[a]=d,c[" size"]++,c[" size"]>512){for(var e=Object.keys(c),f=0;256>f;++f)delete c[e[f]];c[" size"]=e.length-256}}return d}function h(a){return g(a,c,d)}function i(a){return g(a,f,e)}function j(a){return a[this.pop()].apply(a,this)}function k(a){return a[this]}function l(a){var b=+this;return 0>b&&(b=Math.max(0,b+a.length)),a[b]}var m=a("./util.js"),n=m.canEvaluate,o=m.isIdentifier;b.prototype.call=function(a){for(var b=arguments.length,c=new Array(b-1),d=1;b>d;++d)c[d-1]=arguments[d];if(n){var e=h(a);if(null!==e)return this._then(e,void 0,void 0,c,void 0)}return c.push(a),this._then(j,void 0,void 0,c,void 0)},b.prototype.get=function(a){var b,c="number"==typeof a;if(c)b=l;else if(n){var d=i(a);b=null!==d?d:k}else b=k;return this._then(b,void 0,void 0,a,void 0)}}},{"./util.js":34}],5:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./errors.js"),e=a("./async.js"),f=d.CancellationError;b.prototype._cancel=function(a){if(!this.isCancellable())return this;for(var b,c=this;void 0!==(b=c._cancellationParent)&&b.isCancellable();)c=b;this._unsetCancellable(),c._target()._rejectCallback(a,!1,!0)},b.prototype.cancel=function(a){return this.isCancellable()?(void 0===a&&(a=new f),e.invokeLater(this._cancel,this,a),this):this},b.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},b.prototype.uncancellable=function(){var a=new b(c);return a._propagateFrom(this,4),a._follow(this),a._unsetCancellable(),a},b.prototype.fork=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);return d._setCancellable(),d._cancellationParent=void 0,d}}},{"./async.js":2,"./errors.js":10}],6:[function(a,b){(function(c){"use strict";b.exports=function(){function b(a){this._parent=a;var c=this._length=1+(void 0===a?0:a._length);u(this,b),c>32&&this.uncycle()}function d(a,b){for(var c=0;c<b.length-1;++c)b[c].push("From previous event:"),b[c]=b[c].join("\n");return b[c]=b[c].join("\n"),a+"\n"+b.join("\n")}function e(a){for(var b=0;b<a.length;++b)(0===a[b].length||b+1<a.length&&a[b][0]===a[b+1][0])&&(a.splice(b,1),b--)}function f(a){for(var b=a[0],c=1;c<a.length;++c){for(var d=a[c],e=b.length-1,f=b[e],g=-1,h=d.length-1;h>=0;--h)if(d[h]===f){g=h;break}for(var h=g;h>=0;--h){var i=d[h];if(b[e]!==i)break;b.pop(),e--}b=d}}function g(a){for(var b=0;b<a.length;++b){var c=a[b];if("    (No stack trace)"===c||p.test(c))break}if(1>=b)return 1;for(var d=[],e=0;b>e;++e)d.push(a.shift());return a.unshift(d.join("\x00")),b}function h(a){return a.length>0&&(a[0]=a[0].split("\x00").join("\n")),a}function i(a,b){for(var c=a.slice(0,b),d=b;d<a.length;++d){var e=a[d],f=p.test(e)||"    (No stack trace)"===e,g=f&&r(e);f&&!g&&c.push(e)}return c}function j(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a.toString();var c=/\[object [a-zA-Z0-9$_]+\]/;if(c.test(b))try{var d=JSON.stringify(a);b=d}catch(e){}0===b.length&&(b="(empty array)")}return"(<"+k(b)+">, no stack trace)"}function k(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function l(a){var b=a.match(s);return b?{fileName:b[1],line:parseInt(b[2],10)}:void 0}var m=a("./async.js"),n=a("./util.js").inherits,o=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo)/,p=null,q=null;n(b,Error),b.prototype.uncycle=function(){var a=this._length;if(!(2>a)){for(var b=[],c={},d=0,e=this;void 0!==e;++d)b.push(e),e=e._parent;a=this._length=d;for(var d=a-1;d>=0;--d){var f=b[d].stack;void 0===c[f]&&(c[f]=d)}for(var d=0;a>d;++d){var g=b[d].stack,h=c[g];if(void 0!==h&&h!==d){h>0&&(b[h-1]._parent=void 0,b[h-1]._length=1),b[d]._parent=void 0,b[d]._length=1;var i=d>0?b[d-1]:this;a-1>h?(i._parent=b[h+1],i._parent.uncycle(),i._length=i._parent._length+1):(i._parent=void 0,i._length=1);for(var j=i._length+1,k=d-2;k>=0;--k)b[k]._length=j,j++;return}}}},b.prototype.parent=function(){return this._parent},b.prototype.hasParent=function(){return void 0!==this._parent},b.prototype.attachExtraTrace=function(a){if(!a.__stackCleaned__){this.uncycle();for(var c=b.cleanHeaderStack(a,!1),g=[c.slice(1)],h=this;void 0!==h;)g.push(i(h.stack.split("\n"),0)),h=h._parent;f(g),e(g);var j=c[0].split("\x00").join("\n");a.stack=d(j,g)}},b.cleanHeaderStack=function(a,b){if(!a.__stackCleaned__){a.__stackCleaned__=!0;var c=a.stack;c="string"==typeof c?c.split("\n"):[a.toString(),"    (No stack trace)"];var d=g(c);return c=i(c,d),b&&(c=h(c)),a.stack=c.join("\n"),c}},b.formatAndLogError=function(a,b){if("object"==typeof console){var c;if("object"==typeof a||"function"==typeof a){var d=a.stack;c=b+q(d,a)}else c=b+String(a);"function"==typeof console.warn||"object"==typeof console.warn?console.warn(c):("function"==typeof console.log||"object"==typeof console.log)&&console.log(c)}},b.unhandledRejection=function(a){b.formatAndLogError(a,"^--- With additional stack trace: ")},b.isSupported=function(){return"function"==typeof u},b.fireRejectionEvent=function(a,c,d,e){var f=!1;try{"function"==typeof c&&(f=!0,"rejectionHandled"===a?c(e):c(d,e))}catch(g){m.throwLater(g)}var h=!1;try{h=v(a,d,e)}catch(g){h=!0,m.throwLater(g)}var i=!1;if(t)try{i=t(a.toLowerCase(),{reason:d,promise:e})}catch(g){i=!0,m.throwLater(g)}h||f||i||"unhandledRejection"!==a||b.formatAndLogError(d,"Possibly unhandled ")};var r=function(){return!1},s=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;b.setBounds=function(a,c){if(b.isSupported()){for(var d,e,f=a.stack.split("\n"),g=c.stack.split("\n"),h=-1,i=-1,j=0;j<f.length;++j){var k=l(f[j]);if(k){d=k.fileName,h=k.line;break}}for(var j=0;j<g.length;++j){var k=l(g[j]);if(k){e=k.fileName,i=k.line;break}}0>h||0>i||!d||!e||d!==e||h>=i||(r=function(a){if(o.test(a))return!0;var b=l(a);return b&&b.fileName===d&&h<=b.line&&b.line<=i?!0:!1})}};var t,u=function w(){var a=/^\s*at\s*/,b=function(a,b){return"string"==typeof a?a:void 0!==b.name&&void 0!==b.message?b.name+". "+b.message:j(b)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,p=a,q=b;var c=Error.captureStackTrace;return r=function(a){return o.test(a)},function(a,b){Error.stackTraceLimit=Error.stackTraceLimit+6,c(a,b),Error.stackTraceLimit=Error.stackTraceLimit-6}}var d=new Error;if("string"==typeof d.stack&&"function"==typeof"".startsWith&&d.stack.startsWith("stackDetection@")&&"stackDetection"===w.name){p=/@/;var e=/[@\n]/;return q=function(a,b){return"string"==typeof a?b.name+". "+b.message+"\n"+a:void 0!==b.name&&void 0!==b.message?b.name+". "+b.message:j(b)},function(a){for(var b=(new Error).stack,c=b.split(e),d=c.length,f="",g=0;d>g;g+=2)f+=c[g],f+="@",f+=c[g+1],f+="\n";a.stack=f}}var f;try{throw new Error}catch(g){f="stack"in g}return"stack"in d||!f?(q=function(a,b){return"string"==typeof a?a:"object"!=typeof b&&"function"!=typeof b||void 0===b.name||void 0===b.message?j(b):b.name+". "+b.message},null):(p=a,q=b,function(a){try{throw new Error}catch(b){a.stack=b.stack}})}(),v=function(){if("undefined"!=typeof c&&"string"==typeof c.version&&"undefined"==typeof window)return function(a,b,d){return"rejectionHandled"===a?c.emit(a,d):c.emit(a,b,d)};var a=!1;try{var b=new self.CustomEvent("test");a=b instanceof CustomEvent}catch(d){}t=function(b,c){var d;return a?d=new self.CustomEvent(b,{detail:c,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(d=document.createEvent("CustomEvent"),d.initCustomEvent(b,!1,!0,c)),d?!self.dispatchEvent(d):!1};var e={};return e.unhandledRejection="onunhandledRejection".toLowerCase(),e.rejectionHandled="onrejectionHandled".toLowerCase(),function(a,b,c){var d=e[a],f=self[d];return f?("rejectionHandled"===a?f.call(self,c):f.call(self,b,c),!0):!1}}();return b}}).call(this,a("_process"))},{"./async.js":2,"./util.js":34,_process:38}],7:[function(a,b){"use strict";b.exports=function(b){function c(a,b,c){this._instances=a,this._callback=b,this._promise=c}function d(a,b){var c={},d=g(a).call(c,b);if(d===h)return d;var e=i(c);return e.length?(h.e=new j("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),h):d}var e=a("./util.js"),f=a("./errors.js"),g=e.tryCatch,h=e.errorObj,i=a("./es5.js").keys,j=f.TypeError;return c.prototype.doFilter=function(a){for(var c=this._callback,e=this._promise,f=e._boundTo,i=0,j=this._instances.length;j>i;++i){var k=this._instances[i],l=k===Error||null!=k&&k.prototype instanceof Error;if(l&&a instanceof k){var m=g(c).call(f,a);return m===h?(b.e=m.e,b):m}if("function"==typeof k&&!l){var n=d(k,a);if(n===h){a=h.e;break}if(n){var m=g(c).call(f,a);return m===h?(b.e=m.e,b):m}}}return b.e=a,b},c}},{"./errors.js":10,"./es5.js":11,"./util.js":34}],8:[function(a,b){"use strict";var c=a("./util.js"),d=c.isPrimitive,e=c.wrapsPrimitiveReceiver;b.exports=function(a){var b=function(){return this},c=function(){throw this},f=function(a,b){return 1===b?function(){throw a}:2===b?function(){return a}:void 0};a.prototype["return"]=a.prototype.thenReturn=function(a){return e&&d(a)?this._then(f(a,2),void 0,void 0,void 0,void 0):this._then(b,void 0,void 0,a,void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return e&&d(a)?this._then(f(a,1),void 0,void 0,void 0,void 0):this._then(c,void 0,void 0,a,void 0)}}},{"./util.js":34}],9:[function(a,b){"use strict";b.exports=function(a,b){var c=a.reduce;a.prototype.each=function(a){return c(this,a,null,b)},a.each=function(a,d){return c(a,d,null,b)}}},{}],10:[function(a,b){"use strict";function c(a,b){function c(d){return this instanceof c?(j(this,"message","string"==typeof d?d:b),j(this,"name",a),void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new c(d)}return i(c,Error),c}function d(a){j(this,"name","OperationalError"),j(this,"message",a),this.cause=a,this.isOperational=!0,a instanceof Error?(j(this,"message",a.message),j(this,"stack",a.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var e,f,g=a("./es5.js").freeze,h=a("./util.js"),i=h.inherits,j=h.notEnumerableProp,k=c("CancellationError","cancellation error"),l=c("TimeoutError","timeout error"),m=c("AggregateError","aggregate error");try{e=TypeError,f=RangeError}catch(n){e=c("TypeError","type error"),f=c("RangeError","range error")}for(var o="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),p=0;p<o.length;++p)"function"==typeof Array.prototype[o[p]]&&(m.prototype[o[p]]=Array.prototype[o[p]]);m.prototype.length=0,m.prototype.isOperational=!0;var q=0;m.prototype.toString=function(){var a=Array(4*q+1).join(" "),b="\n"+a+"AggregateError of:\n";q++,a=Array(4*q+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return q--,b},i(d,Error);var r=Error.__BluebirdErrorTypes__;r||(r=g({CancellationError:k,TimeoutError:l,OperationalError:d,RejectionError:d,AggregateError:m}),j(Error,"__BluebirdErrorTypes__",r)),b.exports={Error:Error,TypeError:e,RangeError:f,CancellationError:r.CancellationError,OperationalError:r.OperationalError,TimeoutError:r.TimeoutError,AggregateError:r.AggregateError}},{"./es5.js":11,"./util.js":34}],11:[function(a,b){var c=function(){"use strict";return void 0===this}();if(c)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:c,propertyIsWritable:function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);return!(c&&!c.writable&&!c.set)}};else{var d={}.hasOwnProperty,e={}.toString,f={}.constructor.prototype,g=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},h=function(a,b,c){return a[b]=c.value,a},i=function(a){return a},j=function(a){try{return Object(a).constructor.prototype}catch(b){return f}},k=function(a){try{return"[object Array]"===e.call(a)}catch(b){return!1}};b.exports={isArray:k,keys:g,defineProperty:h,freeze:i,getPrototypeOf:j,isES5:c,propertyIsWritable:function(){return!0}}}},{}],12:[function(a,b){"use strict";b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],13:[function(a,b){"use strict";b.exports=function(b,c,d){function e(){return this}function f(){throw this}function g(a){return function(){return a}}function h(a){return function(){throw a}}function i(a,b,c){var d;return d=m&&n(b)?c?g(b):h(b):c?e:f,a._then(d,o,void 0,b,void 0)}function j(a){var e=this.promise,f=this.handler,g=e._isBound()?f.call(e._boundTo):f();if(void 0!==g){var h=d(g,e);if(h instanceof b)return h=h._target(),i(h,a,e.isFulfilled())}return e.isRejected()?(c.e=a,c):a}function k(a){var c=this.promise,e=this.handler,f=c._isBound()?e.call(c._boundTo,a):e(a);if(void 0!==f){var g=d(f,c);if(g instanceof b)return g=g._target(),i(g,a,!0)}return a}var l=a("./util.js"),m=l.wrapsPrimitiveReceiver,n=l.isPrimitive,o=l.thrower;b.prototype._passThroughHandler=function(a,b){if("function"!=typeof a)return this.then();var c={promise:this,handler:a};return this._then(b?j:k,b?j:void 0,void 0,c,void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThroughHandler(a,!0)},b.prototype.tap=function(a){return this._passThroughHandler(a,!1)}}},{"./util.js":34}],14:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a,c,d){for(var f=0;f<c.length;++f){d._pushContext();var g=m(c[f])(a);if(d._popContext(),g===l){d._pushContext();var h=b.reject(l.e);return d._popContext(),h}var i=e(g,d);if(i instanceof b)return i}return null}function g(a,c,e,f){var g=this._promise=new b(d);g._captureStackTrace(),this._stack=f,this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(n):n}var h=a("./errors.js"),i=h.TypeError,j=a("./util.js").deprecated,k=a("./util.js"),l=k.errorObj,m=k.tryCatch,n=[];g.prototype.promise=function(){return this._promise},g.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},g.prototype._continue=function(a){if(a===l){this._generator=void 0;var c=k.canAttachTrace(a.e)?a.e:new Error(k.toString(a.e));return this._promise._attachExtraTrace(c),void this._promise._reject(a.e,c)}var d=a.value;if(a.done===!0)this._generator=void 0,this._promise._tryFollow(d)||this._promise._fulfill(d);else{var g=e(d,this._promise);if(!(g instanceof b)&&(g=f(g,this._yieldHandlers,this._promise),null===g))return void this._throw(new i("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",d)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));g._then(this._next,this._throw,void 0,this,null)}},g.prototype._throw=function(a){k.canAttachTrace(a)&&this._promise._attachExtraTrace(a),this._promise._pushContext();var b=m(this._generator["throw"]).call(this._generator,a);this._promise._popContext(),this._continue(b)},g.prototype._next=function(a){this._promise._pushContext();var b=m(this._generator.next).call(this._generator,a);this._promise._popContext(),this._continue(b)},b.coroutine=function(a,b){if("function"!=typeof a)throw new i("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var c=Object(b).yieldHandler,d=g,e=(new Error).stack;return function(){var b=a.apply(this,arguments),f=new d(void 0,void 0,c,e);return f._generator=b,f._next(void 0),f.promise()}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new i("fn must be a function\n\n    See http://goo.gl/916lJJ\n");n.push(a)},b.spawn=function(a){if(j("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof a)return c("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var d=new g(a,this),e=d.promise();return d._run(b.spawn),e}}},{"./errors.js":10,"./util.js":34}],15:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){this._reject(a)}var g=a("./util.js"),h=g.canEvaluate,i=g.tryCatch,j=g.errorObj;if(h){for(var k=function(a){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,a))},l=function(a){for(var b=[],c=1;a>=c;++c)b.push("holder.p"+c);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,b.join(", ")))},m=[],n=[void 0],o=1;5>=o;++o)m.push(k(o)),n.push(l(o));var p=function(a,b){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=b,this.total=a,this.now=0};p.prototype.callers=n,p.prototype.checkFulfillment=function(a){var b=this.now;b++;var c=this.total;if(b>=c){var d=this.callers[c];a._pushContext();var e=i(d)(this);a._popContext(),e===j?a._rejectCallback(e.e,!1,!0):a._tryFollow(e)||a._fulfillUnchecked(e)}else this.now=b}}b.join=function(){var a,g=arguments.length-1;if(g>0&&"function"==typeof arguments[g]&&(a=arguments[g],6>g&&h)){var i=new b(e);i._captureStackTrace();for(var j=new p(g,a),k=m,l=0;g>l;++l){var n=d(arguments[l],i);n instanceof b?(n=n._target(),n._isPending()?n._then(k[l],f,void 0,i,j):n._isFulfilled()?k[l].call(i,n._value(),j):i._reject(n._reason())):k[l].call(i,n,j)}return i}for(var o=arguments.length,q=new Array(o),r=0;o>r;++r)q[r]=arguments[r];var i=new c(q).promise();return void 0!==a?i.spread(a):i}}},{"./util.js":34}],16:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,b,c,d){this.constructor$(a),this._promise._setIsSpreadable(),this._promise._captureStackTrace(),this._callback=b,this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=c>=1?[]:m,this._init$(void 0,-2)}function h(a,b,c,d){var e="object"==typeof c&&null!==c?c.concurrency:0;return e="number"==typeof e&&isFinite(e)&&e>=1?e:0,new g(a,b,e,d)}var i=a("./util.js"),j=i.tryCatch,k=i.errorObj,l={},m=[];i.inherits(g,c),g.prototype._init=function(){},g.prototype._promiseFulfilled=function(a,c){var d=this._values,f=this.length(),g=this._preservedValues,h=this._limit;if(d[c]===l){if(d[c]=a,h>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(h>=1&&this._inFlight>=h)return d[c]=a,void this._queue.push(c);null!==g&&(g[c]=a);var i=this._callback,m=this._promise._boundTo;this._promise._pushContext();var n=j(i).call(m,a,c,f);if(this._promise._popContext(),n===k)return this._reject(n.e);var o=e(n,this._promise);if(o instanceof b){if(o=o._target(),o._isPending())return h>=1&&this._inFlight++,d[c]=l,o._proxyPromiseArray(this,c);if(!o._isFulfilled())return this._reject(o._reason());n=o._value()}d[c]=n}var p=++this._totalResolved;p>=f&&(null!==g?this._filter(d,g):this._resolve(d))},g.prototype._drainQueue=function(){for(var a=this._queue,b=this._limit,c=this._values;a.length>0&&this._inFlight<b;){if(this._isResolved())return;var d=a.pop();this._promiseFulfilled(c[d],d)}},g.prototype._filter=function(a,b){for(var c=b.length,d=new Array(c),e=0,f=0;c>f;++f)a[f]&&(d[e++]=b[f]);d.length=e,this._resolve(d)},g.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return"function"!=typeof a?d("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):h(this,a,b,null).promise()},b.map=function(a,b,c,e){return"function"!=typeof b?d("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):h(a,b,c,e).promise()}}},{"./util.js":34}],17:[function(a,b){"use strict";b.exports=function(b){function c(a,b){var c=this;if(!f.isArray(a))return d.call(c,a,b);var e=h(b).apply(c._boundTo,[null].concat(a));e===i&&g.throwLater(e.e)}function d(a,b){var c=this,d=c._boundTo,e=void 0===a?h(b).call(d,null):h(b).call(d,null,a);e===i&&g.throwLater(e.e)}function e(a,b){var c=this;if(!a){var d=c._target(),e=d._getCarriedStackTrace();e.cause=a,a=e}var f=h(b).call(c._boundTo,a);f===i&&g.throwLater(f.e)}var f=a("./util.js"),g=a("./async.js"),h=f.tryCatch,i=f.errorObj;b.prototype.nodeify=function(a,b){if("function"==typeof a){var f=d;void 0!==b&&Object(b).spread&&(f=c),this._then(f,e,void 0,this,a)}return this}}},{"./async.js":2,"./util.js":34}],18:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./util.js"),e=a("./async.js"),f=d.tryCatch,g=d.errorObj;b.prototype.progressed=function(a){return this._then(void 0,void 0,a,void 0,void 0)},b.prototype._progress=function(a){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(a)},b.prototype._progressHandlerAt=function(a){return 0===a?this._progressHandler0:this[(a<<2)+a-5+2]},b.prototype._doProgressWith=function(a){var c=a.value,e=a.handler,h=a.promise,i=a.receiver,j=f(e).call(i,c);if(j===g){if(null!=j.e&&"StopProgressPropagation"!==j.e.name){var k=d.canAttachTrace(j.e)?j.e:new Error(d.toString(j.e));h._attachExtraTrace(k),h._progress(j.e)}}else j instanceof b?j._then(h._progress,null,null,h,void 0):h._progress(j)},b.prototype._progressUnchecked=function(a){for(var d=this._length(),f=this._progress,g=0;d>g;g++){var h=this._progressHandlerAt(g),i=this._promiseAt(g);if(i instanceof b)"function"==typeof h?e.invoke(this._doProgressWith,this,{handler:h,promise:i,receiver:this._receiverAt(g),value:a}):e.invoke(f,i,a);else{var j=this._receiverAt(g);"function"==typeof h?h.call(j,a,i):j instanceof c&&!j._isResolved()&&j._promiseProgressed(a,i)}}}}},{"./async.js":2,"./util.js":34}],19:[function(a,b){(function(c){"use strict";b.exports=function(){function b(a){if("function"!=typeof a)throw new p("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==b)throw new p("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,a!==t&&this._resolveFromResolver(a)}function d(){this._trace=new y(f())}function e(){return H?new d:void 0}function f(){var a=I.length-1;return a>=0?I[a]:void 0}var g,h,i=function(){return new p("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},j=function(){return new b.PromiseInspection(this._target())},k=function(a){return b.reject(new p(a))},l=a("./util.js"),m=a("./async.js"),n=a("./errors.js"),o=n.RangeError,p=n.TypeError,q=n.CancellationError,r=n.TimeoutError,s=n.OperationalError,t=function(){},u={},v={e:null},w=a("./thenables.js")(b,t),x=a("./promise_array.js")(b,t,w,k),y=a("./captured_trace.js")(),z=a("./catch_filter.js")(v),A=a("./promise_resolver.js"),B=l.isArray,C=l.errorObj,D=l.tryCatch,E=l.originatesFromRejection,F=l.markAsOriginatingFromRejection,G=l.canAttachTrace,H=!1||!("undefined"==typeof c||"string"!=typeof c.execPath||"object"!=typeof c.env||!c.env.BLUEBIRD_DEBUG&&"development"!==c.env.NODE_ENV);b.prototype.bind=function(a){var c=w(a),d=new b(t);d._propagateFrom(this,1);var e=this._target();return c instanceof b?(e._then(t,d._reject,d._progress,d,null),c._then(function(a){d._isPending()&&(d._setBoundTo(a),d._follow(e))},d._reject,d._progress,d,null)):(d._setBoundTo(a),d._follow(e)),d},b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype["catch"]=function(a){var c=arguments.length;if(c>1){var d,e=new Array(c-1),f=0;for(d=0;c-1>d;++d){var g=arguments[d];if("function"!=typeof g)return b.reject(new p("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));e[f++]=g}e.length=f,a=arguments[d];var h=new z(e,a,this);return this._then(void 0,h.doFilter,void 0,h,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},b.prototype.reflect=function(){return this._then(j,j,void 0,this,void 0)},b.prototype.then=function(a,b,c){return this._then(a,b,c,void 0,void 0)},b.prototype.done=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);d._setIsFinal()},b.prototype.spread=function(a,b){var c=this._target(),d=c._isSpreadable()?c===this?this:this.then():this.all();return d._then(a,b,void 0,u,void 0)},b.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},b.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},b.prototype.all=function(){var a=new x(this).promise();return a._setIsSpreadable(),a},b.prototype.error=function(a){return this.caught(E,a)},b.is=function(a){return a instanceof b},b.all=function(a){var b=new x(a).promise();return b._setIsSpreadable(),b},b.method=function(a){if("function"!=typeof a)throw new p("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var c=new b(t);c._captureStackTrace(),c._pushContext();var d=D(a).apply(this,arguments);return c._popContext(),c._resolveFromSyncValue(d),c}},b.attempt=b["try"]=function(a,c,d){if("function"!=typeof a)return k("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var e=new b(t);e._captureStackTrace(),e._pushContext();var f=B(c)?D(a).apply(d,c):D(a).call(d,c);return e._popContext(),e._resolveFromSyncValue(f),e},b.defer=b.pending=function(){var a=new b(t);return new A(a)},b.bind=function(a){var c=w(a),d=new b(t);return c instanceof b?c._then(function(a){d._setBoundTo(a),d._fulfill(void 0)},d._reject,d._progress,d,null):(d._setBoundTo(a),d._setFulfilled()),d},b.cast=function(a){var c=w(a);if(!(c instanceof b)){var d=c;c=new b(t),c._setFulfilled(),c._settledValue=d,c._cleanValues()}return c},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(a){var c=new b(t);return c._captureStackTrace(),c._rejectCallback(a,!0),c},b.onPossiblyUnhandledRejection=function(a){h="function"==typeof a?a:void 0},b.onUnhandledRejectionHandled=function(a){g="function"==typeof a?a:void 0},b.longStackTraces=function(){if(m.haveItemsQueued()&&H===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");H=y.isSupported()},b.hasLongStackTraces=function(){return H&&y.isSupported()},b.setScheduler=function(a){if("function"!=typeof a)throw new p("fn must be a function\n\n    See http://goo.gl/916lJJ\n");m._schedule=a},b.prototype._then=function(a,c,d,e,f){var g=void 0!==f,h=g?f:new b(t);g||(h._propagateFrom(this,5),h._captureStackTrace());var i=this._target();i!==this&&(void 0===e&&(e=this._boundTo),g||h._setIsMigrated());var j=i._addCallbacks(a,c,d,h,e);return i._isResolved()&&!i._isSettlePromisesQueued()&&m.invoke(i._settlePromiseAtPostResolution,i,j),h},b.prototype._settlePromiseAtPostResolution=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(a)},b.prototype._length=function(){return 131071&this._bitField},b.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},b.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},b.prototype._setLength=function(a){this._bitField=-131072&this._bitField|131071&a},b.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},b.prototype._setRejected=function(){this._bitField=134217728|this._bitField},b.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},b.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},b.prototype._isFinal=function(){return(33554432&this._bitField)>0},b.prototype._cancellable=function(){return(67108864&this._bitField)>0},b.prototype._setCancellable=function(){this._bitField=67108864|this._bitField
},b.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},b.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},b.prototype._isSpreadable=function(){return(131072&this._bitField)>0},b.prototype._setIsSpreadable=function(){this._bitField=131072|this._bitField},b.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},b.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},b.prototype._isMigrated=function(){return(4194304&this._bitField)>0},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},b.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},b.prototype._setCarriedStackTrace=function(a){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=a},b.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},b.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},b.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[5*a-5+4];return this._isBound()&&void 0===b?this._boundTo:b},b.prototype._promiseAt=function(a){return 0===a?this._promise0:this[5*a-5+3]},b.prototype._fulfillmentHandlerAt=function(a){return 0===a?this._fulfillmentHandler0:this[5*a-5+0]},b.prototype._rejectionHandlerAt=function(a){return 0===a?this._rejectionHandler0:this[5*a-5+1]},b.prototype._migrateCallbacks=function(a,c,d,e,f){e instanceof b&&e._setIsMigrated(),this._addCallbacks(a,c,d,e,f)},b.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=131066&&(f=0,this._setLength(0)),0===f)this._promise0=d,void 0!==e&&(this._receiver0=e),"function"!=typeof a||this._isCarryingStackTrace()||(this._fulfillmentHandler0=a),"function"==typeof b&&(this._rejectionHandler0=b),"function"==typeof c&&(this._progressHandler0=c);else{var g=5*f-5;this[g+3]=d,this[g+4]=e,"function"==typeof a&&(this[g+0]=a),"function"==typeof b&&(this[g+1]=b),"function"==typeof c&&(this[g+2]=c)}return this._setLength(f+1),f},b.prototype._setProxyHandlers=function(a,b){var c=this._length();if(c>=131066&&(c=0,this._setLength(0)),0===c)this._promise0=b,this._receiver0=a;else{var d=5*c-5;this[d+3]=b,this[d+4]=a}this._setLength(c+1)},b.prototype._proxyPromiseArray=function(a,b){this._setProxyHandlers(a,b)},b.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=8388608|this._bitField,this._boundTo=a):this._bitField=-8388609&this._bitField},b.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},b.prototype._resolveCallback=function(a){this._tryFollow(a)||this._fulfill(a)},b.prototype._rejectCallback=function(a,b,c){c||F(a);var d=l.ensureErrorObject(a),e=G(a)&&"string"==typeof d.stack;this._attachExtraTrace(d,b?e:!1),this._reject(a,d===a?void 0:d)},b.prototype._resolveFromResolver=function(a){var b=this;this._captureStackTrace(),this._pushContext();var c=!0,d=D(a)(function(a){b._resolveCallback(a)},function(a){b._rejectCallback(a,c)});c=!1,this._popContext(),void 0!==d&&d===C&&b._rejectCallback(d.e,!0,!0)},b.prototype._settlePromiseFromHandler=function(a,b,c,d){if(!d._isRejected()){d._pushContext();var e;if(e=b!==u||this._isRejected()?D(a).call(b,c):D(a).apply(this._boundTo,c),d._popContext(),e===C||e===d||e===v){var f=e===d?i():e.e;d._rejectCallback(f,!1,!0)}else d._resolveCallback(e)}},b.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},b.prototype._followee=function(){return this._rejectionHandler0},b.prototype._setFollowee=function(a){this._rejectionHandler0=a},b.prototype._follow=function(a){if(a._isPending()){for(var b=this._length(),c=0;b>c;++c)a._migrateCallbacks(this._fulfillmentHandlerAt(c),this._rejectionHandlerAt(c),this._progressHandlerAt(c),this._promiseAt(c),this._receiverAt(c));this._setFollowing(),this._setLength(0),this._setFollowee(a),this._propagateFrom(a,1)}else a._isFulfilled()?this._fulfillUnchecked(a._value()):this._rejectUnchecked(a._reason(),a._getCarriedStackTrace());a._isRejectionUnhandled()&&a._unsetRejectionIsUnhandled()},b.prototype._tryFollow=function(a){if(this._isFollowingOrFulfilledOrRejected()||a===this)return!1;var c=w(a,this);return c instanceof b?(this._follow(c._target()),!0):!1},b.prototype._captureStackTrace=function(){return H&&(this._trace=new y(this._peekContext())),this},b.prototype._canAttachTrace=function(a){return H&&G(a)},b.prototype._attachExtraTraceIgnoreSelf=function(a){this._canAttachTrace(a)&&void 0!==this._trace._parent&&this._trace._parent.attachExtraTrace(a)},b.prototype._attachExtraTrace=function(a,b){if(H&&G(a)){var c=this._trace;void 0!==c&&b&&(c=c._parent),void 0!==c?c.attachExtraTrace(a):y.cleanHeaderStack(a,!0)}},b.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},b.prototype._propagateFrom=function(a,b){(1&b)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(4&b)>0&&this._setBoundTo(a._boundTo)},b.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},b.prototype._reject=function(a,b){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,b)},b.prototype._settlePromiseAt=function(a){var c=this._promiseAt(a),d=c instanceof b;if(d&&c._isMigrated())return c._unsetIsMigrated(),m.invoke(this._settlePromiseAt,this,a);var e=this._isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),f=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,g=this._settledValue,h=this._receiverAt(a);this._clearCallbackDataAtIndex(a),"function"==typeof e?d?this._settlePromiseFromHandler(e,h,g,c):e.call(h,g,c):h instanceof x?h._isResolved()||(this._isFulfilled()?h._promiseFulfilled(g,c):h._promiseRejected(g,c)):d&&(this._isFulfilled()?c._fulfill(g):c._reject(g,f)),a>=4&&4===(31&a)&&m.invokeLater(this._setLength,this,0)},b.prototype._clearCallbackDataAtIndex=function(a){if(0===a)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var b=5*a-5;this[b+3]=this[b+4]=this[b+0]=this[b+1]=this[b+2]=void 0}},b.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},b.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},b.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},b.prototype._queueSettlePromises=function(){this._isSettlePromisesQueued()||(m.settlePromises(this),this._setSettlePromisesQueued())},b.prototype._fulfillUnchecked=function(a){if(a===this){var b=i();return this._attachExtraTrace(b),this._rejectUnchecked(b,void 0)}this._setFulfilled(),this._settledValue=a,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},b.prototype._rejectUncheckedCheckError=function(a){var b=l.ensureErrorObject(a);this._rejectUnchecked(a,b===a?void 0:b)},b.prototype._rejectUnchecked=function(a,b){if(a===this){var c=i();return this._attachExtraTrace(c),this._rejectUnchecked(c)}return this._setRejected(),this._settledValue=a,this._cleanValues(),this._isFinal()?void m.throwLater(function(a){throw"stack"in a&&m.invokeFirst(y.unhandledRejection,void 0,a),a},void 0===b?a:b):(void 0!==b&&b!==a&&this._setCarriedStackTrace(b),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},b.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var a=this._length(),b=0;a>b;b++)this._settlePromiseAt(b)},b.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),m.invokeLater(this._notifyUnhandledRejection,this,void 0)},b.prototype._notifyUnhandledRejectionIsHandled=function(){y.fireRejectionEvent("rejectionHandled",g,void 0,this)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),y.fireRejectionEvent("unhandledRejection",h,a,this)}};var I=[];return d.prototype._pushContext=function(){H&&void 0!==this._trace&&I.push(this._trace)},d.prototype._popContext=function(){H&&void 0!==this._trace&&I.pop()},b.prototype._peekContext=f,b.prototype._pushContext=d.prototype._pushContext,b.prototype._popContext=d.prototype._popContext,b.prototype._resolveFromSyncValue=function(a){if(a===C){this._setRejected();var c=a.e;this._settledValue=c,this._cleanValues(),this._attachExtraTrace(c),this._ensurePossibleRejectionHandled()}else{var d=w(a,this);d instanceof b?(d=d._target(),this._follow(d)):(this._setFulfilled(),this._settledValue=a,this._cleanValues())}},y.isSupported()||(b.longStackTraces=function(){},H=!1),b._makeSelfResolutionError=i,a("./finally.js")(b,v,w),a("./direct_resolve.js")(b),a("./synchronous_inspection.js")(b),a("./join.js")(b,x,w,t),b.RangeError=o,b.CancellationError=q,b.TimeoutError=r,b.TypeError=p,b.OperationalError=s,b.RejectionError=s,b.AggregateError=n.AggregateError,l.toFastProperties(b),l.toFastProperties(b.prototype),b.Promise=b,y.setBounds(m.firstLineError,l.lastLineError),a("./nodeify.js")(b),a("./using.js")(b,k,w,e),a("./generators.js")(b,k,t,w),a("./map.js")(b,x,k,w,t),a("./cancel.js")(b,t),a("./promisify.js")(b,t),a("./props.js")(b,x,w,k),a("./race.js")(b,t,w,k),a("./reduce.js")(b,x,k,w,t),a("./settle.js")(b,x),a("./call_get.js")(b),a("./some.js")(b,x,k),a("./progress.js")(b,x),a("./any.js")(b),a("./each.js")(b,t),a("./timers.js")(b,t,w),a("./filter.js")(b,t),b.prototype=b.prototype,b}}).call(this,a("_process"))},{"./any.js":1,"./async.js":2,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./each.js":9,"./errors.js":10,"./filter.js":12,"./finally.js":13,"./generators.js":14,"./join.js":15,"./map.js":16,"./nodeify.js":17,"./progress.js":18,"./promise_array.js":20,"./promise_resolver.js":21,"./promisify.js":22,"./props.js":23,"./race.js":25,"./reduce.js":26,"./settle.js":28,"./some.js":29,"./synchronous_inspection.js":30,"./thenables.js":31,"./timers.js":32,"./using.js":33,"./util.js":34,_process:38}],20:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){switch(a){case-1:return void 0;case-2:return[];case-3:return{}}}function g(a){var d,e=this._promise=new b(c);a instanceof b&&(d=a,e._propagateFrom(d,5)),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var h=a("./util.js"),i=h.isArray;return g.prototype.length=function(){return this._length},g.prototype.promise=function(){return this._promise},g.prototype._init=function j(a,c){var g=d(this._values,this._promise);if(g instanceof b){if(g._setBoundTo(this._promise._boundTo),g=g._target(),this._values=g,!g._isFulfilled())return g._isPending()?void g._then(j,this._reject,void 0,this,c):void this._reject(g._reason());if(g=g._value(),!i(g)){var h=new b.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(h)}}else if(!i(g))return void this._promise._follow(e("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n"));if(0===g.length)return void(-5===c?this._resolveEmptyArray():this._resolve(f(c)));var k=this.getActualLength(g.length);this._length=k,this._values=this.shouldCopyValues()?new Array(k):this._values;for(var l=this._promise,m=0;k>m;++m){var n=this._isResolved(),o=d(g[m],l);o instanceof b?(o=o._target(),n?o._unsetRejectionIsUnhandled():o._isPending()?o._proxyPromiseArray(this,m):o._isFulfilled()?this._promiseFulfilled(o._value(),m):this._promiseRejected(o._reason(),m)):n||this._promiseFulfilled(o,m)}},g.prototype._isResolved=function(){return null===this._values},g.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},g.prototype.__hardReject__=g.prototype._reject=function(a){this._values=null,this._promise._rejectCallback(a,!1,!0)},g.prototype._promiseProgressed=function(a,b){this._promise._progress({index:b,value:a})},g.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},g.prototype._promiseRejected=function(a){this._totalResolved++,this._reject(a)},g.prototype.shouldCopyValues=function(){return!0},g.prototype.getActualLength=function(a){return a},g}},{"./util.js":34}],21:[function(a,b){"use strict";function c(a){return a instanceof Error&&m.getPrototypeOf(a)===Error.prototype}function d(a){var b;if(c(a)){b=new k(a),b.name=a.name,b.message=a.message,b.stack=a.stack;for(var d=m.keys(a),e=0;e<d.length;++e){var f=d[e];n.test(f)||(b[f]=a[f])}return b}return g.markAsOriginatingFromRejection(a),a}function e(a){return function(b,c){if(null!==a){if(b){var e=d(h(b));a._attachExtraTrace(e),a._reject(e)}else if(arguments.length>2){for(var f=arguments.length,g=new Array(f-1),i=1;f>i;++i)g[i-1]=arguments[i];a._fulfill(g)}else a._fulfill(c);a=null}}}var f,g=a("./util.js"),h=g.maybeWrapAsError,i=a("./errors.js"),j=i.TimeoutError,k=i.OperationalError,l=g.haveGetters,m=a("./es5.js"),n=/^(?:name|message|stack|cause)$/;if(f=l?function(a){this.promise=a}:function(a){this.promise=a,this.asCallback=e(a),this.callback=this.asCallback},l){var o={get:function(){return e(this.promise)}};m.defineProperty(f.prototype,"asCallback",o),m.defineProperty(f.prototype,"callback",o)}f._nodebackForPromise=e,f.prototype.toString=function(){return"[object PromiseResolver]"},f.prototype.resolve=f.prototype.fulfill=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._resolveCallback(a)},f.prototype.reject=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(a)},f.prototype.progress=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(a)},f.prototype.cancel=function(){this.promise.cancel()},f.prototype.timeout=function(){this.reject(new j("timeout"))},f.prototype.isResolved=function(){return this.promise.isResolved()},f.prototype.toJSON=function(){return this.promise.toJSON()},b.exports=f},{"./errors.js":10,"./es5.js":11,"./util.js":34}],22:[function(a,b){"use strict";b.exports=function(b,c){function d(a){return a.replace(/([$])/,"\\$")}function e(a){try{return a.__isPromisified__===!0}catch(b){return!1}}function f(a,b,c){var d=s.getDataPropertyOrDefault(a,b+c,A);return d?e(d):!1}function g(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d];if(c.test(e))for(var f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new x("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",b))}}function h(a,b,c,d){for(var h=s.inheritedDataKeys(a),i=[],j=0;j<h.length;++j){var k=h[j],l=a[k],m=d===z?!0:z(k,l,a);"function"!=typeof l||e(l)||f(a,k,b)||!d(k,l,a,m)||i.push(k,l)}return g(i,b,c),i}function i(a){for(var b=[a],c=Math.max(0,a-1-5),d=a-1;d>=c;--d)d!==a&&b.push(d);for(var d=a+1;5>=d;++d)b.push(d);return b}function j(a){return s.filledRange(a,"arguments[","]")}function k(a){return s.filledRange(a,"_arg","")}function l(a){return"number"==typeof a.length?Math.max(Math.min(a.length,1024),0):0}function m(a){return s.isIdentifier(a)?"."+a:"['"+a.replace(/(['\\])/g,"\\$1")+"']"}function n(a,d,e,f,g){function h(b){var c,e=j(b).join(", "),f=b>0?", ":"";return c="string"==typeof a?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",m(a)):d===r?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==d?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",c.replace("{{args}}",e).replace(", ",f)}function n(){for(var b="",c=0;c<p.length;++c)b+="case "+p[c]+":"+h(p[c]);var e;return e="string"==typeof a?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",m(a)):d===r?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",b+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",e)}var o=Math.max(0,l(f)-1),p=i(o),q="string"==typeof e&&s.isIdentifier(e)?e+g:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function (Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            promise._setIsSpreadable();                                      \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",q).replace("Parameters",k(o)).replace("[CodeForSwitchCase]",n()))(b,a,d,u,v,t,c)}function o(a,d){function e(){var e=d;d===r&&(e=this),"string"==typeof a&&(a=e[a]);var f=new b(c);f._captureStackTrace(),f._setIsSpreadable();var g=t(f);try{a.apply(e,u(arguments,g))}catch(h){var i=v(h);f._attachExtraTrace(i),f._reject(i)}return f}return e.__isPromisified__=!0,e}function p(a,b,c,e){for(var f=new RegExp(d(b)+"$"),g=h(a,b,f,c),i=0,j=g.length;j>i;i+=2){var k=g[i],l=g[i+1],m=k+b;a[m]=e===B?B(k,r,k,l,b):e(l,function(){return B(k,r,k,l,b)})}return s.toFastProperties(a),a}function q(a,b){return B(a,b,void 0,a)}var r={},s=a("./util.js"),t=a("./promise_resolver.js")._nodebackForPromise,u=s.withAppended,v=s.maybeWrapAsError,w=s.canEvaluate,x=a("./errors").TypeError,y="Async",z=function(a,b){return s.isIdentifier(a)&&"_"!==a.charAt(0)&&!s.isClass(b)},A={__isPromisified__:!0},B=w?n:o;b.promisify=function(a,b){if("function"!=typeof a)throw new x("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return e(a)?a:q(a,arguments.length<2?r:b)},b.promisifyAll=function(a,b){if("function"!=typeof a&&"object"!=typeof a)throw new x("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");b=Object(b);var c=b.suffix;"string"!=typeof c&&(c=y);var d=b.filter;"function"!=typeof d&&(d=z);var e=b.promisifier;if("function"!=typeof e&&(e=B),!s.isIdentifier(c))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var f=s.inheritedDataKeys(a,{includeHidden:!0}),g=0;g<f.length;++g){var h=a[f[g]];"constructor"!==f[g]&&s.isClass(h)&&(p(h.prototype,c,d,e),p(h,c,d,e))}return p(a,c,d,e)}}},{"./errors":10,"./promise_resolver.js":21,"./util.js":34}],23:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){for(var b=j.keys(a),c=b.length,d=new Array(2*c),e=0;c>e;++e){var f=b[e];d[e]=a[f],d[e+c]=f}this.constructor$(d)}function g(a){var c,g=d(a);return i(g)?(c=g instanceof b?g._then(b.props,void 0,void 0,void 0,void 0):new f(g).promise(),g instanceof b&&c._propagateFrom(g,4),c):e("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var h=a("./util.js"),i=h.isObject,j=a("./es5.js");h.inherits(f,c),f.prototype._init=function(){this._init$(void 0,-3)},f.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){for(var d={},e=this.length(),f=0,g=this.length();g>f;++f)d[this._values[f+e]]=this._values[f];this._resolve(d)}},f.prototype._promiseProgressed=function(a,b){this._promise._progress({key:this._values[b+this.length()],value:a})},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return g(this)},b.props=function(a){return g(a)}}},{"./es5.js":11,"./util.js":34}],24:[function(a,b){"use strict";function c(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b],a[f+b]=void 0}function d(a){this._capacity=a,this._length=0,this._front=0}d.prototype._willBeOverCapacity=function(a){return this._capacity<a},d.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},d.prototype._unshiftOne=function(a){var b=this._capacity;this._checkCapacity(this.length()+1);var c=this._front,d=(c-1&b-1^b)-b;this[d]=a,this._front=d,this._length=this.length()+1},d.prototype.unshift=function(a,b,c){this._unshiftOne(c),this._unshiftOne(b),this._unshiftOne(a)},d.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},d.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},d.prototype.length=function(){return this._length},d.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<1)},d.prototype._resizeTo=function(a){var b=this._capacity;this._capacity=a;var d=this._front,e=this._length;if(d+e>b){var f=d+e&b-1;c(this,0,this,b,f)}},b.exports=d},{}],25:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a,f){var i=d(a);if(i instanceof b)return h(i);if(!g(a))return e("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var j=new b(c);void 0!==f&&j._propagateFrom(f,5);for(var k=j._fulfill,l=j._reject,m=0,n=a.length;n>m;++m){var o=a[m];(void 0!==o||m in a)&&b.cast(o)._then(k,l,void 0,j,null)}return j}var g=a("./util.js").isArray,h=function(a){return a.then(function(b){return f(b,a)})};b.race=function(a){return f(a,void 0)},b.prototype.race=function(){return f(this,void 0)}}},{"./util.js":34}],26:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,c,d,g){this.constructor$(a),this._promise._captureStackTrace(),this._preservedValues=g===f?[]:null,this._zerothIsAccum=void 0===d,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var h=e(d,this._promise),i=!1,j=h instanceof b;j&&(h=h._target(),h._isPending()?h._proxyPromiseArray(this,-1):h._isFulfilled()?(d=h._value(),this._gotAccum=!0):(this._reject(h._reason()),i=!0)),j||this._zerothIsAccum||(this._gotAccum=!0),this._callback=c,this._accum=d,i||this._init$(void 0,-5)}function h(a,b,c,e){if("function"!=typeof b)return d("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var f=new g(a,b,c,e);return f.promise()}var i=a("./util.js"),j=i.tryCatch,k=i.errorObj;i.inherits(g,c),g.prototype._init=function(){},g.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},g.prototype._promiseFulfilled=function(a,c){var d=this._values;d[c]=a;var f,g=this.length(),h=this._preservedValues,i=null!==h,l=this._gotAccum,m=this._valuesPhase;if(!m)for(m=this._valuesPhase=Array(g),f=0;g>f;++f)m[f]=0;if(f=m[c],0===c&&this._zerothIsAccum?(l||(this._accum=a,this._gotAccum=l=!0),m[c]=0===f?1:2):-1===c?l||(this._accum=a,this._gotAccum=l=!0):0===f?m[c]=1:(m[c]=2,l&&(this._accum=a)),l){for(var n,o=this._callback,p=this._promise._boundTo,q=this._reducingIndex;g>q;++q)if(f=m[q],2!==f){if(1!==f)return;if(a=d[q],a instanceof b){if(a=a._target(),!a._isFulfilled())return a._isPending()?void 0:this._reject(a._reason());a=a._value()}if(this._promise._pushContext(),i?(h.push(a),n=j(o).call(p,a,q,g)):n=j(o).call(p,this._accum,a,q,g),this._promise._popContext(),n===k)return this._reject(n.e);var r=e(n,this._promise);if(r instanceof b){if(r=r._target(),r._isPending())return m[q]=4,r._proxyPromiseArray(this,q);if(!r._isFulfilled())return this._reject(r._reason());n=r._value()}this._reducingIndex=q+1,this._accum=n}else this._reducingIndex=q+1;this._reducingIndex<g||this._resolve(i?h:this._accum)}},b.prototype.reduce=function(a,b){return h(this,a,b,null)},b.reduce=function(a,b,c,d){return h(a,b,c,d)}}},{"./util.js":34}],27:[function(a,b){(function(a){"use strict";var c;"object"==typeof a&&"string"==typeof a.version?c=parseInt(a.version.split(".")[1],10)>10?setImmediate:a.nextTick:"undefined"!=typeof MutationObserver?(c=function(a){var b=document.createElement("div"),c=new MutationObserver(a);return c.observe(b,{attributes:!0}),function(){b.classList.toggle("foo")}},c.isStatic=!0):c="undefined"!=typeof setTimeout?function(a){setTimeout(a,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")},b.exports=c}).call(this,a("_process"))},{_process:38}],28:[function(a,b){"use strict";b.exports=function(b,c){function d(a){this.constructor$(a),this._promise._setIsSpreadable()}var e=b.PromiseInspection,f=a("./util.js");f.inherits(d,c),d.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},d.prototype._promiseFulfilled=function(a,b){var c=new e;c._bitField=268435456,c._settledValue=a,this._promiseResolved(b,c)},d.prototype._promiseRejected=function(a,b){var c=new e;c._bitField=134217728,c._settledValue=a,this._promiseResolved(b,c)},b.settle=function(a){return new d(a).promise()},b.prototype.settle=function(){return new d(this).promise()}}},{"./util.js":34}],29:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(a,b){if((0|b)!==b||0>b)return d("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var c=new e(a),f=c.promise();return f.isRejected()?f:(c.setHowMany(b),c.init(),f)}var g=a("./util.js"),h=a("./errors.js").RangeError,i=a("./errors.js").AggregateError,j=g.isArray;g.inherits(e,c),e.prototype._init=function(){if(this._initialized){if(this._promise._setIsSpreadable(),0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=j(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},e.prototype.init=function(){this._initialized=!0,this._init()},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(a){this._isResolved()||(this._howMany=a)},e.prototype._promiseFulfilled=function(a){this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values))},e.prototype._promiseRejected=function(a){if(this._addRejected(a),this.howMany()>this._canPossiblyFulfill()){for(var b=new i,c=this.length();c<this._values.length;++c)b.push(this._values[c]);this._reject(b)}},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()},e.prototype._addRejected=function(a){this._values.push(a)},e.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new h(b)},e.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return f(a,b)},b.prototype.some=function(a){return f(this,a)},b._SomePromiseArray=e}},{"./errors.js":10,"./util.js":34}],30:[function(a,b){"use strict";b.exports=function(a){function b(a){void 0!==a?(a=a._target(),this._bitField=a._bitField,this._settledValue=a._settledValue):(this._bitField=0,this._settledValue=void 0)}b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},b.prototype.isFulfilled=a.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},b.prototype.isRejected=a.prototype._isRejected=function(){return(134217728&this._bitField)>0},b.prototype.isPending=a.prototype._isPending=function(){return 0===(402653184&this._bitField)},b.prototype.isResolved=a.prototype._isResolved=function(){return(402653184&this._bitField)>0},a.prototype.isPending=function(){return this._target()._isPending()},a.prototype.isRejected=function(){return this._target()._isRejected()},a.prototype.isFulfilled=function(){return this._target()._isFulfilled()},a.prototype.isResolved=function(){return this._target()._isResolved()
},a.prototype._value=function(){return this._settledValue},a.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},a.prototype.value=function(){var a=this._target();if(!a.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return a._settledValue},a.prototype.reason=function(){var a=this._target();if(!a.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return a._settledValue},a.PromiseInspection=b}},{}],31:[function(a,b){"use strict";b.exports=function(b,c){function d(a,d){if(j(a)){if(a instanceof b)return a;if(f(a)){var k=new b(c);return a._then(k._fulfillUnchecked,k._rejectUncheckedCheckError,k._progressUnchecked,k,null),k}var l=h.tryCatch(e)(a);if(l===i){d&&d._pushContext();var k=b.reject(l.e);return d&&d._popContext(),k}if("function"==typeof l)return g(a,l,d)}return a}function e(a){return a.then}function f(a){return k.call(a,"_promise0")}function g(a,d,e){function f(c){return a===c?k._rejectCallback(b._makeSelfResolutionError(),!1,!0):void k._resolveCallback(c)}function g(a){k._rejectCallback(a,l,!0)}function j(a){"function"==typeof k._progress&&k._progress(a)}var k=new b(c);e&&e._pushContext(),k._captureStackTrace(),e&&e._popContext();var l=!0,m=h.tryCatch(d).call(a,f,g,j);return l=!1,m===i&&k._rejectCallback(m.e,!0,!0),k}var h=a("./util.js"),i=h.errorObj,j=h.isObject,k={}.hasOwnProperty;return d}},{"./util.js":34}],32:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){var b=this;return b instanceof Number&&(b=+b),clearTimeout(b),a}function f(a){var b=this;throw b instanceof Number&&(b=+b),clearTimeout(b),a}var g=a("./util.js"),h=b.TimeoutError,i=function(a,b){if(a.isPending()){"string"!=typeof b&&(b="operation timed out");var c=new h(b);g.markAsOriginatingFromRejection(c),a._attachExtraTrace(c),a._cancel(c)}},j=function(a,b){b._fulfill(a)},k=b.delay=function(a,e){void 0===e&&(e=a,a=void 0),e=+e;var f=d(a),g=new b(c);return f instanceof b?(g._propagateFrom(f,5),g._follow(f._target()),g.then(function(a){return b.delay(a,e)})):(setTimeout(function(){j(a,g)},e),g)};b.prototype.delay=function(a){return k(this,a)},b.prototype.timeout=function(a,d){var g=this._target();a=+a;var h=new b(c).cancellable();h._propagateFrom(this,5),h._follow(g);var j=setTimeout(function(){i(h,d)},a);return h._then(e,f,void 0,j,void 0)}}},{"./util.js":34}],33:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){for(var c=a.length,d=0;c>d;++d){var e=a[d];if(e.isRejected())return b.reject(e.error());a[d]=e._settledValue}return a}function g(a){setTimeout(function(){throw a},0)}function h(a){var b=d(a);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function i(a,c){function e(){if(f>=i)return j.resolve();var k=h(a[f++]);if(k instanceof b&&k._isDisposable()){try{k=d(k._getDisposer().tryDispose(c),a.promise)}catch(l){return g(l)}if(k instanceof b)return k._then(e,g,null,null,null)}e()}var f=0,i=a.length,j=b.defer();return e(),j.promise}function j(a){var b=new q;return b._settledValue=a,b._bitField=268435456,i(this,b).thenReturn(a)}function k(a){var b=new q;return b._settledValue=a,b._bitField=134217728,i(this,b).thenThrow(a)}function l(a,b,c){this._data=a,this._promise=b,this._context=c}function m(a,b){this.constructor$(a,b)}function n(a){return l.isDisposer(a)?(this.resources[this.index]._setDisposable(a),a.promise()):a}var o=a("./errors.js").TypeError,p=a("./util.js").inherits,q=b.PromiseInspection;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(a){var b=this.resource(),c=this._context;void 0!==c&&c._pushContext();var d=null!==b?this.doDispose(b,a):null;return void 0!==c&&c._popContext(),this._promise._unsetDisposable(),this._data=null,d},l.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},p(m,l),m.prototype.doDispose=function(a,b){var c=this.data();return c.call(a,a,b)},b.using=function(){var a=arguments.length;if(2>a)return c("you must pass at least 2 arguments to Promise.using");var e=arguments[a-1];if("function"!=typeof e)return c("fn must be a function\n\n    See http://goo.gl/916lJJ\n");a--;for(var g=new Array(a),h=0;a>h;++h){var i=arguments[h];if(l.isDisposer(i)){var m=i;i=i.promise(),i._setDisposable(m)}else{var o=d(i);o instanceof b&&(i=o._then(n,null,null,{resources:g,index:h},void 0))}g[h]=i}var p=b.settle(g).then(f).then(function(a){p._pushContext();var b;try{b=e.apply(void 0,a)}finally{p._popContext()}return b})._then(j,k,void 0,g,void 0);return g.promise=p,p},b.prototype._setDisposable=function(a){this._bitField=262144|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(262144&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new m(a,this,e());throw new o}}},{"./errors.js":10,"./util.js":34}],34:[function(a,b,c){"use strict";function d(){try{return z.apply(this,arguments)}catch(a){return y.e=a,y}}function e(a){return z=a,d}function f(a){return"string"==typeof a?a:""+a}function g(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function h(a){return!g(a)}function i(a){return g(a)?new Error(f(a)):a}function j(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function k(a,b,c){if(!v.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function l(a,b,c){if(g(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return v.defineProperty(a,b,d),a}function m(a){throw a}function n(a){try{if("function"==typeof a){var b=v.keys(a.prototype);return b.length>0&&!(1===b.length&&"constructor"===b[0])}return!1}catch(c){return!1}}function o(a){function b(){}return b.prototype=a,b}function p(a){return D.test(a)}function q(a,b,c){for(var d=new Array(a),e=0;a>e;++e)d[e]=b+e+c;return d}function r(a){try{return a+""}catch(b){return"[no string representation]"}}function s(a){try{l(a,"isOperational",!0)}catch(b){}}function t(a){return null==a?!1:a instanceof Error.__BluebirdErrorTypes__.OperationalError||a.isOperational===!0}function u(a){return a instanceof Error&&v.propertyIsWritable(a,"stack")}var v=a("./es5.js"),w="undefined"==typeof navigator,x=function(){try{var a={};return v.defineProperty(a,"f",{get:function(){return 3}}),3===a.f}catch(b){return!1}}(),y={e:{}},z,A=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},B=function(){return"string"!==this}.call("string"),C=function(){return v.isES5?function(a,b){for(var c=[],d=Object.create(null),e=Object(b).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=a;){var f;try{f=e(a)}catch(g){return c}for(var h=0;h<f.length;++h){var i=f[h];if(!d[i]){d[i]=!0;var j=Object.getOwnPropertyDescriptor(a,i);null!=j&&null==j.get&&null==j.set&&c.push(i)}}a=v.getPrototypeOf(a)}return c}:function(a){var b=[];for(var c in a)b.push(c);return b}}(),D=/^[a-z$_][a-z$_0-9]*$/i,E=function(){return"stack"in new Error?function(a){return u(a)?a:new Error(r(a))}:function(a){if(u(a))return a;try{throw new Error(r(a))}catch(b){return b}}}(),F={isClass:n,isIdentifier:p,inheritedDataKeys:C,getDataPropertyOrDefault:k,thrower:m,isArray:v.isArray,haveGetters:x,notEnumerableProp:l,isPrimitive:g,isObject:h,canEvaluate:w,errorObj:y,tryCatch:e,inherits:A,withAppended:j,asString:f,maybeWrapAsError:i,wrapsPrimitiveReceiver:B,toFastProperties:o,filledRange:q,toString:r,canAttachTrace:u,ensureErrorObject:E,originatesFromRejection:t,markAsOriginatingFromRejection:s};try{throw new Error}catch(G){F.lastLineError=G}b.exports=F},{"./es5.js":11}],35:[function(a,b){function c(a){d.call(this),a=a||{},this.states=a.states||["default"],this.currentState=a.defaultState||this.states[0],this.history=[],this.configs={},this.events=[];var b=this;this.on("transition",function(a){b.events.forEach(function(c){c.from===a.from&&c.to===a.to&&b.emit(c.event)})})}var d=a("events").EventEmitter;c.prototype=Object.create(d.prototype),c.prototype.setState=function(a){var b=this.currentState;if(!this._validate(b,a))return!1;this.history.push({state:b,args:this.currentArgs});var c=arguments.length>1?[].slice.call(arguments,1):null;return this.currentArgs=c,this.currentState=a,this._emit(b,a,c),!0},c.prototype.back=function(){if(!this.history.length)return!1;var a=this.history[this.history.length-1],b=this.currentState,c=a.state,d=a.args;return this._validate(b,c)?(this.history.pop(),this.currentState=c,this.currentArgs=d,this._emit(b,c,d,!0),!0):!1},c.prototype.lock=function(){this.locked=!0},c.prototype.unlock=function(){this.locked=!1},c.prototype.config=function(a,b){b.to=b.to||{},b.from=b.from||{},this.configs[a]=b},c.prototype.register=function(a,b){this.events.push({event:a,from:b.from,to:b.to})},c.prototype._emit=function(a,b,c,d){var e={from:a,to:b,args:c,back:d};this.emit("transition",e),this.emit("leave:"+a,e),this.emit("enter:"+b,e)},c.prototype._validate=function(a,b){if(!(this.locked||a===b||this.states.indexOf(b)<0)){var c=this.configs[a];if(c)if(c.to.only){if(c.to.only.indexOf(b)<0)return}else if(c.to.exclude&&c.to.exclude.indexOf(b)>-1)return;var d=this.configs[b];if(d)if(d.from.only){if(d.from.only.indexOf(a)<0)return}else if(d.from.exclude&&d.from.exclude.indexOf(a)>-1)return;return!0}},b.exports=c},{events:37}],36:[function(){},{}],37:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],38:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],39:[function(a,b,c){(function(a){!function(d){function e(a){throw RangeError(H[a])}function f(a,b){for(var c=a.length;c--;)a[c]=b(a[c]);return a}function g(a,b){return f(a.split(G),b).join(".")}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function i(a){return f(a,function(a){var b="";return a>65535&&(a-=65536,b+=K(a>>>10&1023|55296),a=56320|1023&a),b+=K(a)}).join("")}function j(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:w}function k(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function l(a,b,c){var d=0;for(a=c?J(a/A):a>>1,a+=J(a/b);a>I*y>>1;d+=w)a=J(a/I);return J(d+(I+1)*a/(a+z))}function m(a){var b,c,d,f,g,h,k,m,n,o,p=[],q=a.length,r=0,s=C,t=B;for(c=a.lastIndexOf(D),0>c&&(c=0),d=0;c>d;++d)a.charCodeAt(d)>=128&&e("not-basic"),p.push(a.charCodeAt(d));for(f=c>0?c+1:0;q>f;){for(g=r,h=1,k=w;f>=q&&e("invalid-input"),m=j(a.charCodeAt(f++)),(m>=w||m>J((v-r)/h))&&e("overflow"),r+=m*h,n=t>=k?x:k>=t+y?y:k-t,!(n>m);k+=w)o=w-n,h>J(v/o)&&e("overflow"),h*=o;b=p.length+1,t=l(r-g,b,0==g),J(r/b)>v-s&&e("overflow"),s+=J(r/b),r%=b,p.splice(r++,0,s)}return i(p)}function n(a){var b,c,d,f,g,i,j,m,n,o,p,q,r,s,t,u=[];for(a=h(a),q=a.length,b=C,c=0,g=B,i=0;q>i;++i)p=a[i],128>p&&u.push(K(p));for(d=f=u.length,f&&u.push(D);q>d;){for(j=v,i=0;q>i;++i)p=a[i],p>=b&&j>p&&(j=p);for(r=d+1,j-b>J((v-c)/r)&&e("overflow"),c+=(j-b)*r,b=j,i=0;q>i;++i)if(p=a[i],b>p&&++c>v&&e("overflow"),p==b){for(m=c,n=w;o=g>=n?x:n>=g+y?y:n-g,!(o>m);n+=w)t=m-o,s=w-o,u.push(K(k(o+t%s,0))),m=J(t/s);u.push(K(k(m,0))),g=l(c,r,d==f),c=0,++d}++c,++b}return u.join("")}function o(a){return g(a,function(a){return E.test(a)?m(a.slice(4).toLowerCase()):a})}function p(a){return g(a,function(a){return F.test(a)?"xn--"+n(a):a})}var q="object"==typeof c&&c,r="object"==typeof b&&b&&b.exports==q&&b,s="object"==typeof a&&a;(s.global===s||s.window===s)&&(d=s);var t,u,v=2147483647,w=36,x=1,y=26,z=38,A=700,B=72,C=128,D="-",E=/^xn--/,F=/[^ -~]/,G=/\x2E|\u3002|\uFF0E|\uFF61/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=w-x,J=Math.floor,K=String.fromCharCode;if(t={version:"1.2.4",ucs2:{decode:h,encode:i},decode:m,encode:n,toASCII:p,toUnicode:o},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return t});else if(q&&!q.nodeType)if(r)r.exports=t;else for(u in t)t.hasOwnProperty(u)&&(q[u]=t[u]);else d.punycode=t}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],40:[function(a,b){"use strict";function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=function(a,b,e,f){b=b||"&",e=e||"=";var g={};if("string"!=typeof a||0===a.length)return g;var h=/\+/g;a=a.split(b);var i=1e3;f&&"number"==typeof f.maxKeys&&(i=f.maxKeys);var j=a.length;i>0&&j>i&&(j=i);for(var k=0;j>k;++k){var l,m,n,o,p=a[k].replace(h,"%20"),q=p.indexOf(e);q>=0?(l=p.substr(0,q),m=p.substr(q+1)):(l=p,m=""),n=decodeURIComponent(l),o=decodeURIComponent(m),c(g,n)?d(g[n])?g[n].push(o):g[n]=[g[n],o]:g[n]=o}return g};var d=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],41:[function(a,b){"use strict";function c(a,b){if(a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c}var d=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};b.exports=function(a,b,g,h){return b=b||"&",g=g||"=",null===a&&(a=void 0),"object"==typeof a?c(f(a),function(f){var h=encodeURIComponent(d(f))+g;return e(a[f])?c(a[f],function(a){return h+encodeURIComponent(d(a))}).join(b):h+encodeURIComponent(d(a[f]))}).join(b):h?encodeURIComponent(d(h))+g+encodeURIComponent(d(a)):""};var e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},f=Object.keys||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}},{}],42:[function(a,b,c){"use strict";c.decode=c.parse=a("./decode"),c.encode=c.stringify=a("./encode")},{"./decode":40,"./encode":41}],43:[function(a,b,c){function d(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function e(a,b,c){if(a&&j(a)&&a instanceof d)return a;var e=new d;return e.parse(a,b,c),e}function f(a){return i(a)&&(a=e(a)),a instanceof d?a.format():d.prototype.format.call(a)}function g(a,b){return e(a,!1,!0).resolve(b)}function h(a,b){return a?e(a,!1,!0).resolveObject(b):b}function i(a){return"string"==typeof a}function j(a){return"object"==typeof a&&null!==a}function k(a){return null===a}function l(a){return null==a}var m=a("punycode");c.parse=e,c.resolve=g,c.resolveObject=h,c.format=f,c.Url=d;var n=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,p=["<",">",'"',"`"," ","\r","\n","	"],q=["{","}","|","\\","^","`"].concat(p),r=["'"].concat(q),s=["%","/","?",";","#"].concat(r),t=["/","?","#"],u=255,v=/^[a-z0-9A-Z_-]{0,63}$/,w=/^([a-z0-9A-Z_-]{0,63})(.*)$/,x={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},z={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=a("querystring");d.prototype.parse=function(a,b,c){if(!i(a))throw new TypeError("Parameter 'url' must be a string, not "+typeof a);var d=a;d=d.trim();var e=n.exec(d);if(e){e=e[0];var f=e.toLowerCase();this.protocol=f,d=d.substr(e.length)}if(c||e||d.match(/^\/\/[^@\/]+@[^@\/]+/)){var g="//"===d.substr(0,2);!g||e&&y[e]||(d=d.substr(2),this.slashes=!0)}if(!y[e]&&(g||e&&!z[e])){for(var h=-1,j=0;j<t.length;j++){var k=d.indexOf(t[j]);-1!==k&&(-1===h||h>k)&&(h=k)}var l,o;o=-1===h?d.lastIndexOf("@"):d.lastIndexOf("@",h),-1!==o&&(l=d.slice(0,o),d=d.slice(o+1),this.auth=decodeURIComponent(l)),h=-1;for(var j=0;j<s.length;j++){var k=d.indexOf(s[j]);-1!==k&&(-1===h||h>k)&&(h=k)}-1===h&&(h=d.length),this.host=d.slice(0,h),d=d.slice(h),this.parseHost(),this.hostname=this.hostname||"";var p="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!p)for(var q=this.hostname.split(/\./),j=0,B=q.length;B>j;j++){var C=q[j];if(C&&!C.match(v)){for(var D="",E=0,F=C.length;F>E;E++)D+=C.charCodeAt(E)>127?"x":C[E];if(!D.match(v)){var G=q.slice(0,j),H=q.slice(j+1),I=C.match(w);I&&(G.push(I[1]),H.unshift(I[2])),H.length&&(d="/"+H.join(".")+d),this.hostname=G.join(".");break}}}if(this.hostname=this.hostname.length>u?"":this.hostname.toLowerCase(),!p){for(var J=this.hostname.split("."),K=[],j=0;j<J.length;++j){var L=J[j];K.push(L.match(/[^A-Za-z0-9_-]/)?"xn--"+m.encode(L):L)}this.hostname=K.join(".")}var M=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+M,this.href+=this.host,p&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==d[0]&&(d="/"+d))}if(!x[f])for(var j=0,B=r.length;B>j;j++){var O=r[j],P=encodeURIComponent(O);P===O&&(P=escape(O)),d=d.split(O).join(P)}var Q=d.indexOf("#");-1!==Q&&(this.hash=d.substr(Q),d=d.slice(0,Q));var R=d.indexOf("?");if(-1!==R?(this.search=d.substr(R),this.query=d.substr(R+1),b&&(this.query=A.parse(this.query)),d=d.slice(0,R)):b&&(this.search="",this.query={}),d&&(this.pathname=d),z[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var M=this.pathname||"",L=this.search||"";this.path=M+L}return this.href=this.format(),this},d.prototype.format=function(){var a=this.auth||"";a&&(a=encodeURIComponent(a),a=a.replace(/%3A/i,":"),a+="@");var b=this.protocol||"",c=this.pathname||"",d=this.hash||"",e=!1,f="";this.host?e=a+this.host:this.hostname&&(e=a+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(e+=":"+this.port)),this.query&&j(this.query)&&Object.keys(this.query).length&&(f=A.stringify(this.query));var g=this.search||f&&"?"+f||"";return b&&":"!==b.substr(-1)&&(b+=":"),this.slashes||(!b||z[b])&&e!==!1?(e="//"+(e||""),c&&"/"!==c.charAt(0)&&(c="/"+c)):e||(e=""),d&&"#"!==d.charAt(0)&&(d="#"+d),g&&"?"!==g.charAt(0)&&(g="?"+g),c=c.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),g=g.replace("#","%23"),b+e+c+g+d},d.prototype.resolve=function(a){return this.resolveObject(e(a,!1,!0)).format()},d.prototype.resolveObject=function(a){if(i(a)){var b=new d;b.parse(a,!1,!0),a=b}var c=new d;if(Object.keys(this).forEach(function(a){c[a]=this[a]},this),c.hash=a.hash,""===a.href)return c.href=c.format(),c;if(a.slashes&&!a.protocol)return Object.keys(a).forEach(function(b){"protocol"!==b&&(c[b]=a[b])}),z[c.protocol]&&c.hostname&&!c.pathname&&(c.path=c.pathname="/"),c.href=c.format(),c;if(a.protocol&&a.protocol!==c.protocol){if(!z[a.protocol])return Object.keys(a).forEach(function(b){c[b]=a[b]}),c.href=c.format(),c;if(c.protocol=a.protocol,a.host||y[a.protocol])c.pathname=a.pathname;else{for(var e=(a.pathname||"").split("/");e.length&&!(a.host=e.shift()););a.host||(a.host=""),a.hostname||(a.hostname=""),""!==e[0]&&e.unshift(""),e.length<2&&e.unshift(""),c.pathname=e.join("/")}if(c.search=a.search,c.query=a.query,c.host=a.host||"",c.auth=a.auth,c.hostname=a.hostname||a.host,c.port=a.port,c.pathname||c.search){var f=c.pathname||"",g=c.search||"";c.path=f+g}return c.slashes=c.slashes||a.slashes,c.href=c.format(),c}var h=c.pathname&&"/"===c.pathname.charAt(0),j=a.host||a.pathname&&"/"===a.pathname.charAt(0),m=j||h||c.host&&a.pathname,n=m,o=c.pathname&&c.pathname.split("/")||[],e=a.pathname&&a.pathname.split("/")||[],p=c.protocol&&!z[c.protocol];if(p&&(c.hostname="",c.port=null,c.host&&(""===o[0]?o[0]=c.host:o.unshift(c.host)),c.host="",a.protocol&&(a.hostname=null,a.port=null,a.host&&(""===e[0]?e[0]=a.host:e.unshift(a.host)),a.host=null),m=m&&(""===e[0]||""===o[0])),j)c.host=a.host||""===a.host?a.host:c.host,c.hostname=a.hostname||""===a.hostname?a.hostname:c.hostname,c.search=a.search,c.query=a.query,o=e;else if(e.length)o||(o=[]),o.pop(),o=o.concat(e),c.search=a.search,c.query=a.query;else if(!l(a.search)){if(p){c.hostname=c.host=o.shift();var q=c.host&&c.host.indexOf("@")>0?c.host.split("@"):!1;q&&(c.auth=q.shift(),c.host=c.hostname=q.shift())}return c.search=a.search,c.query=a.query,k(c.pathname)&&k(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:"")),c.href=c.format(),c}if(!o.length)return c.pathname=null,c.path=c.search?"/"+c.search:null,c.href=c.format(),c;for(var r=o.slice(-1)[0],s=(c.host||a.host)&&("."===r||".."===r)||""===r,t=0,u=o.length;u>=0;u--)r=o[u],"."==r?o.splice(u,1):".."===r?(o.splice(u,1),t++):t&&(o.splice(u,1),t--);if(!m&&!n)for(;t--;t)o.unshift("..");!m||""===o[0]||o[0]&&"/"===o[0].charAt(0)||o.unshift(""),s&&"/"!==o.join("/").substr(-1)&&o.push("");var v=""===o[0]||o[0]&&"/"===o[0].charAt(0);if(p){c.hostname=c.host=v?"":o.length?o.shift():"";var q=c.host&&c.host.indexOf("@")>0?c.host.split("@"):!1;q&&(c.auth=q.shift(),c.host=c.hostname=q.shift())}return m=m||c.host&&o.length,m&&!v&&o.unshift(""),o.length?c.pathname=o.join("/"):(c.pathname=null,c.path=null),k(c.pathname)&&k(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:"")),c.auth=a.auth||c.auth,c.slashes=c.slashes||a.slashes,c.href=c.format(),c},d.prototype.parseHost=function(){var a=this.host,b=o.exec(a);b&&(b=b[0],":"!==b&&(this.port=b.substr(1)),a=a.substr(0,a.length-b.length)),a&&(this.hostname=a)}},{punycode:39,querystring:42}],44:[function(a,b,c){"use strict";var d=a("./handlebars.runtime")["default"],e=a("./handlebars/compiler/ast")["default"],f=a("./handlebars/compiler/base").parser,g=a("./handlebars/compiler/base").parse,h=a("./handlebars/compiler/compiler").Compiler,i=a("./handlebars/compiler/compiler").compile,j=a("./handlebars/compiler/compiler").precompile,k=a("./handlebars/compiler/javascript-compiler")["default"],l=d.create,m=function(){var a=l();return a.compile=function(b,c){return i(b,c,a)},a.precompile=function(b,c){return j(b,c,a)},a.AST=e,a.Compiler=h,a.JavaScriptCompiler=k,a.Parser=f,a.parse=g,a};d=m(),d.create=m,d["default"]=d,c["default"]=d},{"./handlebars.runtime":45,"./handlebars/compiler/ast":47,"./handlebars/compiler/base":48,"./handlebars/compiler/compiler":49,"./handlebars/compiler/javascript-compiler":51}],45:[function(a,b,c){"use strict";var d=a("./handlebars/base"),e=a("./handlebars/safe-string")["default"],f=a("./handlebars/exception")["default"],g=a("./handlebars/utils"),h=a("./handlebars/runtime"),i=function(){var a=new d.HandlebarsEnvironment;return g.extend(a,d),a.SafeString=e,a.Exception=f,a.Utils=g,a.escapeExpression=g.escapeExpression,a.VM=h,a.template=function(b){return h.template(b,a)},a},j=i();j.create=i,j["default"]=j,c["default"]=j},{"./handlebars/base":46,"./handlebars/exception":55,"./handlebars/runtime":56,"./handlebars/safe-string":57,"./handlebars/utils":58}],46:[function(a,b,c){"use strict";function d(a,b){this.helpers=a||{},this.partials=b||{},e(this)}function e(a){a.registerHelper("helperMissing",function(){if(1===arguments.length)return void 0;throw new g("Missing helper: '"+arguments[arguments.length-1].name+"'")}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse,e=c.fn;if(b===!0)return e(this);if(b===!1||null==b)return d(this);if(k(b))return b.length>0?(c.ids&&(c.ids=[c.name]),a.helpers.each(b,c)):d(this);if(c.data&&c.ids){var g=q(c.data);g.contextPath=f.appendContextPath(c.data.contextPath,c.name),c={data:g}}return e(b,c)}),a.registerHelper("each",function(a,b){if(!b)throw new g("Must pass iterator to #each");var c,d,e=b.fn,h=b.inverse,i=0,j="";if(b.data&&b.ids&&(d=f.appendContextPath(b.data.contextPath,b.ids[0])+"."),l(a)&&(a=a.call(this)),b.data&&(c=q(b.data)),a&&"object"==typeof a)if(k(a))for(var m=a.length;m>i;i++)c&&(c.index=i,c.first=0===i,c.last=i===a.length-1,d&&(c.contextPath=d+i)),j+=e(a[i],{data:c});else for(var n in a)a.hasOwnProperty(n)&&(c&&(c.key=n,c.index=i,c.first=0===i,d&&(c.contextPath=d+n)),j+=e(a[n],{data:c}),i++);return 0===i&&(j=h(this)),j}),a.registerHelper("if",function(a,b){return l(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||f.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){l(a)&&(a=a.call(this));var c=b.fn;if(f.isEmpty(a))return b.inverse(this);if(b.data&&b.ids){var d=q(b.data);d.contextPath=f.appendContextPath(b.data.contextPath,b.ids[0]),b={data:d}}return c(a,b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)}),a.registerHelper("lookup",function(a,b){return a&&a[b]})}var f=a("./utils"),g=a("./exception")["default"],h="2.0.0";c.VERSION=h;var i=6;c.COMPILER_REVISION=i;var j={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};c.REVISION_CHANGES=j;var k=f.isArray,l=f.isFunction,m=f.toString,n="[object Object]";c.HandlebarsEnvironment=d,d.prototype={constructor:d,logger:o,log:p,registerHelper:function(a,b){if(m.call(a)===n){if(b)throw new g("Arg not supported with multiple helpers");f.extend(this.helpers,a)}else this.helpers[a]=b},unregisterHelper:function(a){delete this.helpers[a]},registerPartial:function(a,b){m.call(a)===n?f.extend(this.partials,a):this.partials[a]=b},unregisterPartial:function(a){delete this.partials[a]}};var o={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(o.level<=a){var c=o.methodMap[a];"undefined"!=typeof console&&console[c]&&console[c].call(console,b)}}};c.logger=o;var p=o.log;c.log=p;var q=function(a){var b=f.extend({},a);return b._parent=a,b};c.createFrame=q},{"./exception":55,"./utils":58}],47:[function(a,b,c){"use strict";function d(a){a=a||{},this.firstLine=a.first_line,this.firstColumn=a.first_column,this.lastColumn=a.last_column,this.lastLine=a.last_line}var e=a("../exception")["default"],f={ProgramNode:function(a,b,c){d.call(this,c),this.type="program",this.statements=a,this.strip=b},MustacheNode:function(a,b,c,e,g){if(d.call(this,g),this.type="mustache",this.strip=e,null!=c&&c.charAt){var h=c.charAt(3)||c.charAt(2);this.escaped="{"!==h&&"&"!==h}else this.escaped=!!c;this.sexpr=a instanceof f.SexprNode?a:new f.SexprNode(a,b),this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(a,b,c){d.call(this,c),this.type="sexpr",this.hash=b;var e=this.id=a[0],f=this.params=a.slice(1);this.isHelper=!(!f.length&&!b),this.eligibleHelper=this.isHelper||e.isSimple},PartialNode:function(a,b,c,e,f){d.call(this,f),this.type="partial",this.partialName=a,this.context=b,this.hash=c,this.strip=e,this.strip.inlineStandalone=!0},BlockNode:function(a,b,c,e,f){d.call(this,f),this.type="block",this.mustache=a,this.program=b,this.inverse=c,this.strip=e,c&&!b&&(this.isInverse=!0)},RawBlockNode:function(a,b,c,g){if(d.call(this,g),a.sexpr.id.original!==c)throw new e(a.sexpr.id.original+" doesn't match "+c,this);b=new f.ContentNode(b,g),this.type="block",this.mustache=a,this.program=new f.ProgramNode([b],{},g)},ContentNode:function(a,b){d.call(this,b),this.type="content",this.original=this.string=a},HashNode:function(a,b){d.call(this,b),this.type="hash",this.pairs=a},IdNode:function(a,b){d.call(this,b),this.type="ID";for(var c="",f=[],g=0,h="",i=0,j=a.length;j>i;i++){var k=a[i].part;if(c+=(a[i].separator||"")+k,".."===k||"."===k||"this"===k){if(f.length>0)throw new e("Invalid path: "+c,this);".."===k?(g++,h+="../"):this.isScoped=!0}else f.push(k)}this.original=c,this.parts=f,this.string=f.join("."),this.depth=g,this.idName=h+this.string,this.isSimple=1===a.length&&!this.isScoped&&0===g,this.stringModeValue=this.string},PartialNameNode:function(a,b){d.call(this,b),this.type="PARTIAL_NAME",this.name=a.original
},DataNode:function(a,b){d.call(this,b),this.type="DATA",this.id=a,this.stringModeValue=a.stringModeValue,this.idName="@"+a.stringModeValue},StringNode:function(a,b){d.call(this,b),this.type="STRING",this.original=this.string=this.stringModeValue=a},NumberNode:function(a,b){d.call(this,b),this.type="NUMBER",this.original=this.number=a,this.stringModeValue=Number(a)},BooleanNode:function(a,b){d.call(this,b),this.type="BOOLEAN",this.bool=a,this.stringModeValue="true"===a},CommentNode:function(a,b){d.call(this,b),this.type="comment",this.comment=a,this.strip={inlineStandalone:!0}}};c["default"]=f},{"../exception":55}],48:[function(a,b,c){"use strict";function d(a){return a.constructor===f.ProgramNode?a:(e.yy=i,e.parse(a))}var e=a("./parser")["default"],f=a("./ast")["default"],g=a("./helpers"),h=a("../utils").extend;c.parser=e;var i={};h(i,g,f),c.parse=d},{"../utils":58,"./ast":47,"./helpers":50,"./parser":52}],49:[function(a,b,c){"use strict";function d(){}function e(a,b,c){if(null==a||"string"!=typeof a&&a.constructor!==c.AST.ProgramNode)throw new h("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+a);b=b||{},"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var d=c.parse(a),e=(new c.Compiler).compile(d,b);return(new c.JavaScriptCompiler).compile(e,b)}function f(a,b,c){function d(){var d=c.parse(a),e=(new c.Compiler).compile(d,b),f=(new c.JavaScriptCompiler).compile(e,b,void 0,!0);return c.template(f)}if(null==a||"string"!=typeof a&&a.constructor!==c.AST.ProgramNode)throw new h("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);b=b||{},"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var e,f=function(a,b){return e||(e=d()),e.call(this,a,b)};return f._setup=function(a){return e||(e=d()),e._setup(a)},f._child=function(a,b,c){return e||(e=d()),e._child(a,b,c)},f}function g(a,b){if(a===b)return!0;if(i(a)&&i(b)&&a.length===b.length){for(var c=0;c<a.length;c++)if(!g(a[c],b[c]))return!1;return!0}}var h=a("../exception")["default"],i=a("../utils").isArray,j=[].slice;c.Compiler=d,d.prototype={compiler:d,equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||!g(d.args,e.args))return!1}for(b=this.children.length,c=0;b>c;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=b,this.stringParams=b.stringParams,this.trackIds=b.trackIds;var c=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0,lookup:!0},c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.accept(a)},accept:function(a){return this[a.type](a)},program:function(a){for(var b=a.statements,c=0,d=b.length;d>c;c++)this.accept(b[c]);return this.isSimple=1===d,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b,c=(new this.compiler).compile(a,this.options),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;f>e;e++)b=c.depths.list[e],2>b||this.addDepth(b-1);return d},block:function(a){var b=a.mustache,c=a.program,d=a.inverse;c&&(c=this.compileProgram(c)),d&&(d=this.compileProgram(d));var e=b.sexpr,f=this.classifySexpr(e);"helper"===f?this.helperSexpr(e,c,d):"simple"===f?(this.simpleSexpr(e),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("blockValue",e.id.original)):(this.ambiguousSexpr(e,c,d),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(a){var b,c,d=a.pairs;for(this.opcode("pushHash"),b=0,c=d.length;c>b;b++)this.pushParam(d[b][1]);for(;b--;)this.opcode("assignToHash",d[b][0]);this.opcode("popHash")},partial:function(a){var b=a.partialName;this.usePartial=!0,a.hash?this.accept(a.hash):this.opcode("push","undefined"),a.context?this.accept(a.context):(this.opcode("getContext",0),this.opcode("pushContext")),this.opcode("invokePartial",b.name,a.indent||""),this.opcode("append")},content:function(a){a.string&&this.opcode("appendContent",a.string)},mustache:function(a){this.sexpr(a.sexpr),this.opcode(a.escaped&&!this.options.noEscape?"appendEscaped":"append")},ambiguousSexpr:function(a,b,c){var d=a.id,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.ID(d),this.opcode("invokeAmbiguous",e,f)},simpleSexpr:function(a){var b=a.id;"DATA"===b.type?this.DATA(b):b.parts.length?this.ID(b):(this.addDepth(b.depth),this.opcode("getContext",b.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.id,f=e.parts[0];if(this.options.knownHelpers[f])this.opcode("invokeKnownHelper",d.length,f);else{if(this.options.knownHelpersOnly)throw new h("You specified knownHelpersOnly, but used the unknown helper "+f,a);e.falsy=!0,this.ID(e),this.opcode("invokeHelper",d.length,e.original,e.isSimple)}},sexpr:function(a){var b=this.classifySexpr(a);"simple"===b?this.simpleSexpr(a):"helper"===b?this.helperSexpr(a):this.ambiguousSexpr(a)},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0];b?this.opcode("lookupOnContext",a.parts,a.falsy,a.isScoped):this.opcode("pushContext")},DATA:function(a){this.options.data=!0,this.opcode("lookupData",a.id.depth,a.id.parts)},STRING:function(a){this.opcode("pushString",a.string)},NUMBER:function(a){this.opcode("pushLiteral",a.number)},BOOLEAN:function(a){this.opcode("pushLiteral",a.bool)},comment:function(){},opcode:function(a){this.opcodes.push({opcode:a,args:j.call(arguments,1)})},addDepth:function(a){0!==a&&(this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a)))},classifySexpr:function(a){var b=a.isHelper,c=a.eligibleHelper,d=this.options;if(c&&!b){var e=a.id.parts[0];d.knownHelpers[e]?b=!0:d.knownHelpersOnly&&(c=!1)}return b?"helper":c?"ambiguous":"simple"},pushParams:function(a){for(var b=0,c=a.length;c>b;b++)this.pushParam(a[b])},pushParam:function(a){this.stringParams?(a.depth&&this.addDepth(a.depth),this.opcode("getContext",a.depth||0),this.opcode("pushStringParam",a.stringModeValue,a.type),"sexpr"===a.type&&this.sexpr(a)):(this.trackIds&&this.opcode("pushId",a.type,a.idName||a.stringModeValue),this.accept(a))},setupFullMustacheParams:function(a,b,c){var d=a.params;return this.pushParams(d),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.hash(a.hash):this.opcode("emptyHash"),d}},c.precompile=e,c.compile=f},{"../exception":55,"../utils":58}],50:[function(a,b,c){"use strict";function d(a,b){return{left:"~"===a.charAt(2),right:"~"===b.charAt(b.length-3)}}function e(a,b,c,d,e,f){if(a.sexpr.id.original!==d.path.original)throw new k(a.sexpr.id.original+" doesn't match "+d.path.original,a);var l=c&&c.program,m={left:a.strip.left,right:d.strip.right,openStandalone:h(b.statements),closeStandalone:g((l||b).statements)};if(a.strip.right&&i(b.statements,null,!0),l){var n=c.strip;n.left&&j(b.statements,null,!0),n.right&&i(l.statements,null,!0),d.strip.left&&j(l.statements,null,!0),g(b.statements)&&h(l.statements)&&(j(b.statements),i(l.statements))}else d.strip.left&&j(b.statements,null,!0);return e?new this.BlockNode(a,l,b,m,f):new this.BlockNode(a,b,l,m,f)}function f(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c],f=e.strip;if(f){var k=g(a,c,b,"partial"===e.type),l=h(a,c,b),m=f.openStandalone&&k,n=f.closeStandalone&&l,o=f.inlineStandalone&&k&&l;f.right&&i(a,c,!0),f.left&&j(a,c,!0),o&&(i(a,c),j(a,c)&&"partial"===e.type&&(e.indent=/([ \t]+$)/.exec(a[c-1].original)?RegExp.$1:"")),m&&(i((e.program||e.inverse).statements),j(a,c)),n&&(i(a,c),j((e.inverse||e.program).statements))}}return a}function g(a,b,c){void 0===b&&(b=a.length);var d=a[b-1],e=a[b-2];return d?"content"===d.type?(e||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(d.original):void 0:c}function h(a,b,c){void 0===b&&(b=-1);var d=a[b+1],e=a[b+2];return d?"content"===d.type?(e||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(d.original):void 0:c}function i(a,b,c){var d=a[null==b?0:b+1];if(d&&"content"===d.type&&(c||!d.rightStripped)){var e=d.string;d.string=d.string.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),d.rightStripped=d.string!==e}}function j(a,b,c){var d=a[null==b?a.length-1:b-1];if(d&&"content"===d.type&&(c||!d.leftStripped)){var e=d.string;return d.string=d.string.replace(c?/\s+$/:/[ \t]+$/,""),d.leftStripped=d.string!==e,d.leftStripped}}var k=a("../exception")["default"];c.stripFlags=d,c.prepareBlock=e,c.prepareProgram=f},{"../exception":55}],51:[function(a,b,c){"use strict";function d(a){this.value=a}function e(){}var f=a("../base").COMPILER_REVISION,g=a("../base").REVISION_CHANGES,h=a("../exception")["default"];e.prototype={nameLookup:function(a,b){return e.isValidJavaScriptVariableName(b)?a+"."+b:a+"['"+b+"']"},depthedLookup:function(a){return this.aliases.lookup="this.lookup",'lookup(depths, "'+a+'")'},compilerInfo:function(){var a=f,b=g[a];return[a,b]},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":{appendToBuffer:!0,content:a,toString:function(){return"buffer += "+a+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(a,b,c,d){this.environment=a,this.options=b,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!d,this.name=this.environment.name,this.isChild=!!c,this.context=c||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(a,b),this.useDepths=this.useDepths||a.depths.list.length||this.options.compat;var e,f,g,i=a.opcodes;for(f=0,g=i.length;g>f;f++)e=i[f],this[e.opcode].apply(this,e.args);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new h("Compile completed with content left on stack");var j=this.createFunctionContext(d);if(this.isChild)return j;var k={compiler:this.compilerInfo(),main:j},l=this.context.programs;for(f=0,g=l.length;g>f;f++)l[f]&&(k[f]=l[f]);return this.environment.usePartial&&(k.usePartial=!0),this.options.data&&(k.useData=!0),this.useDepths&&(k.useDepths=!0),this.options.compat&&(k.compat=!0),d||(k.compiler=JSON.stringify(k.compiler),k=this.objectLiteral(k)),k},preamble:function(){this.lastContext=0,this.source=[]},createFunctionContext:function(a){var b="",c=this.stackVars.concat(this.registers.list);c.length>0&&(b+=", "+c.join(", "));for(var d in this.aliases)this.aliases.hasOwnProperty(d)&&(b+=", "+d+"="+this.aliases[d]);var e=["depth0","helpers","partials","data"];this.useDepths&&e.push("depths");var f=this.mergeSource(b);return a?(e.push(f),Function.apply(this,e)):"function("+e.join(",")+") {\n  "+f+"}"},mergeSource:function(a){for(var b,c,d="",e=!this.forceBuffer,f=0,g=this.source.length;g>f;f++){var h=this.source[f];h.appendToBuffer?b=b?b+"\n    + "+h.content:h.content:(b&&(d?d+="buffer += "+b+";\n  ":(c=!0,d=b+";\n  "),b=void 0),d+=h+"\n  ",this.environment.isSimple||(e=!1))}return e?(b||!d)&&(d+="return "+(b||'""')+";\n"):(a+=", buffer = "+(c?"":this.initializeBuffer()),d+=b?"return buffer + "+b+";\n":"return buffer;\n"),a&&(d="var "+a.substring(2)+(c?"":";\n  ")+d),d},blockValue:function(a){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var b=[this.contextName(0)];this.setupParams(a,0,b);var c=this.popStack();b.splice(1,0,c),this.push("blockHelperMissing.call("+b.join(", ")+")")},ambiguousBlockValue:function(){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=[this.contextName(0)];this.setupParams("",0,a,!0),this.flushInline();var b=this.topStack();a.splice(1,0,b),this.pushSource("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+a.join(", ")+"); }")},appendContent:function(a){this.pendingContent&&(a=this.pendingContent+a),this.pendingContent=a},append:function(){this.flushInline();var a=this.popStack();this.pushSource("if ("+a+" != null) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(a){this.lastContext=a},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(a,b,c){var d=0,e=a.length;for(c||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(a[d++]));e>d;d++)this.replaceStack(function(c){var e=this.nameLookup(c,a[d],"context");return b?" && "+e:" != null ? "+e+" : "+c})},lookupData:function(a,b){this.pushStackLiteral(a?"this.data(data, "+a+")":"data");for(var c=b.length,d=0;c>d;d++)this.replaceStack(function(a){return" && "+this.nameLookup(a,b[d],"data")})},resolvePossibleLambda:function(){this.aliases.lambda="this.lambda",this.push("lambda("+this.popStack()+", "+this.contextName(0)+")")},pushStringParam:function(a,b){this.pushContext(),this.pushString(b),"sexpr"!==b&&("string"==typeof a?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(){this.pushStackLiteral("{}"),this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push("{"+a.ids.join(",")+"}"),this.stringParams&&(this.push("{"+a.contexts.join(",")+"}"),this.push("{"+a.types.join(",")+"}")),this.push("{\n    "+a.values.join(",\n    ")+"\n  }")},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},push:function(a){return this.inlineStack.push(a),a},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){this.pushStackLiteral(null!=a?this.programExpression(a):null)},invokeHelper:function(a,b,c){this.aliases.helperMissing="helpers.helperMissing";var d=this.popStack(),e=this.setupHelper(a,b),f=(c?e.name+" || ":"")+d+" || helperMissing";this.push("(("+f+").call("+e.callParams+"))")},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(c.name+".call("+c.callParams+")")},invokeAmbiguous:function(a,b){this.aliases.functionType='"function"',this.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var c=this.popStack();this.emptyHash();var d=this.setupHelper(0,a,b),e=this.lastHelper=this.nameLookup("helpers",a,"helper");this.push("((helper = (helper = "+e+" || "+c+") != null ? helper : helperMissing"+(d.paramsInit?"),("+d.paramsInit:"")+"),(typeof helper === functionType ? helper.call("+d.callParams+") : helper))")},invokePartial:function(a,b){var c=[this.nameLookup("partials",a,"partial"),"'"+b+"'","'"+a+"'",this.popStack(),this.popStack(),"helpers","partials"];this.options.data?c.push("data"):this.options.compat&&c.push("undefined"),this.options.compat&&c.push("depths"),this.push("this.invokePartial("+c.join(", ")+")")},assignToHash:function(a){var b,c,d,e=this.popStack();this.trackIds&&(d=this.popStack()),this.stringParams&&(c=this.popStack(),b=this.popStack());var f=this.hash;b&&f.contexts.push("'"+a+"': "+b),c&&f.types.push("'"+a+"': "+c),d&&f.ids.push("'"+a+"': "+d),f.values.push("'"+a+"': ("+e+")")},pushId:function(a,b){"ID"===a||"DATA"===a?this.pushString(b):this.pushStackLiteral("sexpr"===a?"true":"null")},compiler:e,compileChildren:function(a,b){for(var c,d,e=a.children,f=0,g=e.length;g>f;f++){c=e[f],d=new this.compiler;var h=this.matchExistingProgram(c);null==h?(this.context.programs.push(""),h=this.context.programs.length,c.index=h,c.name="program"+h,this.context.programs[h]=d.compile(c,b,this.context,!this.precompile),this.context.environments[h]=c,this.useDepths=this.useDepths||d.useDepths):(c.index=h,c.name="program"+h)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){var b=this.environment.children[a],c=(b.depths.list,this.useDepths),d=[b.index,"data"];return c&&d.push("depths"),"this.program("+d.join(", ")+")"},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStackLiteral:function(a){return this.push(new d(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),a&&this.source.push(a)},pushStack:function(a){this.flushInline();var b=this.incrStack();return this.pushSource(b+" = "+a+";"),this.compileStack.push(b),b},replaceStack:function(a){{var b,c,e,f="";this.isInline()}if(!this.isInline())throw new h("replaceStack on non-inline");var g=this.popStack(!0);if(g instanceof d)f=b=g.value,e=!0;else{c=!this.stackSlot;var i=c?this.incrStack():this.topStackName();f="("+this.push(i)+" = "+g+")",b=this.topStack()}var j=a.call(this,b);e||this.popStack(),c&&this.stackSlot--,this.push("("+f+j+")")},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;if(a.length){this.inlineStack=[];for(var b=0,c=a.length;c>b;b++){var e=a[b];e instanceof d?this.compileStack.push(e):this.pushStack(e)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),c=(b?this.inlineStack:this.compileStack).pop();if(!a&&c instanceof d)return c.value;if(!b){if(!this.stackSlot)throw new h("Invalid stack pop");this.stackSlot--}return c},topStack:function(){var a=this.isInline()?this.inlineStack:this.compileStack,b=a[a.length-1];return b instanceof d?b.value:b},contextName:function(a){return this.useDepths&&a?"depths["+a+"]":"depth"+a},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(this.quotedString(c)+":"+a[c]);return"{"+b.join(",")+"}"},setupHelper:function(a,b,c){var d=[],e=this.setupParams(b,a,d,c),f=this.nameLookup("helpers",b,"helper");return{params:d,paramsInit:e,name:f,callParams:[this.contextName(0)].concat(d).join(", ")}},setupOptions:function(a,b,c){var d,e,f,g={},h=[],i=[],j=[];g.name=this.quotedString(a),g.hash=this.popStack(),this.trackIds&&(g.hashIds=this.popStack()),this.stringParams&&(g.hashTypes=this.popStack(),g.hashContexts=this.popStack()),e=this.popStack(),f=this.popStack(),(f||e)&&(f||(f="this.noop"),e||(e="this.noop"),g.fn=f,g.inverse=e);for(var k=b;k--;)d=this.popStack(),c[k]=d,this.trackIds&&(j[k]=this.popStack()),this.stringParams&&(i[k]=this.popStack(),h[k]=this.popStack());return this.trackIds&&(g.ids="["+j.join(",")+"]"),this.stringParams&&(g.types="["+i.join(",")+"]",g.contexts="["+h.join(",")+"]"),this.options.data&&(g.data="data"),g},setupParams:function(a,b,c,d){var e=this.objectLiteral(this.setupOptions(a,b,c));return d?(this.useRegister("options"),c.push("options"),"options="+e):(c.push(e),"")}};for(var i="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),j=e.RESERVED_WORDS={},k=0,l=i.length;l>k;k++)j[i[k]]=!0;e.isValidJavaScriptVariableName=function(a){return!e.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(a)},c["default"]=e},{"../base":46,"../exception":55}],52:[function(a,b,c){"use strict";var d=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,CONTENT:12,COMMENT:13,openRawBlock:14,END_RAW_BLOCK:15,OPEN_RAW_BLOCK:16,sexpr:17,CLOSE_RAW_BLOCK:18,openBlock:19,block_option0:20,closeBlock:21,openInverse:22,block_option1:23,OPEN_BLOCK:24,CLOSE:25,OPEN_INVERSE:26,inverseAndProgram:27,INVERSE:28,OPEN_ENDBLOCK:29,path:30,OPEN:31,OPEN_UNESCAPED:32,CLOSE_UNESCAPED:33,OPEN_PARTIAL:34,partialName:35,param:36,partial_option0:37,partial_option1:38,sexpr_repetition0:39,sexpr_option0:40,dataName:41,STRING:42,NUMBER:43,BOOLEAN:44,OPEN_SEXPR:45,CLOSE_SEXPR:46,hash:47,hash_repetition_plus0:48,hashSegment:49,ID:50,EQUALS:51,DATA:52,pathSegments:53,SEP:54,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"CONTENT",13:"COMMENT",15:"END_RAW_BLOCK",16:"OPEN_RAW_BLOCK",18:"CLOSE_RAW_BLOCK",24:"OPEN_BLOCK",25:"CLOSE",26:"OPEN_INVERSE",28:"INVERSE",29:"OPEN_ENDBLOCK",31:"OPEN",32:"OPEN_UNESCAPED",33:"CLOSE_UNESCAPED",34:"OPEN_PARTIAL",42:"STRING",43:"NUMBER",44:"BOOLEAN",45:"OPEN_SEXPR",46:"CLOSE_SEXPR",50:"ID",51:"EQUALS",52:"DATA",54:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[10,3],[14,3],[9,4],[9,4],[19,3],[22,3],[27,2],[21,3],[8,3],[8,3],[11,5],[11,4],[17,3],[17,1],[36,1],[36,1],[36,1],[36,1],[36,1],[36,3],[47,1],[49,3],[35,1],[35,1],[35,1],[41,2],[30,1],[53,3],[53,1],[6,0],[6,2],[20,0],[20,1],[23,0],[23,1],[37,0],[37,1],[38,0],[38,1],[39,0],[39,2],[40,0],[40,1],[48,1],[48,2]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return d.prepareProgram(f[g-1].statements,!0),f[g-1];case 2:this.$=new d.ProgramNode(d.prepareProgram(f[g]),{},this._$);break;case 3:this.$=f[g];break;case 4:this.$=f[g];break;case 5:this.$=f[g];break;case 6:this.$=f[g];break;case 7:this.$=new d.ContentNode(f[g],this._$);break;case 8:this.$=new d.CommentNode(f[g],this._$);break;case 9:this.$=new d.RawBlockNode(f[g-2],f[g-1],f[g],this._$);break;case 10:this.$=new d.MustacheNode(f[g-1],null,"","",this._$);break;case 11:this.$=d.prepareBlock(f[g-3],f[g-2],f[g-1],f[g],!1,this._$);break;case 12:this.$=d.prepareBlock(f[g-3],f[g-2],f[g-1],f[g],!0,this._$);break;case 13:this.$=new d.MustacheNode(f[g-1],null,f[g-2],d.stripFlags(f[g-2],f[g]),this._$);break;case 14:this.$=new d.MustacheNode(f[g-1],null,f[g-2],d.stripFlags(f[g-2],f[g]),this._$);break;case 15:this.$={strip:d.stripFlags(f[g-1],f[g-1]),program:f[g]};break;case 16:this.$={path:f[g-1],strip:d.stripFlags(f[g-2],f[g])};break;case 17:this.$=new d.MustacheNode(f[g-1],null,f[g-2],d.stripFlags(f[g-2],f[g]),this._$);break;case 18:this.$=new d.MustacheNode(f[g-1],null,f[g-2],d.stripFlags(f[g-2],f[g]),this._$);break;case 19:this.$=new d.PartialNode(f[g-3],f[g-2],f[g-1],d.stripFlags(f[g-4],f[g]),this._$);break;case 20:this.$=new d.PartialNode(f[g-2],void 0,f[g-1],d.stripFlags(f[g-3],f[g]),this._$);break;case 21:this.$=new d.SexprNode([f[g-2]].concat(f[g-1]),f[g],this._$);break;case 22:this.$=new d.SexprNode([f[g]],null,this._$);break;case 23:this.$=f[g];break;case 24:this.$=new d.StringNode(f[g],this._$);break;case 25:this.$=new d.NumberNode(f[g],this._$);break;case 26:this.$=new d.BooleanNode(f[g],this._$);break;case 27:this.$=f[g];break;case 28:f[g-1].isHelper=!0,this.$=f[g-1];break;case 29:this.$=new d.HashNode(f[g],this._$);break;case 30:this.$=[f[g-2],f[g]];break;case 31:this.$=new d.PartialNameNode(f[g],this._$);break;case 32:this.$=new d.PartialNameNode(new d.StringNode(f[g],this._$),this._$);break;case 33:this.$=new d.PartialNameNode(new d.NumberNode(f[g],this._$));break;case 34:this.$=new d.DataNode(f[g],this._$);break;case 35:this.$=new d.IdNode(f[g],this._$);break;case 36:f[g-2].push({part:f[g],separator:f[g-1]}),this.$=f[g-2];break;case 37:this.$=[{part:f[g]}];break;case 38:this.$=[];break;case 39:f[g-1].push(f[g]);break;case 48:this.$=[];break;case 49:f[g-1].push(f[g]);break;case 52:this.$=[f[g]];break;case 53:f[g-1].push(f[g])}},table:[{3:1,4:2,5:[2,38],6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],31:[2,38],32:[2,38],34:[2,38]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:[1,10],13:[1,11],14:16,16:[1,20],19:14,22:15,24:[1,18],26:[1,19],28:[2,2],29:[2,2],31:[1,12],32:[1,13],34:[1,17]},{1:[2,1]},{5:[2,39],12:[2,39],13:[2,39],16:[2,39],24:[2,39],26:[2,39],28:[2,39],29:[2,39],31:[2,39],32:[2,39],34:[2,39]},{5:[2,3],12:[2,3],13:[2,3],16:[2,3],24:[2,3],26:[2,3],28:[2,3],29:[2,3],31:[2,3],32:[2,3],34:[2,3]},{5:[2,4],12:[2,4],13:[2,4],16:[2,4],24:[2,4],26:[2,4],28:[2,4],29:[2,4],31:[2,4],32:[2,4],34:[2,4]},{5:[2,5],12:[2,5],13:[2,5],16:[2,5],24:[2,5],26:[2,5],28:[2,5],29:[2,5],31:[2,5],32:[2,5],34:[2,5]},{5:[2,6],12:[2,6],13:[2,6],16:[2,6],24:[2,6],26:[2,6],28:[2,6],29:[2,6],31:[2,6],32:[2,6],34:[2,6]},{5:[2,7],12:[2,7],13:[2,7],16:[2,7],24:[2,7],26:[2,7],28:[2,7],29:[2,7],31:[2,7],32:[2,7],34:[2,7]},{5:[2,8],12:[2,8],13:[2,8],16:[2,8],24:[2,8],26:[2,8],28:[2,8],29:[2,8],31:[2,8],32:[2,8],34:[2,8]},{17:21,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:27,30:22,41:23,50:[1,26],52:[1,25],53:24},{4:28,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{4:29,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{12:[1,30]},{30:32,35:31,42:[1,33],43:[1,34],50:[1,26],53:24},{17:35,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:36,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:37,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[1,38]},{18:[2,48],25:[2,48],33:[2,48],39:39,42:[2,48],43:[2,48],44:[2,48],45:[2,48],46:[2,48],50:[2,48],52:[2,48]},{18:[2,22],25:[2,22],33:[2,22],46:[2,22]},{18:[2,35],25:[2,35],33:[2,35],42:[2,35],43:[2,35],44:[2,35],45:[2,35],46:[2,35],50:[2,35],52:[2,35],54:[1,40]},{30:41,50:[1,26],53:24},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],52:[2,37],54:[2,37]},{33:[1,42]},{20:43,27:44,28:[1,45],29:[2,40]},{23:46,27:47,28:[1,45],29:[2,42]},{15:[1,48]},{25:[2,46],30:51,36:49,38:50,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],47:57,48:58,49:60,50:[1,59],52:[1,25],53:24},{25:[2,31],42:[2,31],43:[2,31],44:[2,31],45:[2,31],50:[2,31],52:[2,31]},{25:[2,32],42:[2,32],43:[2,32],44:[2,32],45:[2,32],50:[2,32],52:[2,32]},{25:[2,33],42:[2,33],43:[2,33],44:[2,33],45:[2,33],50:[2,33],52:[2,33]},{25:[1,61]},{25:[1,62]},{18:[1,63]},{5:[2,17],12:[2,17],13:[2,17],16:[2,17],24:[2,17],26:[2,17],28:[2,17],29:[2,17],31:[2,17],32:[2,17],34:[2,17]},{18:[2,50],25:[2,50],30:51,33:[2,50],36:65,40:64,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],46:[2,50],47:66,48:58,49:60,50:[1,59],52:[1,25],53:24},{50:[1,67]},{18:[2,34],25:[2,34],33:[2,34],42:[2,34],43:[2,34],44:[2,34],45:[2,34],46:[2,34],50:[2,34],52:[2,34]},{5:[2,18],12:[2,18],13:[2,18],16:[2,18],24:[2,18],26:[2,18],28:[2,18],29:[2,18],31:[2,18],32:[2,18],34:[2,18]},{21:68,29:[1,69]},{29:[2,41]},{4:70,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{21:71,29:[1,69]},{29:[2,43]},{5:[2,9],12:[2,9],13:[2,9],16:[2,9],24:[2,9],26:[2,9],28:[2,9],29:[2,9],31:[2,9],32:[2,9],34:[2,9]},{25:[2,44],37:72,47:73,48:58,49:60,50:[1,74]},{25:[1,75]},{18:[2,23],25:[2,23],33:[2,23],42:[2,23],43:[2,23],44:[2,23],45:[2,23],46:[2,23],50:[2,23],52:[2,23]},{18:[2,24],25:[2,24],33:[2,24],42:[2,24],43:[2,24],44:[2,24],45:[2,24],46:[2,24],50:[2,24],52:[2,24]},{18:[2,25],25:[2,25],33:[2,25],42:[2,25],43:[2,25],44:[2,25],45:[2,25],46:[2,25],50:[2,25],52:[2,25]},{18:[2,26],25:[2,26],33:[2,26],42:[2,26],43:[2,26],44:[2,26],45:[2,26],46:[2,26],50:[2,26],52:[2,26]},{18:[2,27],25:[2,27],33:[2,27],42:[2,27],43:[2,27],44:[2,27],45:[2,27],46:[2,27],50:[2,27],52:[2,27]},{17:76,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[2,47]},{18:[2,29],25:[2,29],33:[2,29],46:[2,29],49:77,50:[1,74]},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],51:[1,78],52:[2,37],54:[2,37]},{18:[2,52],25:[2,52],33:[2,52],46:[2,52],50:[2,52]},{12:[2,13],13:[2,13],16:[2,13],24:[2,13],26:[2,13],28:[2,13],29:[2,13],31:[2,13],32:[2,13],34:[2,13]},{12:[2,14],13:[2,14],16:[2,14],24:[2,14],26:[2,14],28:[2,14],29:[2,14],31:[2,14],32:[2,14],34:[2,14]},{12:[2,10]},{18:[2,21],25:[2,21],33:[2,21],46:[2,21]},{18:[2,49],25:[2,49],33:[2,49],42:[2,49],43:[2,49],44:[2,49],45:[2,49],46:[2,49],50:[2,49],52:[2,49]},{18:[2,51],25:[2,51],33:[2,51],46:[2,51]},{18:[2,36],25:[2,36],33:[2,36],42:[2,36],43:[2,36],44:[2,36],45:[2,36],46:[2,36],50:[2,36],52:[2,36],54:[2,36]},{5:[2,11],12:[2,11],13:[2,11],16:[2,11],24:[2,11],26:[2,11],28:[2,11],29:[2,11],31:[2,11],32:[2,11],34:[2,11]},{30:79,50:[1,26],53:24},{29:[2,15]},{5:[2,12],12:[2,12],13:[2,12],16:[2,12],24:[2,12],26:[2,12],28:[2,12],29:[2,12],31:[2,12],32:[2,12],34:[2,12]},{25:[1,80]},{25:[2,45]},{51:[1,78]},{5:[2,20],12:[2,20],13:[2,20],16:[2,20],24:[2,20],26:[2,20],28:[2,20],29:[2,20],31:[2,20],32:[2,20],34:[2,20]},{46:[1,81]},{18:[2,53],25:[2,53],33:[2,53],46:[2,53],50:[2,53]},{30:51,36:82,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],50:[1,26],52:[1,25],53:24},{25:[1,83]},{5:[2,19],12:[2,19],13:[2,19],16:[2,19],24:[2,19],26:[2,19],28:[2,19],29:[2,19],31:[2,19],32:[2,19],34:[2,19]},{18:[2,28],25:[2,28],33:[2,28],42:[2,28],43:[2,28],44:[2,28],45:[2,28],46:[2,28],50:[2,28],52:[2,28]},{18:[2,30],25:[2,30],33:[2,30],46:[2,30],50:[2,30]},{5:[2,16],12:[2,16],13:[2,16],16:[2,16],24:[2,16],26:[2,16],28:[2,16],29:[2,16],31:[2,16],32:[2,16],34:[2,16]}],defaultActions:{4:[2,1],44:[2,41],47:[2,43],57:[2,47],63:[2,10],70:[2,15],73:[2,45]},parseError:function(a){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this
},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){function e(a,c){return b.yytext=b.yytext.substr(a,b.yyleng-c)}switch(c){case 0:if("\\\\"===b.yytext.slice(-2)?(e(0,1),this.begin("mu")):"\\"===b.yytext.slice(-1)?(e(0,1),this.begin("emu")):this.begin("mu"),b.yytext)return 12;break;case 1:return 12;case 2:return this.popState(),12;case 3:return b.yytext=b.yytext.substr(5,b.yyleng-9),this.popState(),15;case 4:return 12;case 5:return e(0,4),this.popState(),13;case 6:return 45;case 7:return 46;case 8:return 16;case 9:return this.popState(),this.begin("raw"),18;case 10:return 34;case 11:return 24;case 12:return 29;case 13:return this.popState(),28;case 14:return this.popState(),28;case 15:return 26;case 16:return 26;case 17:return 32;case 18:return 31;case 19:this.popState(),this.begin("com");break;case 20:return e(3,5),this.popState(),13;case 21:return 31;case 22:return 51;case 23:return 50;case 24:return 50;case 25:return 54;case 26:break;case 27:return this.popState(),33;case 28:return this.popState(),25;case 29:return b.yytext=e(1,2).replace(/\\"/g,'"'),42;case 30:return b.yytext=e(1,2).replace(/\\'/g,"'"),42;case 31:return 52;case 32:return 44;case 33:return 44;case 34:return 43;case 35:return 50;case 36:return b.yytext=e(1,2),50;case 37:return"INVALID";case 38:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,38],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();c["default"]=d},{}],53:[function(a,b,c){"use strict";function d(a){return(new e).accept(a)}function e(){this.padding=0}var f=a("./visitor")["default"];c.print=d,c.PrintVisitor=e,e.prototype=new f,e.prototype.pad=function(a){for(var b="",c=0,d=this.padding;d>c;c++)b+="  ";return b=b+a+"\n"},e.prototype.program=function(a){var b,c,d="",e=a.statements;for(b=0,c=e.length;c>b;b++)d+=this.accept(e[b]);return this.padding--,d},e.prototype.block=function(a){var b="";return b+=this.pad("BLOCK:"),this.padding++,b+=this.accept(a.mustache),a.program&&(b+=this.pad("PROGRAM:"),this.padding++,b+=this.accept(a.program),this.padding--),a.inverse&&(a.program&&this.padding++,b+=this.pad("{{^}}"),this.padding++,b+=this.accept(a.inverse),this.padding--,a.program&&this.padding--),this.padding--,b},e.prototype.sexpr=function(a){for(var b,c=a.params,d=[],e=0,f=c.length;f>e;e++)d.push(this.accept(c[e]));return c="["+d.join(", ")+"]",b=a.hash?" "+this.accept(a.hash):"",this.accept(a.id)+" "+c+b},e.prototype.mustache=function(a){return this.pad("{{ "+this.accept(a.sexpr)+" }}")},e.prototype.partial=function(a){var b=this.accept(a.partialName);return a.context&&(b+=" "+this.accept(a.context)),a.hash&&(b+=" "+this.accept(a.hash)),this.pad("{{> "+b+" }}")},e.prototype.hash=function(a){for(var b,c,d=a.pairs,e=[],f=0,g=d.length;g>f;f++)b=d[f][0],c=this.accept(d[f][1]),e.push(b+"="+c);return"HASH{"+e.join(", ")+"}"},e.prototype.STRING=function(a){return'"'+a.string+'"'},e.prototype.NUMBER=function(a){return"NUMBER{"+a.number+"}"},e.prototype.BOOLEAN=function(a){return"BOOLEAN{"+a.bool+"}"},e.prototype.ID=function(a){var b=a.parts.join("/");return a.parts.length>1?"PATH:"+b:"ID:"+b},e.prototype.PARTIAL_NAME=function(a){return"PARTIAL:"+a.name},e.prototype.DATA=function(a){return"@"+this.accept(a.id)},e.prototype.content=function(a){return this.pad("CONTENT[ '"+a.string+"' ]")},e.prototype.comment=function(a){return this.pad("{{! '"+a.comment+"' }}")}},{"./visitor":54}],54:[function(a,b,c){"use strict";function d(){}d.prototype={constructor:d,accept:function(a){return this[a.type](a)}},c["default"]=d},{}],55:[function(a,b,c){"use strict";function d(a,b){var c;b&&b.firstLine&&(c=b.firstLine,a+=" - "+c+":"+b.firstColumn);for(var d=Error.prototype.constructor.call(this,a),f=0;f<e.length;f++)this[e[f]]=d[e[f]];c&&(this.lineNumber=c,this.column=b.firstColumn)}var e=["description","fileName","lineNumber","message","name","number","stack"];d.prototype=new Error,c["default"]=d},{}],56:[function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=l;if(b!==c){if(c>b){var d=m[c],e=m[b];throw new k("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new k("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){if(!b)throw new k("No environment passed to template");if(!a||!a.main)throw new k("Unknown template object: "+typeof a);b.VM.checkRevision(a.compiler);var c=function(c,d,e,f,g,h,i,l,m){g&&(f=j.extend({},f,g));var n=b.VM.invokePartial.call(this,c,e,f,h,i,l,m);if(null==n&&b.compile){var o={helpers:h,partials:i,data:l,depths:m};i[e]=b.compile(c,{data:void 0!==l,compat:a.compat},b),n=i[e](f,o)}if(null!=n){if(d){for(var p=n.split("\n"),q=0,r=p.length;r>q&&(p[q]||q+1!==r);q++)p[q]=d+p[q];n=p.join("\n")}return n}throw new k("The partial "+e+" could not be compiled when running in runtime-only mode")},d={lookup:function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]&&null!=a[d][b])return a[d][b]},lambda:function(a,b){return"function"==typeof a?a.call(b):a},escapeExpression:j.escapeExpression,invokePartial:c,fn:function(b){return a[b]},programs:[],program:function(a,b,c){var d=this.programs[a],e=this.fn(a);return b||c?d=f(this,a,e,b,c):d||(d=this.programs[a]=f(this,a,e)),d},data:function(a,b){for(;a&&b--;)a=a._parent;return a},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c=j.extend({},b,a)),c},noop:b.VM.noop,compilerInfo:a.compiler},e=function(b,c){c=c||{};var f=c.data;e._setup(c),!c.partial&&a.useData&&(f=i(b,f));var g;return a.useDepths&&(g=c.depths?[b].concat(c.depths):[b]),a.main.call(d,b,d.helpers,d.partials,f,g)};return e.isTop=!0,e._setup=function(c){c.partial?(d.helpers=c.helpers,d.partials=c.partials):(d.helpers=d.merge(c.helpers,b.helpers),a.usePartial&&(d.partials=d.merge(c.partials,b.partials)))},e._child=function(b,c,e){if(a.useDepths&&!e)throw new k("must pass parent depths");return f(d,b,a[b],c,e)},e}function f(a,b,c,d,e){var f=function(b,f){return f=f||{},c.call(a,b,a.helpers,a.partials,f.data||d,e&&[b].concat(e))};return f.program=b,f.depth=e?e.length:0,f}function g(a,b,c,d,e,f,g){var h={partial:!0,helpers:d,partials:e,data:f,depths:g};if(void 0===a)throw new k("The partial "+b+" could not be found");return a instanceof Function?a(c,h):void 0}function h(){return""}function i(a,b){return b&&"root"in b||(b=b?n(b):{},b.root=a),b}var j=a("./utils"),k=a("./exception")["default"],l=a("./base").COMPILER_REVISION,m=a("./base").REVISION_CHANGES,n=a("./base").createFrame;c.checkRevision=d,c.template=e,c.program=f,c.invokePartial=g,c.noop=h},{"./base":46,"./exception":55,"./utils":58}],57:[function(a,b,c){"use strict";function d(a){this.string=a}d.prototype.toString=function(){return""+this.string},c["default"]=d},{}],58:[function(a,b,c){"use strict";function d(a){return j[a]}function e(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function f(a){return a instanceof i?a.toString():null==a?"":a?(a=""+a,l.test(a)?a.replace(k,d):a):a+""}function g(a){return a||0===a?o(a)&&0===a.length?!0:!1:!0}function h(a,b){return(a?a+".":"")+b}var i=a("./safe-string")["default"],j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},k=/[&<>"'`]/g,l=/[&<>"'`]/;c.extend=e;var m=Object.prototype.toString;c.toString=m;var n=function(a){return"function"==typeof a};n(/x/)&&(n=function(a){return"function"==typeof a&&"[object Function]"===m.call(a)});var n;c.isFunction=n;var o=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===m.call(a):!1};c.isArray=o,c.escapeExpression=f,c.isEmpty=g,c.appendContextPath=h},{"./safe-string":57}],59:[function(a,b){var c=a("../dist/cjs/handlebars")["default"];c.Visitor=a("../dist/cjs/handlebars/compiler/visitor")["default"];var d=a("../dist/cjs/handlebars/compiler/printer");if(c.PrintVisitor=d.PrintVisitor,c.print=d.print,b.exports=c,"undefined"!=typeof a&&a.extensions){var e=function(b,d){var e=a("fs"),f=e.readFileSync(d,"utf8");b.exports=c.compile(f)};a.extensions[".handlebars"]=e,a.extensions[".hbs"]=e}},{"../dist/cjs/handlebars":44,"../dist/cjs/handlebars/compiler/printer":53,"../dist/cjs/handlebars/compiler/visitor":54,fs:36}],60:[function(a,b){"use strict";b.exports=function(a,b,c,d,e){return{init:function(f){a.on("mousedown",function(a){return a.shiftKey?!1:void 0}).on("mousedown",".textae-editor__type",function(){return!1}).on("mousedown",".textae-editor__body__text-box__paragraph-margin",function(a){return"textae-editor__body__text-box__paragraph-margin"===a.target.className?!1:void 0}),a.on("mouseup",".textae-editor__body,.textae-editor__span,.textae-editor__grid,.textae-editor__entity",c.event.editorSelected).on("mouseenter",".textae-editor__entity",function(){d.hoverRelation.on($(this).attr("title"))}).on("mouseleave",".textae-editor__entity",function(){d.hoverRelation.off($(this).attr("title"))}),b.bind("change",function(a){e.enabled("write",a.hasAnythingToSave),e.enabled("undo",a.hasAnythingToUndo),e.enabled("redo",a.hasAnythingToRedo),window.onbeforeunload=a.hasAnythingToSave?function(){return f}:null})}}}},{}],61:[function(a,b){"use strict";var c={"delimiter characters":[" ",".","!","?",",",":",";","-","/","&","(",")","{","}","[","]","+","*","\\",'"',"'","\n",""],"non-edge characters":[" ","\n"]};b.exports=function(){var a=[],b=[],d=function(d){var e=_.extend({},c,d);return a=e["delimiter characters"],b=e["non-edge characters"],d},e=_.partial(d,c),f=function(b){return a.indexOf("ANY")>=0?1:a.indexOf(b)>=0},g=function(a){return b.indexOf(a)>=0},h=function(a){return b.forEach(function(b){a=a.replace(b,"")}),a};return{reset:e,set:d,isDelimiter:f,isBlankCharacter:g,removeBlankChractors:h}}},{}],62:[function(a,b){"use strict";b.exports=function(a,b){b?console.log("[command.invoke]",a,b):console.log("[command.invoke]",a)}},{}],63:[function(a,b){"use strict";var c=function(a,b,c){a.selectionModel[b]&&a.selectionModel[b].add(c.id)},d=a("./commandLog"),e=function(a,b,e,f,g){return{execute:function(){return g=b.annotationData[e].add(g),f&&c(b,e,g),this.revert=_.partial(a,_.noop,b,e,g.id),d("create a new "+e+": ",g),g}}},f=function(a,b,c,e){return{execute:function(){var f=b.annotationData[c].remove(e);f?(this.revert=_.partial(a,_.noop,b,c,!1,f),d("remove a "+c+": ",f)):(this.revert=function(){return{execute:function(){}}},d("already removed "+c+": ",e))}}},g=_.partial(e,f),h=_.partial(f,e),i=function(a,b,c,e){return{execute:function(){var f=a.annotationData[b].get(c).type,g=a.annotationData[b].changeType(c,e);this.revert=_.partial(i,a,b,c,f),d("change type of a "+b+". oldtype:"+f+" "+b+":",g)}}},j={create:g,remove:h,changeType:i,debugLog:d};b.exports=j},{"./commandLog":62}],64:[function(a,b){"use strict";var c=a("./invokeCommand"),d=(a("./commandTemplate"),a("./commandLog")),e=function(){var a=function(a,b){d(a+b.commandType+" a "+b.modelType+": "+b.id)},b=_.partial(a,""),e=_.partial(a,"revert "),f=function(a,b){var d={execute:function(){c.invokeRevert(a),e(b)}};return function(){return d}},g=function(a,b,c,d,e){var g={modelType:a,commandType:c,id:d};return b.revert=new f(e,g),g};return _.compose(b,g)}(),f=function(a,b,d,f,g){c.invoke(g),e(a,b,d,f,g)};b.exports=f},{"./commandLog":62,"./commandTemplate":63,"./invokeCommand":67}],65:[function(a,b){"use strict";var c=function(a,b){for(var c=String.prototype.indexOf.bind(a,a.substring(b.begin,b.end)),d=b.end-b.begin,e=[],f=0,g=c(f);-1!==g;g=c(f))e.push({begin:g,end:g+d}),f=g+d;return e},d=function(a,b,c){var d=a.charAt(c.begin-1),e=a.charAt(c.end);return b(d)&&b(e)},e=function(a){return!a},f=a("../model/isAlreadySpaned"),g=a("../model/isBoundaryCrossingWithOtherSpans");b.exports=function(a,b,h){var i=a.span.all(),j=h?_.partial(d,a.sourceDoc,h):_.identity;return c(a.sourceDoc,b).filter(function(a){return a.begin!==b.begin}).filter(j).filter(_.compose(e,_.partial(f,i))).filter(_.compose(e,_.partial(g,i)))}},{"../model/isAlreadySpaned":107,"../model/isBoundaryCrossingWithOtherSpans":108}],66:[function(a,b){"use strict";var c=a("./invokeCommand"),d=a("./commandTemplate"),e=a("./executeCompositCommand"),f=a("./getReplicationSpans"),g=a("../util/idFactory");b.exports=function(a,b,h){var i=_.partial(d.create,b,"span",!0),j=_.partial(d.create,b,"entity",!0),k=function(b,c){var d=g.makeSpanId(a,c),f=i(c),h=j({span:d,type:b}),k=[f,h];return{execute:function(){e("span",this,"create",d,k)}}},l=function(a,c,d){var g=_.partial(k,a),h=f(b.annotationData,c,d).map(g);return{execute:function(){e("span",this,"replicate",c.id,h)}}},m=_.partial(d.create,b,"relation",!1),n=_.partial(d.create,b,"relation",!0),o=_.partial(d.remove,b,"modification"),p=_.partial(d.remove,b,"relation"),q=function(a){var c=p(a),d=b.annotationData.getModificationOf(a).map(function(a){return a.id}).map(function(a){return o(a)}),f=d.concat(c);return{execute:function(){e("relation",this,"remove",a,f)}}},r=_.partial(d.remove,b,"entity"),s=function(a){var c=r(a),d=b.annotationData.entity.assosicatedRelations(a).map(function(a){return p(a)}),f=b.annotationData.getModificationOf(a).map(function(a){return a.id}).map(function(a){return o(a)}),g=d.concat(f).concat(c);return{execute:function(){e("entity",this,"remove",a,g)}}},t=function(a){var c=d.remove(b,"span",a),f=_.flatten(b.annotationData.span.get(a).getTypes().map(function(a){return a.entities.map(function(a){return s(a)})})),g=f.concat(c);return{execute:function(){e("span",this,"remove",a,g)}}},u=function(a){return a.map(function(a){var c=b.annotationData.entity.get(a).span;return{id:a,span:c}}).reduce(function(a,b){var c=a[b.span]?a[b.span]:[];return c.push(b.id),a[b.span]=c,a},{})},v=function(a){var c=u(a);return _.flatten(Object.keys(c).map(function(a){var d=b.annotationData.span.get(a),e=c[a],f=_.flatten(d.getTypes().map(function(a){return a.entities})),g=_.reject(f,function(a){return _.contains(e,a)});return{entities:e,spasId:a,noRestEntities:0===g.length}}).map(function(a){return a.noRestEntities?t(a.spasId):a.entities.map(function(a){return s(a)})}))},w=function(a,c,f){var g=d.changeType(b,"entity",a,c),h=f?b.annotationData.entity.assosicatedRelations(a).map(function(a){return p(a)}).concat(g):[g];return{execute:function(){e("entity",this,"change",a,h)}}},x=function(c,d){var f=[],h=g.makeSpanId(a,d),k=b.annotationData;return k.span.get(h)||(f.push(t(c)),f.push(i({begin:d.begin,end:d.end})),k.span.get(c).getTypes().forEach(function(a){a.entities.forEach(function(b){f.push(j({id:b,span:h,type:a.name})),f=f.concat(k.entity.assosicatedRelations(b).map(k.relation.get).map(function(a){return m(a)}))})})),{execute:function(){e("span",this,"move",c,f)}}},y={spanCreateCommand:k,spanRemoveCommand:t,spanMoveCommand:x,spanReplicateCommand:l,entityCreateCommand:j,entityRemoveCommand:v,entityChangeTypeCommand:w,relationCreateCommand:n,relationRemoveCommand:q,relationChangeTypeCommand:_.partial(d.changeType,b,"relation"),modificationCreateCommand:_.partial(d.create,b,"modification",!1),modificationRemoveCommand:o};return{invoke:function(a){a&&a.length>0&&(c.invoke(a),h.push(a))},undo:function(){return function(){h.hasAnythingToUndo()&&(b.selectionModel.clear(),c.invokeRevert(h.prev()))}}(),redo:function(){h.hasAnythingToRedo()&&(b.selectionModel.clear(),c.invoke(h.next()))},factory:y}}},{"../util/idFactory":153,"./commandTemplate":63,"./executeCompositCommand":64,"./getReplicationSpans":65,"./invokeCommand":67}],67:[function(a,b){"use strict";var c=function(a){a.forEach(function(a){a.execute()})},d=function(a){return a=Object.create(a),a.reverse(),a.map(function(a){return a.revert()})},e=_.compose(c,d),f={invoke:c,invokeRevert:e};b.exports=f},{}],68:[function(a,b){"use strict";var c=function(a,b,c){a.on(b,c)},d=function(a){return c(a,"dialog.close",function(){a.close()}),a},e=a("../util/ajaxAccessor"),f=a("../util/jQuerySugar"),g=a("url");b.exports=function(b,c){var h="",i=a("../util/CursorChanger")(b),j=function(a){i.startWait(),e.getAsync(a,function(b){l.trigger("load",{annotation:b,source:f.toLink(g.resolve(location.href,a))}),h=a},function(){i.endWait(),alert("connection failed.")})},k=function(){var g=function(a){return a.openAndSetParam||(a.openAndSetParam=_.compose(a.open.bind(a),function(b){this.find('[type="text"].url').val(h).trigger("input"),a.params=b})),a},k=_.compose(g,d,a("./dialog/GetEditorDialog")(b)),m={URL:"URL",LOCAL:"Local"},n=function(){var a=function(a){var b=a.files[0],c=new FileReader;c.onload=function(){var a=JSON.parse(this.result);l.trigger("load",{annotation:a,source:b.name+"(local file)"})},c.readAsText(b)},b=_.partial(f.Div,"textae-editor__load-dialog__row"),d=_.partial(f.Label,"textae-editor__load-dialog__label"),e=_.partial(f.Button,"Open"),g=function(){return!o.params||window.confirm(c)},h=new e("url"),i=new e("local"),n=$("<div>").append((new b).append(new d(m.URL),$('<input type="text" class="textae-editor__load-dialog__file-name url" />'),h)).on("input",'[type="text"].url',function(){f.enabled(h,this.value)}).on("click",'[type="button"].url',function(){g()&&j(f.getValueFromText(n,"url")),n.trigger("dialog.close")}).append((new b).append(new d(m.LOCAL),$('<input class="textae-editor__load-dialog__file" type="file" />'),i)).on("change",'[type="file"]',function(){f.enabled(i,this.files.length>0)}).on("click",'[type="button"].local',function(){g()&&a(n.find('[type="file"]')[0]),n.trigger("dialog.close")}),o=k("textae.dialog.load","Load Annotations",n);return o},o=function(a){var b=function(){l.trigger("save"),i.endWait()},c=function(){l.trigger("save error"),i.endWait()},d=function(a,d){i.startWait(),e.post(a,d,b,c,function(){i.endWait()})},g=function(a){var b=new Blob([a],{type:"application/json"});return URL.createObjectURL(b)},h=function(){var b=n(a).find("input[type='file']"),c=b.prop("files")[0];return c?c.name:"annotations.json"},j=_.partial(f.Div,"textae-editor__save-dialog__row"),o=_.partial(f.Label,"textae-editor__save-dialog__label"),p=new f.Button("Save","url"),q=$("<div>").append((new j).append(new o(m.URL),$('<input type="text" class="textae-editor__save-dialog__server-file-name url" />'),p)).on("input","input.url",function(){f.enabled(p,this.value)}).on("click",'[type="button"].url',function(){d(f.getValueFromText(q,"url"),r.params),q.trigger("dialog.close")}).append((new j).append(new o(m.LOCAL),$('<input type="text" class="textae-editor__save-dialog__local-file-name local">'),$('<a class="download" href="#">Download</a>'))).on("click","a.download",function(){var a=g(r.params);$(this).attr("href",a).attr("download",f.getValueFromText(q,"local")),l.trigger("save"),q.trigger("dialog.close")}).append((new j).append(new o,$('<a class="viewsource" href="#">Click to see the json source in a new window.</a>'))).on("click","a.viewsource",function(){var a=g(r.params);return window.open(a,"_blank"),l.trigger("save"),q.trigger("dialog.close"),!1}),r=k("textae.dialog.save","Save Annotations",q);return r.on("dialogopen",function(){var a=h();r.find('[type="text"].local').val(a)}),r};return{showLoad:function(a,b){n(a).openAndSetParam(b)},showSave:function(a,b){o(a).openAndSetParam(b)}}}(),l=a("../util/extendBindable")({getAnnotationFromServer:j,showAccess:_.partial(k.showLoad,b.editorId),showSave:_.partial(k.showSave,b.editorId)});return l}},{"../util/CursorChanger":146,"../util/ajaxAccessor":148,"../util/extendBindable":151,"../util/jQuerySugar":155,"./dialog/GetEditorDialog":76,url:43}],69:[function(a,b){"use strict";var c=a("./dialog/GetToolDialog");b.exports=function(){var a=new c("textae-control__help","Help (Keyboard short-cuts)",{height:313,width:523},$("<div>").addClass("textae-tool__key-help"));return a.open}},{"./dialog/GetToolDialog":77}],70:[function(a,b){"use strict";var c=function(a){return $("<div>").addClass("textae-editor__type-pallet").append($("<table>")).css("position","fixed").on("click",".textae-editor__type-pallet__entity-type__label",function(){a.trigger("type.select",$(this).attr("label"))}).on("change",".textae-editor__type-pallet__entity-type__radio",function(){a.trigger("default-type.select",$(this).attr("label"))}).hide()},d={RadioButton:function(a,b){var c=$("<input>").addClass("textae-editor__type-pallet__entity-type__radio").attr({type:"radio",name:"etype",label:b});return b===a.getDefaultType()&&c.attr({title:"default type",checked:"checked"}),c},Link:function(a){return a?$("<a>").attr({href:a,target:"_blank"}).append($("<span>").addClass("textae-editor__type-pallet__link")):void 0},wrapTd:function(a){return a?$("<td>").append(a):$("<td>")}},e=function(a){var b=_.compose(d.wrapTd,_.partial(d.RadioButton,a)),c=function(a){return $("<td>").addClass("textae-editor__type-pallet__entity-type__label").attr("label",a).text(a)},e=_.compose(d.wrapTd,d.Link,a.getUri);return a.getSortedNames().map(function(d){var f=new b(d),g=new c(d),h=new e(d);return $("<tr>").addClass("textae-editor__type-pallet__entity-type").css({"background-color":a.getColor(d)}).append([f,g,h])})};b.exports=function(){var b=a("../util/extendBindable")({}),d=new c(b),f=function(){var a=function(a){var b=$(".textae-editor__type-pallet");return 0!==b.length?b.find("table").empty().end().css("width","auto"):($("body").append(a),a)},b=function(a,b){return b.find("table").append(new e(a)).end()},c=function(a){return a.outerHeight()+"px"===a.css("max-height")?a.css("overflow-y","scroll"):a.css("overflow-y","")},d=function(d,e,f){if(e&&e.getSortedNames().length>0){var g=_.compose(c,_.partial(b,e),a);g(d).css(f).show()}};return d}();return _.extend(b,{show:_.partial(f,d),hide:d.hide.bind(d)})}},{"../util/extendBindable":151}],71:[function(a,b){"use strict";var c=a("../view/lineHeight"),d=a("../util/jQuerySugar"),e=a("./dialog/GetEditorDialog"),f=function(a){return _.debounce(a,300)},g=function(a){return 16*a},h=function(){$(window).trigger("resize")},i=function(){return d.Div("textae-editor__setting-dialog")},j=function(a){return a.open()},k=function(a,b){return d.setChecked(b,".mode",a.showInstance()?"checked":null)},l=function(a,b){return d.setValue(b,".line-height",c.get(a))},m=function(a,b){return d.setValue(b,".type-gap",a.getTypeGap)},n=function(a){return a.find(".type-gap")},o=function(a,b){return d.enabled(n(b),a.showInstance()),b},p=function(a,b,c,d,e){e?b.toInstance():b.toTerm(),o(c,d),m(c,d),l(a,d)},q=_.partial(d.Label,"textae-editor__setting-dialog__label");b.exports=function(a,b,n){var r=function(c){var e=f(function(){p(a,b,n,c,$(this).is(":checked"))});return c.append(d.Div().append(new q("Instance/Relation View")).append(d.Checkbox("textae-editor__setting-dialog__term-centric-view mode"))).on("click",".mode",e)},s=function(b){var c=f(function(){n.changeTypeGap($(this).val()),l(a,b)});return b.append(d.Div().append(new q("Type Gap")).append(d.Number("textae-editor__setting-dialog__type-gap type-gap").attr({step:1,min:0,max:5}))).on("change",".type-gap",c)},t=function(b){var e=_.compose(_.partial(c.set,a),g),i=f(function(){e($(this).val()),h()});return b.append(d.Div().append(new q("Line Height")).append(d.Number("textae-editor__setting-dialog__line-height line-height").attr({step:1,min:3,max:50}))).on("change",".line-height",i)},u=function(b){return new e(a)("textae.dialog.setting","Setting",b,{noCancelButton:!0})};return _.compose(j,_.partial(l,a),_.partial(m,n),_.partial(o,n),_.partial(k,n),u,t,s,r,i)}},{"../util/jQuerySugar":155,"../view/lineHeight":184,"./dialog/GetEditorDialog":76}],72:[function(a,b){"use strict";var c=function(a){var b=a.find(".textae-editor__footer .textae-editor__footer__message");if(0===b.length){b=$("<div>").addClass("textae-editor__footer__message");var c=$("<div>").addClass("textae-editor__footer").append(b);a.append(c)}return b};b.exports=function(a){var b=_.partial(c,a),d=function(a){""!==a&&b().html("Source: "+a)};return{status:d}}},{}],73:[function(a,b){"use strict";var c=function(a,b,c){return $("<div>").attr("id",a).attr("title",b).hide().append(c)},d=function(a,b){return{open:function(){a.dialog(b)},close:function(){a.dialog("close")}}},e=function(a,b){return _.extend(b,new d(b,a))},f=function(a){return $("body").append(a),a};b.exports=function(a,b,d,g){a=_.extend({resizable:!1,modal:!0},a);var h=_.partial(e,a),i=_.compose(f,h,c);return i(b,d,g)}},{}],74:[function(a,b){"use strict";var c=a("./Dialog"),d=function(a,b){return a+"."+b},e={width:550,height:220};b.exports=function(a,b,f,g,h){var i=_.extend({},e,h);i.buttons=h&&h.noCancelButton?{}:{Cancel:function(){$(this).dialog("close")}};var j=new c(i,d(a,b),f,g);return _.extend(j,{id:b})}},{"./Dialog":73}],75:[function(a,b){"use strict";var c=function(a,b){return a[b]},d=function(a,b,c){return a[b]=c,c};b.exports=function(a){var b={},e=_.partial(c,b),f=_.partial(d,b),g=function(a,b){var c=a.apply(null,b);return f(c.id,c)};return function(b){return e(b)||g(a,arguments)}}},{}],76:[function(a,b){"use strict";var c=a("./EditorDialog"),d=a("./FunctionUseCache");b.exports=function(a){return a.getDialog=a.getDialog||new d(_.partial(c,a.editorId)),a.getDialog}},{"./EditorDialog":74,"./FunctionUseCache":75}],77:[function(a,b){"use strict";var c=a("./ToolDialog"),d=a("./FunctionUseCache");b.exports=new d(c)},{"./FunctionUseCache":75,"./ToolDialog":78}],78:[function(a,b){"use strict";var c=a("./Dialog");b.exports=function(a,b,d,e){var f=new c(d,a,b,e);return _.extend(f,{id:a})}},{"./Dialog":73}],79:[function(a,b){"use strict";var c=a("./dialog/GetEditorDialog"),d=a("handlebars"),e='\n    <div class="textae-editor__valiondate-dialog__content">\n        <h1>{{name}}</h1>\n        {{#if denotationHasLength}}\n            <table>\n                <caption>Spans are broken.</caption>\n                <thead>\n                    <tr>\n                        <th>id</th>\n                        <th>begin</th>\n                        <th>end</th>\n                        <th>obj</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {{#denotationHasLength}}\n                    <tr>\n                        <td>{{id}}</td>\n                        <td class="alert">{{span.begin}}</td>\n                        <td class="alert">{{span.end}}</td>\n                        <td>{{obj}}</td>\n                    </tr>\n                    {{/denotationHasLength}}\n                </tbody>\n            </table>\n        {{/if}}\n        {{#if denotationInText}}\n            <table>\n                <caption>Spans are out of text.</caption>\n                <thead>\n                    <tr>\n                        <th>id</th>\n                        <th>begin</th>\n                        <th>end</th>\n                        <th>obj</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {{#denotationInText}}\n                    <tr>\n                        <td>{{id}}</td>\n                        <td class="alert">{{span.begin}}</td>\n                        <td class="alert">{{span.end}}</td>\n                        <td>{{obj}}</td>\n                    </tr>\n                    {{/denotationInText}}\n                </tbody>\n            </table>\n        {{/if}}\n        {{#if denotationInParagraph}}\n            <table>\n                <caption>Spans are out of paragraphs.</caption>\n                <thead>\n                    <tr>\n                        <th>id</th>\n                        <th>begin</th>\n                        <th>end</th>\n                        <th>obj</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {{#denotationInParagraph}}\n                    <tr>\n                        <td>{{id}}</td>\n                        <td class="alert">{{span.begin}}</td>\n                        <td class="alert">{{span.end}}</td>\n                        <td>{{obj}}</td>\n                    </tr>\n                    {{/denotationInParagraph}}\n                </tbody>\n            </table>\n        {{/if}}\n        {{#if relationObj}}\n            <table>\n                <caption>Objects of relations are not exists.</caption>\n                <thead>\n                    <tr>\n                        <th>id</th>\n                        <th>pred</th>\n                        <th>subj</th>\n                        <th>obj</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {{#relationObj}}\n                    <tr>\n                        <td>{{id}}</td>\n                        <td>{{pred}}</td>\n                        <td>{{subj}}</td>\n                        <td class="alert">{{obj}}</td>\n                    </tr>\n                    {{/relationObj}}\n                </tbody>\n            </table>\n        {{/if}}\n        {{#if relationSubj}}\n            <table>\n                <caption>Subjects of relations are not exists.</caption>\n                <thead>\n                    <tr>\n                        <th>id</th>\n                        <th>pred</th>\n                        <th>subj</th>\n                        <th>obj</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {{#relationSubj}}\n                    <tr>\n                        <td>{{id}}</td>\n                        <td>{{pred}}</td>\n                        <td class="alert">{{subj}}</td>\n                        <td>{{obj}}</td>\n                    </tr>\n                    {{/relationSubj}}\n                </tbody>\n            </table>\n        {{/if}}\n        {{#if modification}}\n            <table>\n                <caption>Objects of modifications are not exists.</caption>\n                <thead>\n                    <tr>\n                        <th>id</th>\n                        <th>obj</th>\n                        <th>pred</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {{#modification}}\n                    <tr>\n                        <td>{{id}}</td>\n                        <td class="alert">{{obj}}</td>\n                        <td>{{pred}}</td>\n                    </tr>\n                    {{/modification}}\n                </tbody>\n            </table>\n        {{/if}}\n    </div>',f=d.compile(e),g=function(a){return a.reduce(function(a,b){return a||b.hasError
},!1)};b.exports=function(a,b){if(g(b)){var d=$("<div>"),e=new c(a)("textae.dialog.validation","The following erronious annotations ignored",d,{noCancelButton:!0,height:450});b.map(function(a){return f(a)}).forEach(function(a){d[0].insertAdjacentHTML("beforeend",a)}),e.open()}}},{"./dialog/GetEditorDialog":76,handlebars:59}],80:[function(a,b){"use strict";var c=function(){return $("<span>").addClass("textae-control__title").append($("<a>").attr({href:"http://textae.pubannotation.org/",target:"_blank"}).text("TextAE"))},d=function(a,b){return $("<span>").addClass("textae-control__icon").addClass("textae-control__"+a+"-button").attr("title",b)},e=function(){return $("<span>").addClass("textae-control__separator")},f=function(a,b){var f={},g=_.flatten(b.map(function(a){var b=_.map(a,function(a,b){var c=new d(b,a);return f[b]={instance:c,eventValue:"textae.control.button."+b.replace(/-/g,"_")+".click"},c});return[new e].concat(b)}));return a.append(new c).append($("<span>").append(g)),f},g={enable:function(a){a.removeClass("textae-control__icon--disabled")},disable:function(a){a.addClass("textae-control__icon--disabled")},isDisable:function(a){return a.hasClass("textae-control__icon--disabled")},push:function(a){a.addClass("textae-control__icon--pushed")},unpush:function(a){a.removeClass("textae-control__icon--pushed")},isPushed:function(a){return a.hasClass("textae-control__icon--pushed")}},h=function(a,b,c){var d="click";b===!0?(a.off(d).on(d,c),g.enable(a)):(a.off(d),g.disable(a))},i=function(a,b,c){_.each(c,function(c,d){var e=a[d],f=function(){return b(e.eventValue),!1};e&&h(e.instance,c,f)})};b.exports=function(a){var b=f(a,[{read:"Import [I]",write:"Upload [U]"},{undo:"Undo [Z]",redo:"Redo [A]"},{replicate:"Replicate span annotation [R]","replicate-auto":"Auto replicate","boundary-detection":"Boundary Detection [B]","relation-edit-mode":"Relation Edit Mode [F]"},{entity:"New entity [E]",pallet:"Select label [Q]","change-label":"Change label [W]"},{negation:"Negation [X]",speculation:"Speculation [S]"},{"delete":"Delete [D]",copy:"Copy [C]",paste:"Paste [V]"},{setting:"Setting"},{help:"Help [H]"}]),c=a.trigger.bind(a,"textae.control.button.click"),d=_.partial(i,b,c),e={read:!0,help:!0},h=function(a){d(_.extend({},b,e,a))},j=function(a,c){var d=b[a].instance;c?g.push(d):g.unpush(d)};return a.updateAllButtonEnableState=h,a.updateButtonPushState=j,a}},{}],81:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){return a("./component/DataAccessObject")(b,c).bind("save",function(){d.saved(),toastr.success("annotation saved")}).bind("save error",function(){toastr.error("could not save")}).bind("load",function(a){f(a.annotation),e.status(a.source)})}},{"./component/DataAccessObject":68}],82:[function(a,b){"use strict";var c=a("./model/Model"),d=a("./model/History"),e=a("./SpanConfig"),f=a("./command"),g=a("./view/ButtonController"),h=a("./view/TypeContainer"),i=a("./view/View"),j=a("./presenter/Presenter"),k=a("./Controller"),l=a("./createDaoForEditor"),m=a("./getParams"),n=a("./component/showVilidationDialog"),o=function(a,b){return a.setDefinedEntityTypes(b?b["entity types"]:[]),a.setDefinedRelationTypes(b?b["relation types"]:[]),b&&void 0!==b.css&&$("#css_area").html('<link rel="stylesheet" href="'+b.css+'"/>'),b},p=function(a,b,c){a[b]&&a[b](c)},q=a("./component/StatusBar"),r=function(a,b){return"on"===b?new q(a):{status:function(){}}},s=a("./util/ObservableValue"),t=a("./util/ajaxAccessor");b.exports=function(){var a=this,b=new c(this),q=new d,u=new e,v=new f(this,b,q),w={clipBoard:[]},x=new g(this,b,w),y=new s(-1),z=new h(b),A=new i(this,b,x,y.get,z),B=new j(this,b,A,v,u,w,x,y,z),C=new k(this,q,B,A,x.buttonStateHelper),D=function(a){u.set(a),o(z,a)},E=function(a){return u.reset(),D(a.config),a.config?void 0:"no config"},F=function(c){var d=b.annotationData.reset(c);q.reset(),n(a,d)},G=function(a,b){u.reset(),"string"==typeof a?t.getAsync(a,function(a){D(a),F(b)},function(){alert("could not read the span configuration from the location you specified.: "+a)}):F(b)},H=function(a,b){var c=E(b);"no config"===c?G(a,b):F(b)},I=function(a,b,c){var d=b.annotation;d&&(d.inlineAnnotation?(H(b.config,JSON.parse(d.inlineAnnotation)),a.status("inline")):d.url&&c.getAnnotationFromServer(d.url))};return y.on("change",A.setTypeGap),this.api=function(a){var c=function(c){var d=function(){c.showAccess(q.hasAnythingToSave())},e=function(){c.showSave(b.annotationData.toJson())},f={A:v.redo,B:B.event.toggleDetectBoundaryMode,C:B.event.copyEntities,D:B.event.removeSelectedElements,DEL:B.event.removeSelectedElements,E:B.event.createEntity,F:B.event.toggleRelationEditMode,I:d,M:B.event.toggleRelationEditMode,Q:B.event.showPallet,R:B.event.replicate,S:B.event.speculation,U:e,V:B.event.pasteEntities,W:B.event.newLabel,X:B.event.negation,Y:v.redo,Z:v.undo,ESC:B.event.cancelSelect,LEFT:B.event.selectLeftSpan,RIGHT:B.event.selectRightSpan},g={"textae.control.button.read.click":d,"textae.control.button.write.click":e,"textae.control.button.undo.click":v.undo,"textae.control.button.redo.click":v.redo,"textae.control.button.replicate.click":B.event.replicate,"textae.control.button.replicate_auto.click":x.modeAccordingToButton["replicate-auto"].toggle,"textae.control.button.boundary_detection.click":B.event.toggleDetectBoundaryMode,"textae.control.button.relation_edit_mode.click":B.event.toggleRelationEditMode,"textae.control.button.entity.click":B.event.createEntity,"textae.control.button.change_label.click":B.event.newLabel,"textae.control.button.pallet.click":B.event.showPallet,"textae.control.button.negation.click":B.event.negation,"textae.control.button.speculation.click":B.event.speculation,"textae.control.button.delete.click":B.event.removeSelectedElements,"textae.control.button.copy.click":B.event.copyEntities,"textae.control.button.paste.click":B.event.pasteEntities,"textae.control.button.setting.click":B.event.showSettingDialog};a.api={handleKeyInput:_.partial(p,f),handleButtonClick:_.partial(p,g),redraw:function(){console.log(a.editorId,"redraw"),A.updateDisplay(y.get())}}},d=function(a){var b="There is a change that has not been saved. If you procceed now, you will lose it.",d=m(a);A.init(),C.init(b),B.init();var e=r(a,d.status_bar),f=l(a,b,q,e,_.partial(H,d.config));B.setMode(d.mode),I(e,d,f),c(f)};return{start:d}}(this),this}},{"./Controller":60,"./SpanConfig":61,"./command":66,"./component/StatusBar":72,"./component/showVilidationDialog":79,"./createDaoForEditor":81,"./getParams":83,"./model/History":103,"./model/Model":104,"./presenter/Presenter":120,"./util/ObservableValue":147,"./util/ajaxAccessor":148,"./view/ButtonController":158,"./view/TypeContainer":181,"./view/View":182}],83:[function(a,b){"use strict";var c=a("./util/getUrlParameters"),d=function(a,b,c){!a[c]&&b.attr(c)&&(a[c]=b.attr(c))},e=function(a,b,c){b.attr(c)&&(a[c]=b.attr(c))};b.exports=function(a){var b=c(location.search);b.target=a.attr("source")||a.attr("target")||b.source||b.target,e(b,a,"config"),e(b,a,"status_bar"),d(b,a,"mode");var f=a.text();return a.empty(),b.annotation={inlineAnnotation:f,url:b.target},b}},{"./util/getUrlParameters":152}],84:[function(a){"use strict";var b=a("./tool"),c=a("./control"),d=a("./editor");jQuery.fn.textae=function(){return function(){if(this.hasClass("textae-editor"))this.each(function(){var a=$(this);return b.pushEditor(a),d.apply(a),a.api.start(a),a}),b.selectFirstEditor();else if(this.hasClass("textae-control")){var a=c(this);return b.setControl(a),a}}}()},{"./control":80,"./editor":82,"./tool":143}],85:[function(a,b){"use strict";var c=a("../../../util/idFactory"),d=a("./ModelContainer"),e=function(a,b){return{id:b.id,span:c.makeSpanId(a,b.span),type:b.obj}},f=function(a,b){return b=b||[],b.map(_.partial(e,a))},g=function(a,b,c){var e=new d(b,"entity",_.partial(f,a),"T"),g=_.compose(e.add,function(a){if(a.span)return a;throw new Error("entity has no span! "+JSON.stringify(a))}),h=function(a){return c.all().filter(function(b){return b.obj===a||b.subj===a}).map(function(a){return a.id})},i=_.extend(e,{add:g,assosicatedRelations:h});return i};b.exports=g},{"../../../util/idFactory":153,"./ModelContainer":86}],86:[function(a,b){"use strict";var c=a("./getNextId"),d='Set the mappingFunction by the constructor to use the method "ModelContainer.setSource".';b.exports=function(a,b,e,f){var g={},h=function(){return Object.keys(g)},i=_.partial(c,f?f:b.charAt(0).toUpperCase()),j=function(a){return a.id=a.id||i(h()),g[a.id]=a,a},k=function(a){a&&(a.sort(function(a,b){return a.id?b.id?a.id<b.id?-1:a.id>b.id?1:0:-1:1}),a.forEach(j))},l=function(a){return g[a]},m=function(){return _.map(g,_.identity)},n=function(){g={}};return{name:b,addSource:function(a){if(!_.isFunction(e))throw new Error(d);k(e(a))},add:function(c,d){var e=j(c);return _.isFunction(d)&&d(),a.emit(b+".add",e),e},get:l,all:m,some:function(){return _.some(g)},types:function(){return m().map(function(a){return a.type})},changeType:function(c,d){var e=l(c);return e.type=d,a.emit(b+".change",e),e},remove:function(c){var d=g[c];return d&&(delete g[c],a.emit(b+".remove",d)),d},clear:n}}},{"./getNextId":89}],87:[function(a,b){"use strict";var c=a("../../../util/idFactory"),d=a("./ModelContainer");b.exports=function(a,b){var e=function(b){b=b||[];var d=0;return b.split("\n").map(function(b,e){var f={id:c.makeParagraphId(a,e),begin:d,end:d+b.length};return d+=b.length+1,f})},f=new d(b,"paragraph",e),g=_.extend(f,{getBelongingTo:function(a){var b=f.all().filter(function(b){return a.begin>=b.begin&&a.end<=b.end});if(0===b.length)throw new Error("span should belong to any paragraph.");return b[0]}});return g}},{"../../../util/idFactory":153,"./ModelContainer":86}],88:[function(a,b){"use strict";var c=a("../../../util/idFactory"),d=a("./ModelContainer"),e=function(a,b,d,e){if(!e)return!1;var f=c.makeSpanId(a,e);if(!b.get(f))throw new Error("maybeParent is removed. "+e.toStringOnlyThis());return e.begin<=d.begin&&d.end<=e.end};b.exports=function(b,f,g){var h=function(){var a={toStringOnlyThis:function(){return"span "+this.begin+":"+this.end+":"+f.sourceDoc.substring(this.begin,this.end)},toString:function(a){a=a||1;var b=this.children&&this.children.length>0?"\n"+this.children.map(function(b){return new Array(a+1).join("	")+b.toString(a+1)}).join("\n"):"";return this.toStringOnlyThis()+b},getBigBrother:function(){var a;return this.parent?(a=this.parent.children.indexOf(this),0===a?null:this.parent.children[a-1]):(a=l.indexOf(this),0===a||l[a-1].paragraph!==this.paragraph?null:l[a-1])},getTypes:function(){var a=this.id;return f.entity.all().filter(function(b){return a===b.span}).reduce(function(a,b){var d=c.makeTypeId(b.span,b.type),e=a.filter(function(a){return a.id===d});return e.length>0?e[0].entities.push(b.id):a.push({id:d,name:b.type,entities:[b.id]}),a},[])},getEntities:function(){return _.flatten(this.getTypes().map(function(a){return a.entities}))}};return function(d){return $.extend({},d,{id:c.makeSpanId(b,d),paragraph:g.getBelongingTo(d)},a)}}(),i=a("../../isBoundaryCrossingWithOtherSpans"),j=function(a){return a=a||[],a.map(function(a){return a.span}).map(h).filter(function(a,b,c){return!i(c.slice(0,b-1),a)})},k=new d(f,"span",j),l=[],m=function(a,b){a.children.push(b),b.parent=a},n=function(a,c){return e(b,k,c,a)?a:a.parent?n(a.parent,c):null},o=function(){var a=k.all().sort(p),b=[];a.map(function(a,b,c){return $.extend(a,{parent:null,children:[],left:0!==b?c[b-1]:null,right:b!==c.length-1?c[b+1]:null})}).forEach(function(a){if(a.left){var c=n(a.left,a);c?m(c,a):b.push(a)}else b.push(a)}),b.toString=function(){return this.map(function(a){return a.toString()}).join("\n")},l=b},p=function(a,b){return a.begin-b.begin||b.end-a.end},q={add:function(a){if(a)return k.add(h(a),o);throw new Error("span is undefined.")},addSource:function(a){k.addSource(a),o()},get:function(a){return k.get(a)},all:k.all,range:function(a,b){var c=k.get(a),d=k.get(b);if(p(c,d)>0){var e=c;c=d,d=e}return k.all().filter(function(a){return c.begin<=a.begin&&a.end<=d.end}).map(function(a){return a.id})},topLevel:function(){return l},multiEntities:function(){return k.all().filter(function(a){var b=a.getTypes().filter(function(a){return a.entities.length>1});return b.length>0})},remove:k.remove,clear:function(){k.clear(),l=[]}};return q}},{"../../../util/idFactory":153,"../../isBoundaryCrossingWithOtherSpans":108,"./ModelContainer":86}],89:[function(a,b){"use strict";var c=function(a,b){return b[0]===a},d=function(a){return a.slice(1)},e=function(a,b){var e=b.filter(_.partial(c,a)).map(d),f=0===e.length?0:Math.max.apply(null,e),g=f+1;return a+g};b.exports=e},{}],90:[function(a,b){"use strict";var c=a("events").EventEmitter,d=a("./ModelContainer"),e=a("./ParagraphContainer"),f=a("./SpanContainer"),g=a("./EntityContainer"),h=function(a){var b=new c,h=_.partial(d,b),i=new e(a,b),j=new f(a,b,i),k=new h("relation",function(a){return a=a||[],a.map(function(a){return{id:a.id,type:a.pred,subj:a.subj,obj:a.obj}})}),l=new g(a,b,k),m=new h("modification",_.identity);return _.extend(b,{span:j,entity:l,relation:k,modification:m,paragraph:i,sourceDoc:""})};b.exports=h},{"./EntityContainer":85,"./ModelContainer":86,"./ParagraphContainer":87,"./SpanContainer":88,events:37}],91:[function(a,b){"use strict";var c=a("./setNewData"),d=a("./toJson"),e=a("./Container"),f=function(a){a.span.clear(),a.entity.clear(),a.relation.clear(),a.modification.clear(),a.paragraph.clear()},g=function(a){var b,g=new e(a);return _.extend(g,{reset:function(a){try{if(f(g),!a.text)throw"read failed.";var d=c(g,a);return b=a,g.emit("change-text",{sourceDoc:g.sourceDoc,paragraphs:g.paragraph.all()}),g.emit("all.change",g),d}catch(e){console.error(e,e.stack)}},toJson:function(){return JSON.stringify(d(b,g))},getModificationOf:function(a){return g.modification.all().filter(function(b){return b.obj===a})}})};b.exports=g},{"./Container":90,"./setNewData":101,"./toJson":102}],92:[function(a,b){"use strict";b.exports=function(a,b,c){c&&(c=c.map(b)),a.forEach(function(a){a.addSource(c)})}},{}],93:[function(a,b){"use strict";var c=a("./importSource"),d=a("./translateDenotation"),e=a("./translateRelation"),f=a("./translateModification"),g=function(a,b,g,h,i,j,k,l){c([a,b],_.partial(d,l),i),c([g],_.partial(e,l),j),c([h],_.partial(f,l),k)};b.exports=g},{"./importSource":92,"./translateDenotation":95,"./translateModification":96,"./translateRelation":97}],94:[function(a,b){"use strict";b.exports=function(a,b){return a.id?b+a.id:null}},{}],95:[function(a,b){"use strict";var c=a("./setIdPrefixIfExist");b.exports=function(a,b){return a=a||"",_.extend({},b,{id:c(b,a)})}},{"./setIdPrefixIfExist":94}],96:[function(a,b){"use strict";var c=a("./setIdPrefixIfExist");b.exports=function(a,b){return a=a||"",_.extend({},b,{id:c(b,a),obj:a+b.obj})}},{"./setIdPrefixIfExist":94}],97:[function(a,b){"use strict";var c=a("./setIdPrefixIfExist");b.exports=function(a,b){return a=a||"",_.extend({},b,{id:c(b,a),subj:a+b.subj,obj:a+b.obj})}},{"./setIdPrefixIfExist":94}],98:[function(a,b){"use strict";var c=a("./validateAnnotation"),d=a("./importAnnotation"),e=function(a,b,e,f,g,h,i,j){var k=c(h,g,i);return d(a,b,e,f,k.accept.denotation,k.accept.relation,k.accept.modification,j),k.reject};b.exports=e},{"./importAnnotation":93,"./validateAnnotation":99}],99:[function(a,b){"use strict";var c=a("./validate"),d=function(a){return a.span.end-a.span.begin>0},e=function(a,b){return a>=0&&a<=b.length},f=function(a,b){return e(b.span.begin,a)&&e(b.span.end,a)},g=function(a,b){return 1===a.all().filter(function(a){return a.begin<=b.span.begin&&b.span.end<=a.end}).length},h=function(a,b){return a.dictionary?1===a.dictionary.filter(function(c){return c.id===b[a.property]}).length:!1},i=function(a,b,e){var i=c(e.denotations,d),j=c(i.accept,f,a),k=c(j.accept,g,b),l=c(e.relations,h,{property:"obj",dictionary:k.accept}),m=c(l.accept,h,{property:"subj",dictionary:k.accept}),n=c(e.modifications,h,{property:"obj",dictionary:_.union(k.accept,m.accept)});return{accept:{denotation:k.accept,relation:m.accept,modification:n.accept},reject:{denotationHasLength:i.reject,denotationInText:j.reject,denotationInParagraph:k.reject,relationObj:l.reject,relationSubj:m.reject,modification:n.reject,hasError:i.reject.length+j.reject.length+k.reject.length+l.reject.length+m.reject.length+n.reject.length!==0}}};b.exports=i},{"./validate":100}],100:[function(a,b){"use strict";var c=function(a){return{accept:[],reject:a?a:[]}},d=function(a,b){return b?_.partial(a,b):a},e=function(a,b,c){return a(c)?b.accept.push(c):b.reject.push(c),b},f=function(a,b,f){return a?(b=d(b,f),a.reduce(_.partial(e,b),new c)):new c};b.exports=f},{}],101:[function(a,b){"use strict";var c=a("./parseAnnotation"),d=function(a,b){a.addSource(b)},e=function(a,b,d,e,f,g,h){if(!h.tracks)return[];var i=h.tracks;return delete h.tracks,i.map(function(h,i){var j=i+1,k="track"+j+"_",l=c(a,b,d,e,f,g,h,k);return l.name="Track "+j+" annotaiton.",l})},f=function(a,b){var d=e(a.span,a.entity,a.relation,a.modification,a.paragraph,b.text,b),f=c(a.span,a.entity,a.relation,a.modification,a.paragraph,b.text,b);return f.name="Root annotation.",[f].concat(d)},g=function(a,b){return d(a.paragraph,b.text),a.sourceDoc=b.text,a.config=b.config,f(a,b)};b.exports=g},{"./parseAnnotation":98}],102:[function(a,b){"use strict";var c=function(a){return a.entity.all().filter(function(b){return a.span.get(b.span)}).map(function(b){var c=a.span.get(b.span);return{id:b.id,span:{begin:c.begin,end:c.end},obj:b.type}})},d=function(a){return a.relation.all().map(function(a){return{id:a.id,pred:a.type,subj:a.subj,obj:a.obj}})},e=function(a,b){return _.extend({},a,{denotations:c(b),relations:d(b),modifications:b.modification.all()})};b.exports=e},{}],103:[function(a,b){"use strict";b.exports=function(){var b=-1,c=-1,d=[],e=function(){return c>-1},f=function(){return c<d.length-1},g=function(){return c!=b},h=function(){i.trigger("change",{hasAnythingToSave:g(),hasAnythingToUndo:e(),hasAnythingToRedo:f()})},i=a("../util/extendBindable")({reset:function(){b=-1,c=-1,d=[],h()},push:function(a){d.splice(c+1,d.length-c,a),c++,h()},next:function(){return c++,h(),d[c]},prev:function(){var a=d[c];return c--,h(),a},saved:function(){b=c,h()},hasAnythingToSave:g,hasAnythingToUndo:e,hasAnythingToRedo:f});return i}},{"../util/extendBindable":151}],104:[function(a,b){"use strict";var c=a("./AnnotationData");b.exports=function(b){return{annotationData:new c(b),selectionModel:a("./Selection")(["span","entity","relation"])}}},{"./AnnotationData":91,"./Selection":106}],105:[function(a,b){"use strict";var c=a("events").EventEmitter;b.exports=function(a){var b=new c,d={},e=function(){b.emit(a+".change")},f=function(c){d[c]=c,b.emit(a+".add",c),e()},g=function(){return _.toArray(d)},h=function(a){return _.contains(d,a)},i=function(){return _.some(d)},j=function(){var a=g();return 1===a.length?a[0]:null},k=function(c){delete d[c],b.emit(a+".remove",c),e()},l=function(a){h(a)?k(a):f(a)},m=function(){i()&&(_.each(g(),k),d={},e())},n={name:a,add:f,all:g,has:h,some:i,single:j,toggle:l,remove:k,clear:m},o=_.extend(b,n);return o}},{events:37}],106:[function(a,b){"use strict";var c=a("events").EventEmitter,d=a("./IdContainer"),e=function(a){_.each(a,function(a){a.clear()})},f=function(a){return a.map(function(a){return a.some()}).reduce(function(a,b){return a||b})},g=function(a,b){_.each(b,function(b){b.on(b.name+".change",function(){a.emit(b.name+".change")}).on(b.name+".add",function(c){a.emit(b.name+".select",c)}).on(b.name+".remove",function(c){a.emit(b.name+".deselect",c)})})},h=function(a,b){return _.extend(a,{clear:_.partial(e,b),some:_.partial(f,b)})};b.exports=function(a){var b=new c,e=a.map(d),f=e.reduce(function(a,b){return a[b.name]=b,a},{}),i=_.extend(b,f);return g(b,e),h(i,e)}},{"./IdContainer":105,events:37}],107:[function(a,b){"use strict";b.exports=function(a,b){return a.filter(function(a){return a.begin===b.begin&&a.end===b.end}).length>0}},{}],108:[function(a,b){"use strict";b.exports=function(a,b){return a.filter(function(a){return a.begin<b.begin&&b.begin<a.end&&a.end<b.end||b.begin<a.begin&&a.begin<b.end&&b.end<a.end}).length>0}},{}],109:[function(a,b){"use strict";b.exports=function(a,b,c,d){var e=function(){d.clipBoard=_.uniq(function(){return _.flatten(c.span.all().map(function(a){return b.span.get(a).getEntities()}))}().concat(c.entity.all())).map(function(a){return b.entity.get(a).type})},f=function(){var b=_.flatten(c.span.all().map(function(b){return d.clipBoard.map(function(c){return a.factory.entityCreateCommand({span:b,type:c})})}));a.invoke(b)};return{copyEntities:e,pasteEntities:f}}},{}],110:[function(a,b){"use strict";var c=a("events").EventEmitter,d=a("./replicate"),e=a("./createEntityToSelectedSpan"),f=function(a,b,f,g,h,i){var j=new c,k=function(){d(a,b,g,h,f.span.single(),i)},l=function(){e(a,f.span.all(),i),j.emit("createEntity")};return _.extend(j,{replicate:k,createEntity:l})};b.exports=f},{"./createEntityToSelectedSpan":125,"./replicate":126,events:37}],111:[function(a,b){"use strict";var c=function(){var b={instanceHide:0,instanceShow:2},c=_.extend({},b),d=function(a,b){return c[a]=b,b},e=a("../util/capitalize");return _.each(b,function(a,b){c["set"+e(b)]=_.partial(d,b)}),c},d=function(a,b){var d=!0,e=new c,f=function(){a.set(d?e.instanceShow:e.instanceHide)},g=function(a){d=a,f()};return b.on("show",function(){g(!0)}).on("hide",function(){g(!1)}),{showInstance:function(){return d},changeTypeGap:function(a){d?e.setInstanceShow(a):e.setInstanceHide(a),f()},getTypeGap:function(){return a.get()},notifyNewInstance:function(){d||toastr.success("an instance is created behind.")}}};b.exports=d},{"../util/capitalize":149}],112:[function(a,b){"use strict";var c=a("./RemoveCommandsFromSelection");b.exports=function(a,b,d){return{newLabel:function(){if(b.entity.some()||b.relation.some()){var a=prompt("Please enter a new label","");a&&d.setNewType(a)}},removeSelectedElements:function(){var d=new c(a,b);a.invoke(d)}}}},{"./RemoveCommandsFromSelection":121}],113:[function(a,b){"use strict";b.exports=function(a){return{toTerm:function(){a.setState("Term Contric")},toInstance:function(){a.setState("Instance / Relation")},toRelation:function(){a.setState("Relation Edit")}}}},{}],114:[function(a,b){"use strict";var c=a("emitter-fsm"),d=function(){var a=new c({states:["Init","Term Contric","Instance / Relation","Relation Edit","View Term","View Instance"]});return a.config("View Term",{to:{only:["View Instance"]}}),a.config("View Instance",{to:{only:["View Term"]}}),a};b.exports=d},{"emitter-fsm":35}],115:[function(a,b){"use strict";var c=function(a,b){a.hideDialogs(),b.clear()},d=function(a,b,d,e){var f={toTerm:function(){c(a,b),a.editEntity(),d.setTerm(),d.setEditable(!0),e.emit("hide")},toInstance:function(){c(a,b),a.editEntity(),d.setInstance(),d.setEditable(!0),e.emit("show")},toRelation:function(){c(a,b),a.editRelation(),d.setRelation(),d.setEditable(!0),e.emit("show")},toViewTerm:function(){c(a,b),d.setTerm(),d.setEditable(!1),e.emit("hide")},toViewInstance:function(){c(a,b),d.setInstance(),d.setEditable(!1),e.emit("show")}};return f};b.exports=d},{}],116:[function(a,b){"use strict";var c=a("../../view/Selector"),d=function(a,b){a.removeClass("textae-editor_term-mode").removeClass("textae-editor_instance-mode").removeClass("textae-editor_relation-mode").addClass("textae-editor_"+b+"-mode")};b.exports=function(a,b,e,f){var g=new c(a,b),h=_.partial(e.enabled,"setting",!0),i=function(a){e.enabled("replicate-auto",!a),e.enabled("boundary-detection",!a),f["relation-edit-mode"].value(a)},j=_.compose(e.updateByEntity,g.entityLabel.update),k={setTerm:function(){d(a,"term"),h(),i(!1),b.selectionModel.removeListener("entity.select",j).removeListener("entity.deselect",j).removeListener("entity.change",j).on("entity.select",j).on("entity.deselect",j).on("entity.change",e.updateByEntity)},setInstance:function(){d(a,"instance"),h(),i(!1),b.selectionModel.removeListener("entity.select",j).removeListener("entity.deselect",j).removeListener("entity.change",e.updateByEntity).on("entity.select",j).on("entity.deselect",j).on("entity.change",e.updateByEntity)},setRelation:function(){d(a,"relation"),h(),i(!0),b.selectionModel.removeListener("entity.select",j).removeListener("entity.deselect",j).removeListener("entity.change",e.updateByEntity)},setEditable:function(b){b?(a.addClass("textae-editor_editable"),e.enabled("relation-edit-mode",!0)):(a.removeClass("textae-editor_editable"),e.enabled("replicate-auto",!1),e.enabled("boundary-detection",!1),e.enabled("relation-edit-mode",!1))}};return k}},{"../../view/Selector":180}],117:[function(a,b){"use strict";b.exports=function(a){return{toInstance:function(){a.setState("View Instance")},toTerm:function(){a.setState("View Term")},toRelation:function(){}}}},{}],118:[function(a,b){"use strict";var c=a("events").EventEmitter,d=(a("emitter-fsm"),a("./ViewMode")),e=a("./StateMachine"),f=a("./Transition"),g=a("./ViewModeApi"),h=a("./EditModeApi"),i=function(a,b,c,d,e,f){f?(b.setEditable(!0),_.extend(c,d)):(a.noEdit(),b.setEditable(!1),_.extend(c,e))};b.exports=function(a,b,j,k,l){var m=new d(a,b,k,l),n=new e,o=new c,p=new f(j,b.selectionModel,m,o),q=new g(n),r=new h(n);return n.on("transition",function(){}).on("enter:Term Contric",p.toTerm).on("enter:Instance / Relation",p.toInstance).on("enter:Relation Edit",p.toRelation).on("enter:View Term",p.toViewTerm).on("enter:View Instance",p.toViewInstance),o.init=_.partial(i,j,m,o,r,q),o}},{"./EditModeApi":113,"./StateMachine":114,"./Transition":115,"./ViewMode":116,"./ViewModeApi":117,"emitter-fsm":35,events:37}],119:[function(a,b){"use strict";var c=a("./toggleModification");b.exports=function(a,b,d,e){return{negation:function(){c(a,b,d,"Negation",e)},speculation:function(){c(a,b,d,"Speculation",e)}}}},{"./toggleModification":132}],120:[function(a,b){"use strict";var c=a("./typeEditor/TypeEditor"),d=a("./EditMode"),e=a("./DisplayInstance"),f=a("./DefaultEntityHandler"),g=a("./ClipBoardHandler"),h=a("./ModificationHandler"),i=a("./EditHandler"),j=a("./ToggleButtonHandler"),k=a("./SelectSpanHandler"),l=a("./SetEditableHandler"),m=a("../component/SettingDialog"),n=a("../util/CursorChanger"),o=a("../view/lineHeight");b.exports=function(a,b,p,q,r,s,t,u,v){var w=new c(a,b,r,q,t.modeAccordingToButton,v),x=new d(a,b,w,t.buttonStateHelper,t.modeAccordingToButton),y=new e(u,x),z=new f(q,b.annotationData,b.selectionModel,t.modeAccordingToButton,r,v.entity),A=new g(q,b.annotationData,b.selectionModel,s),B=new h(q,b.annotationData,t.modeAccordingToButton,w),C=new i(q,b.selectionModel,w),D=new j(t.modeAccordingToButton,x),E=new k(b.annotationData,b.selectionModel),F=new l(b.annotationData,x),G=new m(a,x,y),H=function(){w.hideDialogs(),a.eventEmitter.trigger("textae.editor.select"),t.buttonStateHelper.propagate()};return{init:function(){a.on("textae.editor.jsPlumbConnection.add",function(a,b){b.bindClickAction(w.jsPlumbConnectionClicked)});var c=new n(a);p.bind("render.start",function(){c.startWait()}).bind("render.end",function(){c.endWait()}),u.on("change",function(c){o.setToTypeGap(a,b,c)}),z.on("createEntity",y.notifyNewInstance)},setMode:F.bindSetDefaultEditMode,event:{editorSelected:H,copyEntities:A.copyEntities,removeSelectedElements:C.removeSelectedElements,createEntity:z.createEntity,showPallet:w.showPallet,replicate:z.replicate,pasteEntities:A.pasteEntities,newLabel:C.newLabel,cancelSelect:w.cancelSelect,selectLeftSpan:E.selectLeftSpan,selectRightSpan:E.selectRightSpan,toggleDetectBoundaryMode:D.toggleDetectBoundaryMode,toggleRelationEditMode:D.toggleRelationEditMode,negation:B.negation,speculation:B.speculation,showSettingDialog:G}}}},{"../component/SettingDialog":71,"../util/CursorChanger":146,"../view/lineHeight":184,"./ClipBoardHandler":109,"./DefaultEntityHandler":110,"./DisplayInstance":111,"./EditHandler":112,"./EditMode":118,"./ModificationHandler":119,"./SelectSpanHandler":122,"./SetEditableHandler":123,"./ToggleButtonHandler":124,"./typeEditor/TypeEditor":138}],121:[function(a,b){"use strict";var c=function(a,b){return a.map(b.factory.spanRemoveCommand)},d=function(a,b){return b.factory.entityRemoveCommand(a)},e=function(a,b){return a.map(b.factory.relationRemoveCommand)},f=function(a,b,f,g){return[].concat(e(g,a),d(f,a),c(b,a))},g=function(a,b){var c=_.uniq(b.span.all()),d=_.uniq(b.entity.all()),e=_.uniq(b.relation.all());return f(a,c,d,e)};b.exports=g},{}],122:[function(a,b){"use strict";b.exports=function(a,b){return{selectLeftSpan:function(){var c=b.span.single();if(c){var d=a.span.get(c);b.clear(),d.left&&b.span.add(d.left.id)}},selectRightSpan:function(){var c=b.span.single();if(c){var d=a.span.get(c);b.clear(),d.right&&b.span.add(d.right.id)}}}}},{}],123:[function(a,b){"use strict";var c=a("./setDefaultEditMode");b.exports=function(a,b){return{bindSetDefaultEditMode:function(d){var e="edit"===d;a.on("all.change",function(a){c(b,e,a)})}}}},{"./setDefaultEditMode":127}],124:[function(a,b){"use strict";b.exports=function(a,b){return{toggleDetectBoundaryMode:function(){a["boundary-detection"].toggle()},toggleRelationEditMode:function(){a["relation-edit-mode"].value()?b.toInstance():b.toRelation()}}}},{}],125:[function(a,b){"use strict";b.exports=function(a,b,c){var d=b.map(function(b){return a.factory.entityCreateCommand({span:b,type:c.getDefaultType()})});a.invoke(d)}},{}],126:[function(a,b){"use strict";var c=function(a,b){return a["boundary-detection"].value()?b.isDelimiter:null},d=function(a,b,d,e,f,g){var h=c(d,e);f?a.invoke([a.factory.spanReplicateCommand(g.getDefaultType(),b.span.get(f),h)]):alert("You can replicate span annotation when there is only span selected.")};b.exports=d},{}],127:[function(a,b){"use strict";var c=function(a,b,c){a.init(b),c.relation.some()||c.span.multiEntities().length>0?a.toInstance():a.toTerm()};b.exports=c},{}],128:[function(a,b){"use strict";var c=a("./skipBlank");b.exports={backFromBegin:function(a,b,d){return c.forward(a,b,d.isBlankCharacter)},forwardFromEnd:function(a,b,d){return c.back(a,b,d.isBlankCharacter)},forwardFromBegin:function(a,b,d){return c.forward(a,b,d.isBlankCharacter)},backFromEnd:function(a,b,d){return c.back(a,b,d.isBlankCharacter)}}},{"./skipBlank":130}],129:[function(a,b){"use strict";var c=a("./skipCharacters"),d=a("./skipBlank"),e=function(a,b){return[a.charAt(b),a.charAt(b-1)]},f=function(a,b){return[a.charAt(b),a.charAt(b+1)]},g=function(a,b,d){return c(e,-1,a,b,function(a){return a[1]&&!d(a[0])&&!d(a[1])})},h=function(a,b,d){return c(f,1,a,b,function(a){return a[1]&&!d(a[0])&&!d(a[1])})},i=function(a,b,c){return""!==c[0]&&!a(c[1])&&!b(c[1])||b(c[0])},j=function(a,b,d){return c(e,1,a,b,d)},k=function(a,b,d){return c(f,-1,a,b,d)},l=function(a,b,c){var e=d.forward(a,b,c.isBlankCharacter),f=g(a,e,c.isDelimiter);return f},m=function(a,b,c){var e=d.back(a,b,c.isBlankCharacter),f=h(a,e,c.isDelimiter);return f},n=function(a,b,c){var d=_.partial(i,c.isBlankCharacter,c.isDelimiter);return j(a,b,d)},o=function(a,b,c){var d=_.partial(i,c.isBlankCharacter,c.isDelimiter);return k(a,b,d)};b.exports={backFromBegin:l,forwardFromEnd:m,forwardFromBegin:n,backFromEnd:o}},{"./skipBlank":130,"./skipCharacters":131}],130:[function(a,b){"use strict";var c=a("./skipCharacters"),d=function(a,b){return a.charAt(b)},e=function(a,b,e){return c(d,1,a,b,e)},f=function(a,b,e){return c(d,-1,a,b,e)};b.exports={forward:e,back:f}},{"./skipCharacters":131}],131:[function(a,b){"use strict";b.exports=function(a,b,c,d,e){for(;e(a(c,d));)d+=b;return d}},{}],132:[function(a,b){"use strict";var c=function(a,b){return a.pred===b},d=function(a,b,d){return a.getModificationOf(b).filter(function(a){return c(a,d)})},e=function(a,b,c,e){return e.getSelectedIdEditable().map(function(e){var f=d(b,e,c)[0];return a.factory.modificationRemoveCommand(f.id)})},f=function(a,b,c,e){return _.reject(e.getSelectedIdEditable(),function(a){return d(b,a,c).length>0}).map(function(b){return a.factory.modificationCreateCommand({obj:b,pred:c})})},g=function(a,b,c,d,g){return g?e(a,b,c,d):f(a,b,c,d)
},h=function(a,b,c,d,e){var f=c[d.toLowerCase()].value(),h=g(a,b,d,e,f);a.invoke(h)};b.exports=h},{}],133:[function(a,b){"use strict";var c=a("./dismissBrowserSelection");b.exports=function(b,d,e,f,g,h){var i={changeTypeOfSelected:null,getSelectedIdEditable:null,typeContainer:null,jsPlumbConnectionClicked:null},j=a("../../util/extendBindable")({}),k=function(){return b.off("mouseup",".textae-editor__body").off("mouseup",".textae-editor__span").off("mouseup",".textae-editor__span_block").off("mouseup",".textae-editor__type-label").off("mouseup",".textae-editor__entity-pane").off("mouseup",".textae-editor__entity")},l=function(a,b,c){var d=a();if(d.length>0){var e=d.map(function(a){return b(a,c)});f.invoke(e)}},m=function(){var a=window.getSelection(),b={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset,range:a.getRangeAt(0)};return c(),b},n=function(){j.trigger("cancel.select")},o=function(){k(),i.typeContainer=null,i.changeTypeOfSelected=null,i.getSelectedIdEditable=null,i.jsPlumbConnectionClicked=null},p=function(){var a=function(a){if(d.selectionModel.entity.some()){var b=d.selectionModel.entity.all()[0],e=$(a.target).attr("title");b===e?d.selectionModel.entity.remove(b):(d.selectionModel.entity.add(e),_.defer(function(){if(f.invoke([f.factory.relationCreateCommand({subj:b,obj:e,type:h.relation.getDefaultType()})]),a.ctrlKey||a.metaKey)d.selectionModel.entity.remove(e);else{if(a.shiftKey)return c(),d.selectionModel.entity.remove(b),d.selectionModel.entity.add(e),!1;d.selectionModel.entity.remove(b),d.selectionModel.entity.remove(e)}}))}else d.selectionModel.clear(),d.selectionModel.entity.add($(a.target).attr("title"));return!1},b=function(a,b){var c=a.getParameter("id");b.ctrlKey||b.metaKey?d.selectionModel.relation.toggle(c):d.selectionModel.relation.single()!==c&&(d.selectionModel.clear(),d.selectionModel.relation.add(c))},e=function(){return!1};return function(){k().on("mouseup",".textae-editor__entity",a).on("mouseup",".textae-editor__relation, .textae-editor__relation__label",e).on("mouseup",".textae-editor__body",n),i.typeContainer=h.relation,i.getSelectedIdEditable=d.selectionModel.relation.all,i.changeTypeOfSelected=_.partial(l,i.getSelectedIdEditable,f.factory.relationChangeTypeCommand),i.jsPlumbConnectionClicked=b}}(),q=function(){var j=a("./SelectEnd")(b,d,f,g,h),o=function(){var a=window.getSelection();a.isCollapsed?n():j.onText({spanConfig:e,selection:m()})},p=function(){var a=function(a){return _.flatten(d.annotationData.span.get(a).getTypes().filter(function(a){return h.entity.isBlock(a.name)}).map(function(a){return a.entities}))},c=function(c,e){d.selectionModel.span[c](e),b.find("#"+e).hasClass("textae-editor__span--block")&&a(e).forEach(d.selectionModel.entity[c])},e=_.partial(c,"add"),f=_.partial(c,"toggle");return function(a){var b=d.selectionModel.span.single(),c=a.target,g=c.id;a.shiftKey&&b?(d.selectionModel.clear(),d.annotationData.span.range(b,g).forEach(function(a){e(a)})):a.ctrlKey||a.metaKey?f(g):(d.selectionModel.clear(),e(g))}}(),q=function(a){var b=window.getSelection();return b.isCollapsed?(p(a),!1):(j.onSpan({spanConfig:e,selection:m()}),void a.stopPropagation())},r=function(a,b,e){var f=function(a){a.each(function(){d.selectionModel.entity.add($(this).attr("title"))})},g=function(a){a.each(function(){d.selectionModel.entity.remove($(this).attr("title"))})};return c(),a?b.hasClass("ui-selected")?g(e):f(e):(d.selectionModel.clear(),f(e)),!1},s=function(a){var b=$(a.target);return r(a.ctrlKey||a.metaKey,b,b.next().children())},t=function(a){c();var b=$(a.target);return a.ctrlKey||a.metaKey?d.selectionModel.entity.toggle(b.attr("title")):(d.selectionModel.clear(),d.selectionModel.entity.add(b.attr("title"))),!1},u=function(a){var b=$(a.target);return r(a.ctrlKey||a.metaKey,b.prev(),b.children())},v=function(a,b){return f.factory.entityChangeTypeCommand(a,b,h.entity.isBlock(b))};return function(){k().on("mouseup",".textae-editor__body",o).on("mouseup",".textae-editor__span",q).on("mouseup",".textae-editor__type-label",s).on("mouseup",".textae-editor__entity-pane",u).on("mouseup",".textae-editor__entity",t),i.typeContainer=h.entity,i.getSelectedIdEditable=d.selectionModel.entity.all,i.changeTypeOfSelected=_.partial(l,i.getSelectedIdEditable,v),i.jsPlumbConnectionClicked=null}}();return _.extend({handler:i,start:{noEdit:o,editRelation:p,editEntity:q}},j)}},{"../../util/extendBindable":151,"./SelectEnd":134,"./dismissBrowserSelection":140}],134:[function(a,b){"use strict";var c=a("./SpanEditor"),d=function(a,b,c){var d=a.validateOnText(c.spanConfig,c.selection);d&&_.compose(b.expand,b.create)(c)},e=function(a,b,c){var d=a.validateOnSpan(c.spanConfig,c.selection);d&&_.compose(b.shrink,b.expand,b.create)(c)};b.exports=function(b,f,g,h,i){var j=a("./selectionParser")(b,f),k=a("./SelectionValidater")(j),l=null,m=null,n=function(){var a=h["boundary-detection"].value(),j=h["replicate-auto"].value(),n=new c(b,f,g,i,a,j);l=_.partial(d,k,n),m=_.partial(e,k,n)};return n(),h["boundary-detection"].bind("change",n),h["replicate-auto"].bind("change",n),{onText:function(a){l&&l(a)},onSpan:function(a){m&&m(a)}}}},{"./SelectionValidater":135,"./SpanEditor":136,"./selectionParser":142}],135:[function(a,b){"use strict";var c=a("./deferAlert");b.exports=function(a){var b=function(b){return a.isInSameParagraph(b)?!0:(c("It is ambiguous for which span you want to adjust the boundary. Select the span, and try again."),!1)},d=function(c,d){return b(d)&&a.isAnchrNodeInSpanOrParagraph(d)&&a.hasCharacters(c,d)},e=function(b,c){return a.isFocusNodeInParagraph(c)&&d(b,c)},f=function(b,c){return a.isFocusNodeInSpan(c)&&d(b,c)};return{validateOnText:e,validateOnSpan:f}}},{"./deferAlert":139}],136:[function(a,b){"use strict";var c=a("../../util/idFactory"),d=function(a,b,d,e){return d!==c.makeSpanId(a,e)?[b.factory.spanMoveCommand(d,e)]:void 0},e=function(a,b){return[a.factory.spanRemoveCommand(b)]},f=a("../../model/isBoundaryCrossingWithOtherSpans"),g=a("../../model/isAlreadySpaned"),h=function(a,b,c,d,e,h,i){var j=100,k=d.create(i.selection,i.spanConfig);if(!f(a.annotationData.span.all(),k)&&!g(a.annotationData.span.all(),k)){var l=[b.factory.spanCreateCommand(c.entity.getDefaultType(),{begin:k.begin,end:k.end})];h&&k.end-k.begin<=j&&l.push(b.factory.spanReplicateCommand(c.entity.getDefaultType(),{begin:k.begin,end:k.end},e?i.spanConfig.isDelimiter:null)),b.invoke(l)}},i=a("./deferAlert"),j=function(a,b,c,e,g,h){var j=e.expand(g,h.selection,h.spanConfig);return f(b.annotationData.span.all(),j)?void i("A span cannot be expanded to make a boundary crossing."):void c.invoke(d(a,c,g,j))},k=function(a,b,c,d){if(b.isAnchorInSelectedSpan(d.selection))c(a.selectionModel.span.single(),d);else{if(!b.isAnchorOneDownUnderForcus(d.selection))return d;c(d.selection.anchorNode.parentNode.id,d)}},l=function(a,b,g,h,j,k){var l=h.shrink(j,k.selection,k.spanConfig);if(f(b.annotationData.span.all(),l))return void i("A span cannot be shrinked to make a boundary crossing.");var m=c.makeSpanId(a,l),n=b.annotationData.span.get(m);g.invoke(l.begin<l.end&&!n?d(a,g,j,l):e(g,j))},m=function(a,b,c,d){b.isFocusInSelectedSpan(d.selection)?c(a.selectionModel.span.single(),d):b.isForcusOneDownUnderAnchor(d.selection)&&c(d.selection.focusNode.parentNode.id,d)},n=function(b,c,d,e,f,g){var i=a("../spanAdjuster/delimiterDetectAdjuster"),n=a("../spanAdjuster/blankSkipAdjuster"),o=f?i:n,p=a("./SpanManipulater")(c,o),q=a("./selectionParser")(b,c),r=_.partial(h,c,d,e,p,f,g),s=_.partial(j,b,c,d,p),t=_.partial(k,c,q,s),u=_.partial(l,b,c,d,p),v=_.partial(m,c,q,u),w=function(a,b,c){return c&&b(c.selection)?a(c):c};return{create:_.partial(w,r,q.isInOneParent),expand:_.partial(w,t,q.isAnchrNodeInSpan),shrink:_.partial(w,v,q.isFocusNodeInSpan)}};b.exports=n},{"../../model/isAlreadySpaned":107,"../../model/isBoundaryCrossingWithOtherSpans":108,"../../util/idFactory":153,"../spanAdjuster/blankSkipAdjuster":128,"../spanAdjuster/delimiterDetectAdjuster":129,"./SpanManipulater":137,"./deferAlert":139,"./selectionParser":142}],137:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./selectPosition"),e=function(){var a=function(a,e){var f=d.toPositions(b.annotationData,a);return{begin:c.backFromBegin(b.annotationData.sourceDoc,f.anchorPosition,e),end:c.forwardFromEnd(b.annotationData.sourceDoc,f.focusPosition-1,e)+1}};return function(c,d){return b.selectionModel.clear(),a(c,d)}}(),f=function(){var a=function(a,d,e,f,g){var h=b.annotationData.span.get(a);return d.compareBoundaryPoints(Range.START_TO_START,e)<0?{begin:c.backFromBegin(b.annotationData.sourceDoc,f,g),end:h.end}:{begin:h.begin,end:c.forwardFromEnd(b.annotationData.sourceDoc,f-1,g)+1}};return function(c,e,f){b.selectionModel.clear();var g=document.createRange();g.selectNode(e.anchorNode);var h=d.getFocusPosition(b.annotationData,e);return a(c,e.range,g,h,f)}}(),g=function(){var a=function(a,d,e,f,g){var h=b.annotationData.span.get(a);return d.compareBoundaryPoints(Range.START_TO_START,e)>0?h.begin===f?{begin:h.begin,end:h.begin}:{begin:h.begin,end:c.backFromEnd(b.annotationData.sourceDoc,f-1,g)+1}:h.end===f?{begin:h.end,end:h.end}:{begin:c.forwardFromBegin(b.annotationData.sourceDoc,f,g),end:h.end}};return function(c,e,f){b.selectionModel.clear();var g=document.createRange();g.selectNode(e.focusNode);var h=d.getFocusPosition(b.annotationData,e);return a(c,e.range,g,h,f)}}();return{create:e,expand:f,shrink:g}}},{"./selectPosition":141}],138:[function(a,b){"use strict";var c=a("./dismissBrowserSelection");b.exports=function(b,d,e,f,g,h){var i=a("./ElementEditor")(b,d,e,f,g,h),j=a("../../component/Pallet")(),k=function(){j.hide(),d.selectionModel.clear(),c()},l=function(a,b){i.handler.jsPlumbConnectionClicked&&!b.processedByTextae&&i.handler.jsPlumbConnectionClicked(a,b),b.processedByTextae=!0};return i.bind("cancel.select",k),j.bind("type.select",function(a){j.hide(),i.handler.changeTypeOfSelected(a)}).bind("default-type.select",function(a){j.hide(),i.handler.typeContainer.setDefaultType(a)}),{editRelation:i.start.editRelation,editEntity:i.start.editEntity,noEdit:i.start.noEdit,showPallet:function(a){j.show(i.handler.typeContainer,a)},setNewType:function(a){i.handler.changeTypeOfSelected(a)},hideDialogs:j.hide,cancelSelect:k,jsPlumbConnectionClicked:l,getSelectedIdEditable:function(){return i.handler.getSelectedIdEditable&&i.handler.getSelectedIdEditable()}}}},{"../../component/Pallet":70,"./ElementEditor":133,"./dismissBrowserSelection":140}],139:[function(a,b){"use strict";b.exports=function(a){_.defer(_.partial(alert,a))}},{}],140:[function(a,b){"use strict";b.exports=function(){var a=window.getSelection();a.collapse(document.body,0)}},{}],141:[function(a,b){"use strict";var c=function(a,b,c){var d,e=$(c).parent(),f=e.attr("id");if(e.hasClass("textae-editor__body__text-box__paragraph"))d=a.get(f).begin;else{if(!e.hasClass("textae-editor__span"))throw new Error("Can not get position of a node : "+c+" "+c.data);d=b.get(f).begin}for(var g=c.parentElement.childNodes,h=0;g[h]!=c;h++)d+="#text"==g[h].nodeName?g[h].nodeValue.length:$("#"+g[h].id).text().length;return d},d=function(a,b){var d=c(a.paragraph,a.span,b.focusNode);return d+=b.focusOffset},e=function(a,b){var d=c(a.paragraph,a.span,b.anchorNode);return d+b.anchorOffset},f=function(a,b){var c=e(a,b),f=d(a,b);if(c>f){var g=c;c=f,f=g}return{anchorPosition:c,focusPosition:f}};b.exports={toPositions:f,getAnchorPosition:e,getFocusPosition:d}},{}],142:[function(a,b){"use strict";var c=a("../../util/domUtil");b.exports=function(b,d){var e=a("./selectPosition"),f=function(a,b){if(!b)return!1;var c=e.toPositions(d.annotationData,b),f=d.annotationData.sourceDoc.substring(c.anchorPosition,c.focusPosition),g=a.removeBlankChractors(f);return g.length>0},g=function(a){return a.anchorNode.parentElement.id===a.focusNode.parentElement.id},h=function(a){return $(a.anchorNode.parentNode)},i=function(a){return $(a.focusNode.parentNode)},j=function(a){return a.hasClass("textae-editor__span")},k=function(a){return a.hasClass("textae-editor__body__text-box__paragraph")},l=function(a){return j(a)||k(a)},m=_.compose(j,h),n=_.compose(j,i),o=_.compose(k,i),p=_.compose(l,h),q=function(){var a=function(b){return k(b)?b:j(b)?a(b.parent()):null},b=function(b,c){var d=$(b[c+"Node"].parentNode),e=a(d);return e&&e.attr("id")};return function(a){var c=b(a,"anchor"),d=b(a,"focus");return c===d}}(),r=function(a){return a.anchorNode.parentNode.parentNode===a.focusNode.parentNode},s=function(a){return a.anchorNode.parentNode===a.focusNode.parentNode.parentNode},t=function(a){var b=d.selectionModel.span.single();if(b){var c=d.annotationData.span.get(b);return c.begin<a&&a<c.end}return!1},u=function(a){return t(e.getAnchorPosition(d.annotationData,a))},v=function(a){return a.focusNode.parentNode.id===d.selectionModel.span.single()},w=function(a){return t(e.getFocusPosition(d.annotationData,a))},x=function(a){var b=d.selectionModel.span.single();return c.selector.span.get(b).parent().attr("id")===a.focusNode.parentNode.id},y=function(a){var b=h(a),c=e.getFocusPosition(d.annotationData,a);if(j(b)&&b.parent()&&j(b.parent())){var f=d.annotationData.span.get(b.parent().attr("id"));if(c<f.begin||f.end<c)return!0}},z=function(a){var b=i(a),c=e.getAnchorPosition(d.annotationData,a);if(j(b)&&b.parent()&&j(b.parent())){var f=d.annotationData.span.get(b.parent().attr("id"));if(c<f.begin||f.end<c)return!0}};return{hasCharacters:f,isInOneParent:g,isAnchrNodeInSpan:m,isAnchrNodeInSpanOrParagraph:p,isFocusNodeInSpan:n,isFocusNodeInParagraph:o,isInSameParagraph:q,isAnchorOneDownUnderForcus:r,isForcusOneDownUnderAnchor:s,isAnchorInSelectedSpan:u,isFocusOnSelectedSpan:v,isFocusInSelectedSpan:w,isSelectedSpanOneDownUnderFocus:x,isLongerThanParentSpan:y,isShorterThanChildSpan:z}}},{"../../util/domUtil":150,"./selectPosition":141}],143:[function(a,b){"use strict";var c=function(){var a={},b=function(b){a={top:b.clientY,left:b.clientX}},c=_.debounce(b,30);return $("html").on("mousemove",c),function(){return a}}(),d=a("./tool/KeybordInputConverter"),e=function(a){$(window).on("resize",_.debounce(function(){a.forEach(function(a){console.log(a.editorId,"redraw"),_.defer(a.api.redraw)})},500))},f=a("./component/HelpDialog")(),g=function(){var a=null;return{setInstance:function(b){a=b},changeButtonState:function(b){a&&a.updateAllButtonEnableState(b)},push:function(b,c){a&&a.updateButtonPushState(b,c)}}},h=function(a,b){return function(d){"H"===d?a():b.getSelected()&&b.getSelected().api.handleKeyInput(d,c())}},i=function(a,b){return function(d){switch(d){case"textae.control.button.help.click":a();break;default:b.getSelected()&&b.getSelected().api.handleButtonClick(d,c())}}};b.exports=function(){var b=new g,c=a("./tool/EditorContainer")(),j=new i(f,c);return $(function(){var a=new h(f,c);(new d).on("input",a),e(c)}),{setControl:function(a){a.on("textae.control.button.click",function(){j.apply(null,_.rest(arguments))}),b.setInstance(a)},pushEditor:function(d){c.push(d);var e=a("./util/extendBindable")({}).bind("textae.editor.select",_.partial(c.select,d)).bind("textae.control.button.push",function(a){b.push(a.buttonName,a.state)}).bind("textae.control.buttons.change",function(a){d===c.getSelected()&&b.changeButtonState(a)});$.extend(d,{editorId:c.getNewId(),eventEmitter:e})},selectFirstEditor:function(){b.changeButtonState(),c.selectFirst()}}}()},{"./component/HelpDialog":69,"./tool/EditorContainer":144,"./tool/KeybordInputConverter":145,"./util/extendBindable":151}],144:[function(a,b){"use strict";var c=function(a,b){var c="textae-editor--active";_.reject(a,function(a){return a===b}).forEach(function(a){a.removeClass(c)}),b.addClass(c)};b.exports=function(){var a=[],b=null,d=function(d){c(a,d),b=d},e={push:function(b){a.push(b)},getNewId:function(){return"editor"+a.length},getSelected:function(){return b},select:d,selectFirst:function(){d(a[0])},forEach:a.forEach.bind(a)};return e}},{}],145:[function(a,b){"use strict";var c=a("events").EventEmitter,d={27:"ESC",46:"DEL",37:"LEFT",39:"RIGHT"},e=function(a){return a>=65&&90>=a?String.fromCharCode(a):d[a]?d[a]:void 0},f=function(a){return a.keyCode};b.exports=function(){var a=new c,b=function(b){var c=e(f(b));a.emit("input",c)},d=b;return $(document).on("keyup",function(a){d(a)}),$("body").on("dialogopen",".ui-dialog",function(){d=function(){}}).on("dialogclose",".ui-dialog",function(){d=b}),a}},{events:37}],146:[function(a,b){"use strict";var c=function(a,b){a=a.add(".ui-dialog, .ui-widget-overlay"),a[b+"Class"]("textae-editor--wait")};b.exports=function(a){var b=_.partial(c,a,"add"),d=_.partial(c,a,"remove");return{startWait:b,endWait:d}}},{}],147:[function(a,b){"use strict";var c=a("events").EventEmitter;b.exports=function(a){var b=a,d=new c,e=function(){return b},f=function(a){b!==a&&(b=a,d.emit("change",a))};return _.extend(d,{get:e,set:f})}},{events:37}],148:[function(a,b){"use strict";var c=function(a){return!a||""===a},d=function(a,b,d){c(a)||$.ajax({type:"GET",url:a,cache:!1}).done(function(a){void 0!==b&&b(a)}).fail(function(){void 0!==d&&d()})},e=function(a,b,d,e,f){c(a)||(console.log("POST data",b),$.ajax({type:"post",url:a,contentType:"application/json",data:b,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(d).fail(e).always(f))};b.exports=function(){return{getAsync:d,post:e}}()},{}],149:[function(a,b){"use strict";b.exports=function(a){return a.charAt(0).toUpperCase()+a.slice(1)}},{}],150:[function(a,b){"use strict";var c=a("../util/idFactory");b.exports={selector:{span:{get:function(a){return $("#"+a)}},entity:{get:function(a,b){return $("#"+c.makeEntityDomId(b,a))}},grid:{get:function(a){return $("#G"+a)}}}}},{"../util/idFactory":153}],151:[function(a,b){"use strict";var c=function(){var a={};return{bind:function(b,c){if(!_.isFunction(c))throw new Error("Only a function is bindable!");return a[b]=a[b]||[],a[b].push(c),this},unbind:function(b,c){return a[b]?(a[b]=_.reject(a[b],function(a){return a===c}),this):this},trigger:function(b,c){return a[b]&&a[b].forEach(function(a){a(c)}),c}}};b.exports=function(a){return _.extend({},a,c())}},{}],152:[function(a,b){"use strict";b.exports=function(a){var b=a?String(a).replace(/^\?(.*)/,"$1"):"",c=b.length>0?b.split("&"):[];return c.map(function(a){var b=a.split("=");return{key:b[0],val:b[1]}}).reduce(function(a,b){return a[b.key]=b.val?b.val:!0,a},{})}},{}],153:[function(a,b){"use strict";var c=[],d=function(a,b){return a+"__"+b},e=function(a,b,c){return d(a,b)+c},f="_";b.exports={makeSpanId:function(a,b){var c=d(a.editorId,"S");return c+b.begin+f+b.end},makeTypeId:function(a,b){return-1===c.indexOf(b)&&c.push(b),a+"-"+c.indexOf(b)},makeEntityDomId:function(a,b){return e(a.editorId,"E",b)},makeParagraphId:function(a,b){return e(a.editorId,"P",b)}}},{}],154:[function(a,b){"use strict";b.exports=function(a,b){b?a.removeAttr("disabled"):a.attr("disabled","disabled")}},{}],155:[function(a,b){"use strict";var c=function(a,b,c,d){var e={};return e[a]=d,b.find(c).prop(e).end()};b.exports={enabled:a("./jQueryEnabled"),Div:function(a){return $("<div>").addClass(a)},Label:function(a,b){return $("<label>").addClass(a).text(b)},Button:function(a,b){return $('<input type="button" disabled="disabled" />').addClass(b).val(a)},Checkbox:function(a){return $('<input type="checkbox"/>').addClass(a)},Number:function(a){return $('<input type="number"/>').addClass(a)},toLink:function(a){return'<a href="'+a+'">'+a+"</a>"},getValueFromText:function(a,b){return a.find('[type="text"].'+b).val()},setChecked:_.partial(c,"checked"),setValue:_.partial(c,"value")}},{"./jQueryEnabled":154}],156:[function(a,b){"use strict";b.exports=function(a,b){return a[b.name]=b,a}},{}],157:[function(a,b){"use strict";b.exports={isUri:function(a){return String(a).indexOf("http")>-1},getUrlMatches:function(a){var b=/\(?(?:(http|https|ftp):\/\/)?(?:((?:[^\W\s]|\.|-|[:]{1})+)@{1})?((?:www.)?(?:[^\W\s]|\.|-)+[\.][^\W\s]{2,4}|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::(\d*))?([\/]?[^\s\?]*[\/]{1})*(?:\/?([^\s\n\?\[\]\{\}\#]*(?:(?=\.)){1}|[^\s\n\?\[\]\{\}\.\#]*)?([\.]{1}[^\s\?\#]*)?)?(?:\?{1}([^\s\n\#\[\]]*))?([\#][^\s\n]*)?\)?/gi;return b.exec(a)}}},{}],158:[function(a,b){"use strict";var c=a("../util/extendBindable"),d=function(){var a={},b=function(b,c){a[b]=c},d=c({}),e=function(){d.trigger("change",a)};return _.extend(d,{set:b,propagate:e})},e=function(a,b,c){var d=a.selectionModel,e=function(a){return _.isFunction(a)?a():d[a].some()},f=function(){for(var a=0;a<arguments.length;a++)if(!e(arguments[a]))return!1;return!0},g=function(){for(var a=0;a<arguments.length;a++)if(e(arguments[a]))return!0;return!1},h=function(){return c.clipBoard.length>0},i=_.partial(g,"span","entity"),j=_.partial(g,"entity","relation"),k={replicate:function(){return!!d.span.single()},entity:d.span.some,"delete":d.some,copy:i,paste:_.partial(f,h,"span"),pallet:j,"change-label":j,negation:j,speculation:j};return function(a){a.forEach(function(a){b.set(a,k[a]())})}},f=function(a,b){var c=function(a,b){return b.length>0&&_.every(b,function(b){return _.contains(b,a)})},d=function(a,d){b[a.toLowerCase()].value(c(a,d))};return function(b){var c=b.all().map(function(b){return a.annotationData.getModificationOf(b).map(function(a){return a.pred})});d("Negation",c),d("Speculation",c)}},g=function(a,b,c,d,e){var f=["delete"],g=f.concat(["replicate","entity","copy","paste"]),h=f.concat(["pallet","change-label","negation","speculation"]),i=h.concat(["copy"]),j=_.compose(b.propagate,c.propagate),k=_.partial(_.compose,j);return{propagate:j,enabled:k(c.set),updateBySpan:k(_.partial(d,g)),updateByEntity:_.compose(j,_.partial(e,a.selectionModel.entity),_.partial(d,i)),updateByRelation:_.compose(j,_.partial(e,a.selectionModel.relation),_.partial(d,h))}};b.exports=function(b,c,h){var i=a("./ModeAccordingToButton")(),j=new d,k=new e(c,j,h),l=new f(c,i),m=new g(c,i,j,k,l);return i.bind("change",function(a){b.eventEmitter.trigger("textae.control.button.push",a)}),j.bind("change",function(a){b.eventEmitter.trigger("textae.control.buttons.change",a)}),{modeAccordingToButton:i,buttonStateHelper:m}}},{"../util/extendBindable":151,"./ModeAccordingToButton":161}],159:[function(a,b){"use strict";var c=function(){var a={},b=function(b,c){return a[b]=c,c},c=function(b){return a[b]},d=function(b){delete a[b]},e=function(){a={}};return{set:b,get:c,remove:d,clear:e,keys:function(){return Object.keys(a)}}},d=function(){var a=[],b=function(b){a.push(b)},d=function(a,b,c){return a.get(c)?a.get(c):a.set(c,b(c))},e=function(a){var e=new c;return b(e),_.partial(d,e,a)},f=function(){a.forEach(function(a){a.clear()})};return{create:e,clear:f}}(),e=a("../util/domUtil"),f=function(a,b){var f=_.extend(new c,{isGridPrepared:function(a){var c=b.get(a).span;return f.get(c)}}),g=function(){return a.find(".textae-editor__body__text-box").offset()},h=d.create(g),i=function(a){var b=e.selector.span.get(a);if(0===b.length)throw new Error("span is not renderd : "+a);var c=b.offset();return{top:c.top-h().top,left:c.left-h().left,width:b.outerWidth(),height:b.outerHeight(),center:b.get(0).offsetLeft+b.outerWidth()/2}},j=function(c){var d=e.selector.entity.get(c,a);if(0===d.length)throw new Error("entity is not rendered : "+c);var g=b.get(c).span,h=f.get(g),i=d.get(0);return{top:h.top+i.offsetTop,center:h.left+i.offsetLeft+d.outerWidth()/2}},k=new c,l=function(a){return k.get(a)},m=d.create(i),n=d.create(j);return{reset:d.clear,getSpan:m,getEntity:n,gridPositionCache:f,getGrid:f.get,setGrid:f.set,toConnect:l,connectCache:k}};b.exports=function(a,b){return a.postionCache=a.postionCache||f(a,b),a.postionCache}},{"../util/domUtil":150}],160:[function(a,b){"use strict";var c=function(a){return a&&a.hasClass("hidden")?a:void 0},d=function(a){a&&a.removeClass("hidden")},e=function(a,b){return a&&a.top===b.top&&a.left===b.left?null:b},f=function(a,b){return b?a(b.id):void 0},g=a("bluebird"),h=a("./getGridPosition"),i=a("../util/domUtil");b.exports=function(b,j,k){var l=a("./DomPositionCache")(b,j.entity),m=i.selector.grid.get,n=_.partial(f,m),o=function(a,b){return b?(l.setGrid(a.id,b),a):void 0},p=function(a,b){return b?(n(a).css(b),b):void 0},q=function(a,b){var f=_.partial(h,l.getSpan,m,k,a),g=_.compose(_.partial(o,b),_.partial(p,b),_.partial(e,l.getGrid(b.id)),_.partial(f)),i=_.compose(d,c,n);j.span.get(b.id)&&_.compose(i,g)(b)},r=function(a,b){return new g(function(c,d){_.defer(function(){try{q(a,b),c()}catch(e){console.error(e,e.stack),d()}})})},s=function(a){return j.span.all().filter(function(a){return a.getTypes().length>0}).map(function(a){return l.getSpan(a.id),a}).map(_.partial(r,a))},t=function(a){return l.reset(),g.all(s(a))};return{arrangePosition:t}}},{"../util/domUtil":150,"./DomPositionCache":159,"./getGridPosition":183,bluebird:3}],161:[function(a,b){"use strict";var c=a("../util/reduce2hash"),d=a("../util/extendBindable"),e=function(a){var b=d({}),c=!1,e=function(a){return void 0===a?c:(c=a,void g())},f=function(){c=!c,g()},g=function(){b.trigger("change",{buttonName:a,state:c})};return _.extend({name:a,value:e,toggle:f,propagate:g},b)},f=["boundary-detection","negation","replicate-auto","relation-edit-mode","speculation"],g=function(a,b){b.map(function(a){return{buttonName:a.name,state:a.value()}}).forEach(function(b){a.trigger("change",b)})};b.exports=function(){var a=d({}),b=f.map(e),h=_.partial(g,a,b),i=b.reduce(c,{});return i["boundary-detection"].value(!0),b.forEach(function(b){b.bind("change",function(b){a.trigger("change",b)})}),_.extend(i,a,{propagate:h})}},{"../util/extendBindable":151,"../util/reduce2hash":156}],162:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("./ModificationRenderer")),e=c(a("./getDisplayName")),f=function(a){var b=a.outerWidth(),c=a.find(".textae-editor__entity").toArray().map(function(a){return a.offsetWidth}).reduce(function(a,b){return a+b},0);a.css({left:c>b?(b-c)/2:0})},g=a("../../util/uri"),h=a("../../util/idFactory"),i=a("../../util/domUtil");b.exports=function(b,c,j,k){var l=new d(c.annotationData),m=function(a,b){return $("#"+h.makeTypeId(a,b))},n=function(a){return 0===c.annotationData.span.get(a).getTypes().length},o=function(){var a=function(a,b){return 0===c.annotationData.span.get(a.span).getTypes().filter(function(a){return a.name===b}).length};return function(c){var d=i.selector.entity.get(c.id,b).remove().attr("type");a(c,d)?m(c.span,d).remove():f(m(c.span,d).find(".textae-editor__entity-pane"))}}(),p=function(){var a=function(){var a=function(a){return g.isUri(a)?a:j.entity.getUri(a)?j.entity.getUri(a):void 0},b=function(b,c){var d=h.makeTypeId(b,c),f=$("<div>").attr("id","P-"+d).addClass("textae-editor__entity-pane"),g=$("<div>").addClass("textae-editor__type-label").css({"background-color":j.entity.getColor(c)}),i=a(c);return i?g.append($('<a target="_blank"/>').attr("href",i).text(e(c))):g.text(e(c)),$("<div>").attr("id",d).addClass("textae-editor__type").append(g).append(f)},c=function(a){var b=i.selector.grid.get(a);return 0===b.length?k.render(a):b};return function(a,d){var e=m(a,d);return 0===e.length&&(e=b(a,d),c(a).append(e)),e}}(),c=function(a){var c=$("<div>").attr("id",h.makeEntityDomId(b,a.id)).attr("title",a.id).attr("type",a.type).addClass("textae-editor__entity").css({"border-color":j.entity.getColor(a.type)});return c.addClass(l.getClasses(a.id)),c};return function(b){b.type=String(b.type);var d=a(b.span,b.type).find(".textae-editor__entity-pane").append(c(b));f(d)}}(),q=a("../../util/extendBindable")({}),r=function(a){return j.entity.isBlock(a.type)||p(a),q.trigger("render",a),a},s=a("../Selector")(b,c),t=function(a){return o(a),r(a),c.selectionModel.entity.has(a.id)&&s.entity.select(a.id),a},u=function(a){var c=i.selector.entity.get(a.id,b);l.update(c,a.id)},v=function(a){return n(a.span)?k.remove(a.span):o(a),a};return _.extend(q,{render:r,change:t,changeModification:u,remove:v,getTypeDom:function(a){return m(a.span,a.type)}})}},{"../../util/domUtil":150,"../../util/extendBindable":151,"../../util/idFactory":153,"../../util/uri":157,"../Selector":180,"./ModificationRenderer":165,"./getDisplayName":172}],163:[function(a,b){"use strict";var c=function(a,b,c){var d=a.getSpan(c),e=$("<div>").attr("id","G"+c).addClass("textae-editor__grid").addClass("hidden").css({width:d.width});return b.append(e),e},d=a("../../util/domUtil");b.exports=function(a,b){var e=function(a){g.render=_.partial(c,b,a)},f=function(a){d.selector.grid.get(a).remove(),b.gridPositionCache.remove(a)},g={init:e,render:null,remove:f};return g}},{"../../util/domUtil":150}],164:[function(a,b){"use strict";function c(a,b,c){var d=g(a);b.init(d),c.init(d)}function d(a){return a.id}var e=function(a){return a&&(a["default"]||a)},f=e(a("./renderSourceDocument")),g=e(a("./getAnnotationBox")),h=e(a("./RenderAll")),i=e(a("./renderModification")),j=a("events").EventEmitter;b.exports=function(a,b,e,g,k,l){var m=new j,n=_.debounce(function(){m.emit("change")},100),o=_.partial(_.compose,n);return g.bind("render",function(a){return m.emit("entity.render",a),a}),function(j,p){var q=new h(j,a,b,k),r=function(a){return p.annotationData.span.get(a.span)},s=_.partial(_.compose,n,b.change,r),t=function(a){i(p.annotationData,"relation",a,k,l),i(p.annotationData,"entity",a,g,l)};return c(j,e,k),p.annotationData.on("change-text",function(a){f(j,a.sourceDoc,a.paragraphs),m.emit("text.change")}).on("all.change",o(p.selectionModel.clear,q)).on("span.add",o(b.render)).on("span.remove",o(b.remove)).on("span.remove",_.compose(p.selectionModel.span.remove,d)).on("entity.add",function(c){b.change(r(c),a.reset),g.render(c),n()}).on("entity.change",s(g.change)).on("entity.remove",s(g.remove)).on("entity.remove",_.compose(p.selectionModel.entity.remove,d)).on("relation.add",o(k.render)).on("relation.change",k.change).on("relation.remove",k.remove).on("relation.remove",_.compose(p.selectionModel.relation.remove,d)).on("modification.add",t).on("modification.remove",t),m}}},{"./RenderAll":167,"./getAnnotationBox":171,"./renderModification":178,"./renderSourceDocument":179,events:37}],165:[function(a,b){"use strict";function c(a,b){return a.getModificationOf(b).map(function(a){return"textae-editor__"+a.pred.toLowerCase()}).join(" ")}function d(a,b,d){b.removeClass(e),b.addClass(c(a,d))}var e="textae-editor__negation textae-editor__speculation";b.exports=function(a){return{getClasses:_.partial(c,a),update:_.partial(d,a)}}},{}],166:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("./ModificationRenderer")),e=3,f={cssClass:"textae-editor__relation__label",id:"label"},g={xrate:.6,yrate:.05,c_offset:20},h=function(a){var b=jsPlumb.getInstance({ConnectionsDetachable:!1,Endpoint:["Dot",{radius:1}]});return b.setRenderMode(b.SVG),b.Defaults.Container=a,b},i=function(a){var b=a.getOverlay(f.id);if(!b)throw"no label overlay";return b},j=a("./jsPlumbArrowOverlayUtil"),k=a("../../util/domUtil");b.exports=function(b,c,l){var m,n=new d(c.annotationData),o=a("../DomPositionCache")(b,c.annotationData.entity),p=function(a){m=h(a)},q=function(){var a=function(a){var b=a.slice(1),c=parseInt(b.substr(0,2),16),d=parseInt(b.substr(2,2),16),e=parseInt(b.substr(4,2),16);return"rgba("+c+", "+d+", "+e+", 1)"};return function(b){var d=c.annotationData.relation.get(b).type,e=l.relation.getColor(d);return{lineWidth:1,strokeStyle:a(e,1)}}}(),r=function(a){var b=a.relationId;return o.connectCache.set(b,a),a},s=function(a){return{sourceId:c.annotationData.relation.get(a).subj,targetId:c.annotationData.relation.get(a).obj}},t=function(a){if(c.annotationData.relation.get(a)){var b=s(a);return o.gridPositionCache.isGridPrepared(b.sourceId)&&o.gridPositionCache.isGridPrepared(b.targetId)}},u=function(a){return t(a.relationId)?a:void 0},v=function(a){var b=s(a),c=o.getEntity(b.sourceId),d=o.getEntity(b.targetId),e=c.center,f=d.center,h=c.top,i=d.top,j=Math.abs(e-f),k=Math.abs(h-i),l=j*g.xrate+k*g.yrate+g.c_offset;return l/=2.4},w=function(){var a=function(a){return delete a.render,a},c=function(a){return m.connect({source:k.selector.entity.get(a.subj,b),target:k.selector.entity.get(a.obj,b),anchors:["TopCenter","TopCenter"],connector:["Bezier",{curviness:v(a.id)}],paintStyle:new q(a.id),parameters:{id:a.id},cssClass:"textae-editor__relation",overlays:[["Arrow",j.NORMAL_ARROW],["Label",_.extend({},f,{label:"["+a.id+"] "+a.type,cssClass:f.cssClass+" "+n.getClasses(a.id)})]]})
},d=function(a){return _.extend(c(a),{relationId:a.id})},g=function(){var a=function(){var a=function(a){return new i(a).addClass("hover"),a},b=function(a){return new i(a).removeClass("hover"),a},c=function(a){return new i(a).addClass("ui-selected"),a},d=function(a){return new i(a).removeClass("ui-selected"),a},f=function(a){return a.addClass("hover"),a},g=function(a){return a.removeClass("hover"),a},h=function(a){return a.addClass("ui-selected"),a},k=function(a){return a.removeClass("ui-selected"),a},l=function(a,b){return a.connector.canvas.classList.contains(b)},m=function(a,b,c){return function(){b(a)||c(a)}},n=function(a,b){return b.setPaintStyle(_.extend(a(),{lineWidth:e})),b},o=function(a,b){return b.setPaintStyle(a()),b};return function(e,i){var p=_.partial(q,e),r=_.partial(n,p),s=_.partial(o,p),t=_.partial(m,i,function(a){return l(a,"ui-selected")}),u=_.partial(m,i,function(a){return a.dead}),v=_.compose(f,a,r,j.showBigArrow),w=_.compose(g,b,s,j.hideBigArrow),x=_.compose(h,c,g,b,r,j.showBigArrow),y=_.compose(k,d,s,j.hideBigArrow);return{pointup:t(v),pointdown:t(w),select:u(x),deselect:u(y)}}}();return function(b){var c=b.relationId;return _.extend(b,new a(c,b))}}(),h=function(){var a=function(a,b,c){a.bind("mouseenter",b).bind("mouseexit",c)},b=function(a){a.pointup()},c=function(a){a.pointdown()},d=function(a){return a.component},e=function(d){return a(d,b,c),d},f=function(e){return a(new i(e),_.compose(b,d),_.compose(c,d)),e};return _.compose(f,e)}(),l=function(){var a=function(){var a=function(a){this.bind("click",a),this.getOverlay(f.id).bind("click",function(b,c){a(b.component,c)})};return _.extend({bindClickAction:a})};return function(b){return _.extend(b,new a(b))}}(),o=function(a){return b.trigger("textae.editor.jsPlumbConnection.add",a),a};return _.compose(r,o,l,h,g,d,a)}(),x=a("bluebird"),y=function(){var a=function(a){return _.extend(a,{relationId:a.id})},b=function(a){u(a)&&w(a)},c=function(a){var c=function(){return new x(function(c,d){_.defer(function(){try{b(a),c(a)}catch(e){d(e)}})})};return _.extend(a,{render:c})};return _.compose(r,c,a)}(),z=function(a){var b=o.toConnect(a);if(!b)throw"no connect";return b},A=function(a){var b=new z(a.id),d=new q(a.id);b instanceof jsPlumb.Connection&&(c.selectionModel.relation.has(a.id)&&(d.lineWidth=e),b.setPaintStyle(d),new i(b).setLabel("["+a.id+"] "+a.type))},B=function(a){var b=new z(a.id);b instanceof jsPlumb.Connection&&n.update(new i(b),a.id)},C=function(a){var b=new z(a.id);m.detach(b),o.connectCache.remove(a.id),b.dead=!0},D=function(){c.annotationData.relation.all().map(function(a){return new z(a.id)}).filter(function(a){return a.setConnector&&a.connector.getCurviness()!==v(a.relationId)}).forEach(function(a){a.setConnector(["Bezier",{curviness:v(a.relationId)}]),j.resetArrows(a)})},E=function(){return x.all(c.annotationData.relation.all().filter(function(a){return a.render}).map(function(a){return a.render()}))},F=function(){c.selectionModel.relation.all().map(function(a){return new z(a)}).filter(function(a){return a instanceof jsPlumb.Connection}).forEach(function(a){a.select()})},G=function(){return new x(function(a,b){_.defer(function(){try{D(),m.repaintEverything(),F(),a()}catch(c){throw b(c),c}})})};return{init:p,reset:function(){m.reset(),o.connectCache.clear()},render:y,change:A,changeModification:B,remove:C,renderLazyRelationAll:E,arrangePositionAll:G}}},{"../../util/domUtil":150,"../DomPositionCache":159,"./ModificationRenderer":165,"./jsPlumbArrowOverlayUtil":177,bluebird:3}],167:[function(a,b){"use strict";function c(a,b){a.span.topLevel().forEach(function(a){b.render(a)})}function d(a,b){b.reset(),a.relation.all().forEach(b.render)}var e=function(a){return a&&(a["default"]||a)},f=e(a("./getAnnotationBox"));b.exports=function(a,b,e,g){return function(h){f(a).empty(),b.gridPositionCache.clear(),c(h,e),d(h,g)}}},{"./getAnnotationBox":171}],168:[function(a,b){"use strict";var c=a("./createSpanRange"),d=a("./getFirstTextNode"),e=function(a){var b=document.createElement("span");return b.setAttribute("id",a.id),b.setAttribute("title",a.id),b.setAttribute("class","textae-editor__span"),b},f=a("../../util/domUtil"),g=function(){var a=_.compose(d,f.selector.span.get),b=_.compose(d,function(a){return $("#"+a)}),g=function(d){var e=d.getBigBrother();return e?c(document.getElementById(e.id).nextSibling,e.end,d):d.parent?c(a(d.parent.id),d.parent.begin,d):c(b(d.paragraph.id),d.paragraph.begin,d)},h=function(a,b){return g(a).surroundContents(b),a},i=function(a){return h(a,e(a))};return i};b.exports=g},{"../../util/domUtil":150,"./createSpanRange":170,"./getFirstTextNode":175}],169:[function(a,b){"use strict";var c=function(a){return null!==document.getElementById(a.id)},d=function(a){return!a},e=function(a,b){return a.getTypes().map(function(a){return a.name}).filter(b).length>0},f=a("../../util/domUtil");b.exports=function(b,g,h,i,j){var k=a("./RenderSingleSpan")(b),l=function(a,b){var c=f.selector.span.get(a.id);return e(a,h.entity.isBlock)?c.addClass("textae-editor__span--block"):c.removeClass("textae-editor__span--block"),e(a,_.compose(d,h.entity.isBlock))?c.hasClass("textae-editor__span--wrap")&&(c.removeClass("textae-editor__span--wrap"),b&&b()):c.addClass("textae-editor__span--wrap"),a},m=function(a){a.entities.forEach(_.compose(i.render,g.annotationData.entity.get))},n=function(a){return a.getTypes().forEach(m),a},o=function(a){for(var b=document.getElementById(a.id),c=b.parentNode;b.firstChild;)c.insertBefore(b.firstChild,b);$(b).remove(),c.normalize(),j.remove(a.id)},p=function(a){var b=function(a){a.children.forEach(function(a){b(a)}),o(a)};return a.children.filter(c).forEach(b),a},q=function(a){return a.children.filter(_.compose(d,c)).forEach(r),a},r=_.compose(q,n,l,k,p);return{render:r,remove:o,change:l}}},{"../../util/domUtil":150,"./RenderSingleSpan":168}],170:[function(a,b){"use strict";var c=function(a,b){var c=a.begin-b,d=a.end-b;return{start:c,end:d}},d=function(a,b,c){return b>=0&&c<=a.length},e=function(a,b,c){var d=document.createRange();return d.setStart(a,b),d.setEnd(a,c),d},f=function(a,b,f){var g=c(f,b);if(!d(a,g.start,g.end))throw new Error("oh my god! I cannot render this span. "+f.toStringOnlyThis()+", textNode "+a.textContent);return e(a,g.start,g.end)};b.exports=f},{}],171:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("./getElement")),e=c(a("./getEditorBody"));b.exports=_.compose(_.partial(d,"div","textae-editor__body__annotation-box"),e)},{"./getEditorBody":173,"./getElement":174}],172:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("../../util/uri"));b.exports=function(a){if(d.isUri(a)){var b=d.getUrlMatches(a);if(b)return b[9]?b[9].slice(1):b[6]?b[6]+(b[7]||""):b[5]&&b[5].length>1?b[5].split("/").filter(function(a){return""!==a}).pop():b[3]}return a}},{"../../util/uri":157}],173:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("./getElement"));b.exports=_.partial(d,"div","textae-editor__body")},{"./getElement":174}],174:[function(a,b){"use strict";b.exports=function(a,b,c){var d=c.find("."+b);return 0===d.length&&(d=$("<"+a+">").addClass(b),c.append(d)),d}},{}],175:[function(a,b){"use strict";var c=function(){return 3===this.nodeType},d=function(a){return a.contents().filter(c).get(0)};b.exports=d},{}],176:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("./GridRenderer")),e=c(a("./EntityRenderer")),f=c(a("./SpanRenderer")),g=c(a("./RelationRenderer")),h=c(a("../DomPositionCache")),i=c(a("./Initiator"));b.exports=function(a,b,c,j){var k=new h(a,b.annotationData.entity),l=new d(a,k),m=new e(a,b,j,l),n=new f(a,b,j,m,l),o=new g(a,b,j),p={init:new i(k,n,l,m,o,c),arrangeRelationPositionAll:o.arrangePositionAll,renderLazyRelationAll:o.renderLazyRelationAll,setEntityCss:function(a,b){m.getTypeDom(a).css(b)}};return p}},{"../DomPositionCache":159,"./EntityRenderer":162,"./GridRenderer":163,"./Initiator":164,"./RelationRenderer":166,"./SpanRenderer":169}],177:[function(a,b){"use strict";var c={width:7,length:9,location:1,id:"normal-arrow"},d={width:14,length:18,location:1,id:"hover-arrow"},e=function(a,b){return a===c.id?b.addOverlay(["Arrow",c]):a===d.id&&b.addOverlay(["Arrow",d]),b},f=function(a,b){return b.forEach(function(b){e(b,a)}),b},g=function(a){return a.getOverlays().filter(function(a){return"Arrow"===a.type}).map(function(a){return a.id})},h=function(a){return a.getOverlay(c.id)},i=function(a){return a.getOverlay(d.id)},j=function(a,b){return b.removeOverlay(a),b},k=function(a,b){return b.forEach(function(b){j(b,a)}),b},l=function(a){_.compose(_.partial(f,a),_.partial(k,a),g)(a)},m=_.partial(e,c.id),n=_.partial(e,d.id),o=_.partial(j,c.id),p=_.partial(j,d.id),q=_.compose(n,o),r=_.compose(m,p);b.exports={NORMAL_ARROW:c,resetArrows:l,showBigArrow:function(a){return i(a)?a:q(a)},hideBigArrow:function(a){return h(a)?a:r(a)}}},{}],178:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("../../util/capitalize"));b.exports=function(a,b,c,e,f){var g=a[b].get(c.obj);g&&(e.changeModification(g),f["updateBy"+d(b)]())}},{"../../util/capitalize":149}],179:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("./getElement")),e=c(a("./getEditorBody")),f=_.compose(_.partial(d,"div","textae-editor__body__text-box"),e),g=function(a,b){return a.split("\n").map(function(a,c){return'<p class="textae-editor__body__text-box__paragraph-margin"><span class="textae-editor__body__text-box__paragraph" id="'+b[c].id+'" >'+a+"</span></p>"}).join("\n")},h=function(a,b,c){f(a)[0].innerHTML=g(b,c)};b.exports=h},{"./getEditorBody":173,"./getElement":174}],180:[function(a,b){"use strict";var c=a("./selectionClass"),d=a("../util/domUtil");b.exports=function(b,e){var f=a("./DomPositionCache")(b,e.annotationData.entity),g=function(a,e,f){var g=d.selector[a].get(f,b);c[e+"Class"](g)},h=_.partial(g,"span","add"),i=_.partial(g,"span","remove"),j=_.partial(g,"entity","add"),k=_.partial(g,"entity","remove"),l=function(a){var b=function(a){a&&a.select&&a.select()},c=_.compose(b,f.toConnect);c(a)},m=function(a){var b=function(a){a&&a.deselect&&a.deselect()},c=_.compose(b,f.toConnect);c(a)},n=function(a){var e=d.selector.entity.get(a,b),f=e.parent(),g=f.prev();f.children().length===f.find(".ui-selected").length?c.addClass(g):c.removeClass(g)};return{span:{select:h,deselect:i},entity:{select:j,deselect:k},relation:{select:l,deselect:m},entityLabel:{update:n}}}},{"../util/domUtil":150,"./DomPositionCache":159,"./selectionClass":185}],181:[function(a,b){"use strict";var c=a("../util/reduce2hash"),d=a("../util/uri"),e="something",f=function(a,b){var c={},f=e;return{setDefinedTypes:function(a){c=a},getDeinedTypes:function(){return _.extend({},c)},setDefaultType:function(a){f=a},getDefaultType:function(){return f||this.getSortedNames()[0]},getColor:function(a){return c[a]&&c[a].color||b},getUri:function(a){return c[a]&&c[a].uri||d.getUrlMatches(a)?a:void 0},getSortedNames:function(){if(a){var b=a().concat(Object.keys(c)).reduce(function(a,b){return a[b]=a[b]?a[b]+1:1,a},{}),d=Object.keys(b);return d.sort(function(a,c){var d=b[c]-b[a];return 0!==d?d:a>c?1:a>c?-1:0}),d}return[]}}},g=function(a,b){void 0!==b&&(a.setDefinedTypes(b.reduce(c,{})),a.setDefaultType(b.filter(function(a){return a["default"]===!0}).map(function(a){return a.name}).shift()||e))};b.exports=function(a){var b=_.extend(new f(a.annotationData.entity.types,"#77DDDD"),{isBlock:function(a){var c=b.getDeinedTypes()[a];return c&&c.type&&"block"===c.type}}),c=new f(a.annotationData.relation.types,"#555555");return{entity:b,setDefinedEntityTypes:_.partial(g,b),relation:c,setDefinedRelationTypes:_.partial(g,c)}}},{"../util/reduce2hash":156,"../util/uri":157}],182:[function(a,b){"use strict";var c=function(a){return a&&(a["default"]||a)},d=c(a("./lineHeight")),e=function(a){return _.partial(_.delay,a,150)},f=function(a){return{height:18*a+18+"px","padding-top":18*a+"px"}};b.exports=function(b,c,g,h,i){var j=a("./Selector")(b,c),k=a("./Renderer")(b,c,g.buttonStateHelper,i),l=a("./GridLayout")(b,c.annotationData,i),m=a("../util/extendBindable")({}),n=function(a){m.trigger("render.start",b),_.defer(function(){l.arrangePosition(a).then(k.renderLazyRelationAll).then(k.arrangeRelationPositionAll).then(function(){m.trigger("render.end",b)})["catch"](function(a){console.error(a,a.stack)})})},o=function(){var d=a("./DomPositionCache")(b,c.annotationData.entity),e=function(a,b){c.annotationData.entity.assosicatedRelations(b).map(d.toConnect).filter(function(a){return a.pointup&&a.pointdown}).forEach(a)};return{on:_.partial(e,function(a){a.pointup()}),off:_.partial(e,function(a){a.pointdown()})}}(),p=function(){c.selectionModel.on("span.select",j.span.select).on("span.deselect",j.span.deselect).on("span.change",g.buttonStateHelper.updateBySpan).on("entity.select",j.entity.select).on("entity.deselect",j.entity.deselect).on("relation.select",e(j.relation.select)).on("relation.deselect",e(j.relation.deselect)).on("relation.change",g.buttonStateHelper.updateByRelation)},q=n;return _.extend(m,{init:function(){k.init(b,c).on("change",function(){q(h())}).on("entity.render",function(a){k.setEntityCss(a,new f(h()))}).on("text.change",function(){d.reduceBottomSpace(b)}),p()},hoverRelation:o,updateDisplay:q,setTypeGap:function(a){b.find(".textae-editor__type").css(new f(a)),n(a)}})}},{"../util/extendBindable":151,"./DomPositionCache":159,"./GridLayout":160,"./Renderer":176,"./Selector":180,"./lineHeight":184}],183:[function(a,b){"use strict";var c=function(a,b,c){var d=a(c.id);return{top:d.top-b(c.id).outerHeight(),left:d.left}},d=function(a,b,c){var e=0===a.children.length?0:Math.max.apply(null,a.children.map(function(a){return d(a,b,c)})),f=a.getTypes().filter(function(a){return!b.entity.isBlock(a.name)}).length*(18*c+18);return f+e},e=function(a,b,c,e){var f=a(e.id),g=d(e,b,c);return{top:f.top-g,left:f.left}};b.exports=function(a,b,d,f,g){return 0===g.children.length?c(a,b,g):e(a,d,f,g)}},{}],184:[function(a,b){"use strict";var c=function(a){return Math.floor(parseInt(a.find(".textae-editor__body__text-box").css("line-height"))/16)},d=function(a){var b=a.find(".textae-editor__body__text-box");b.css({height:"auto"}).css({height:b.height()+20})},e=function(a,b){var c=a.find(".textae-editor__body__text-box");c.css({"line-height":b+"px","padding-top":b/2+"px"}),d(a)},f=function(a,b,c){var d=23,f=60,g=64,h=18*c+18,i=_.max(b.annotationData.span.all().map(function(a){var b=d+f,c=function(a){b+=a.getTypes().length*h,a.parent&&c(a.parent)};return c(a),b}).concat(g));e(a,i)};b.exports={get:c,set:e,setToTypeGap:f,reduceBottomSpace:d}},{}],185:[function(a,b){"use strict";b.exports=function(){var a=function(a){return a.addClass("ui-selected")},b=function(a){return a.removeClass("ui-selected")};return{addClass:a,removeClass:b}}()},{}]},{},[84]),function(){$(function(){$(".textae-control").textae(),$(".textae-editor").textae()})}(jQuery);